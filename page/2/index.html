<!DOCTYPE html>
<html>
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="utf-8">
  
  <meta name="renderer" content="webkit">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <link rel="dns-prefetch" href="https://github.com/RookieLinLucy666/study.github.io">
  <title>散自己财童子小林</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="下岗工人">
<meta property="og:type" content="website">
<meta property="og:title" content="散自己财童子小林">
<meta property="og:url" content="https://github.com/RookieLinLucy666/study.github.io/page/2/index.html">
<meta property="og:site_name" content="散自己财童子小林">
<meta property="og:description" content="下岗工人">
<meta property="og:locale" content="default">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="散自己财童子小林">
<meta name="twitter:description" content="下岗工人">
  
    <link rel="alternative" href="/atom.xml" title="散自己财童子小林" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.jpeg">
  
  <link rel="stylesheet" type="text/css" href="/study.github.io/./main.0cf68a.css">
  <style type="text/css">
  
    #container.show {
      background: linear-gradient(200deg,#a0cfe4,#e8c37e);
    }
  </style>
  

  

</head>
</html>
<body>
  <div id="container" q-class="show:isCtnShow">
    <canvas id="anm-canvas" class="anm-canvas"></canvas>
    <div class="left-col" q-class="show:isShow">
      
<div class="overlay" style="background: #4d4d4d"></div>
<div class="intrude-less">
	<header id="header" class="inner">
		<a href="/study.github.io/" class="profilepic">
			<img src="/study.github.io/assets/img/avatar.jpeg" class="js-avatar">
		</a>
		<hgroup>
		  <h1 class="header-author"><a href="/study.github.io/">Yijing Lin</a></h1>
		</hgroup>
		

		<nav class="header-menu">
			<ul>
			
				<li><a href="/study.github.io/tags/2019/">2019</a></li>
	        
				<li><a href="/study.github.io/tags/2020/">2020</a></li>
	        
				<li><a href="/study.github.io/tags/2020/">主页</a></li>
	        
			</ul>
		</nav>
		<nav class="header-smart-menu">
    		
    			
    			<a q-on="click: openSlider(e, 'innerArchive')" href="javascript:void(0)">所有文章</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'friends')" href="javascript:void(0)">友链</a>
    			
            
    			
    			<a q-on="click: openSlider(e, 'aboutme')" href="javascript:void(0)">关于我</a>
    			
            
		</nav>
		<nav class="header-nav">
			<div class="social">
				
					<a class="github" target="_blank" href="https://github.com/RookieLinLucy666" title="github"><i class="icon-github"></i></a>
		        
					<a class="google" target="_blank" href="/study.github.io/pawn0603@gmail.com" title="google"><i class="icon-google"></i></a>
		        
			</div>
		</nav>
	</header>		
</div>

    </div>
    <div class="mid-col" q-class="show:isShow,hide:isShow|isFalse">
      
<nav id="mobile-nav">
  	<div class="overlay js-overlay" style="background: #4d4d4d"></div>
	<div class="btnctn js-mobile-btnctn">
  		<div class="slider-trigger list" q-on="click: openSlider(e)"><i class="icon icon-sort"></i></div>
	</div>
	<div class="intrude-less">
		<header id="header" class="inner">
			<div class="profilepic">
				<img src="/study.github.io/assets/img/avatar.jpeg" class="js-avatar">
			</div>
			<hgroup>
			  <h1 class="header-author js-header-author">Yijing Lin</h1>
			</hgroup>
			
			
			
				
			
				
			
				
			
			
			
			<nav class="header-nav">
				<div class="social">
					
						<a class="github" target="_blank" href="https://github.com/RookieLinLucy666" title="github"><i class="icon-github"></i></a>
			        
						<a class="google" target="_blank" href="/study.github.io/pawn0603@gmail.com" title="google"><i class="icon-google"></i></a>
			        
				</div>
			</nav>

			<nav class="header-menu js-header-menu">
				<ul style="width: 70%">
				
				
					<li style="width: 33.333333333333336%"><a href="/study.github.io/tags/2019/">2019</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/study.github.io/tags/2020/">2020</a></li>
		        
					<li style="width: 33.333333333333336%"><a href="/study.github.io/tags/2020/">主页</a></li>
		        
				</ul>
			</nav>
		</header>				
	</div>
	<div class="mobile-mask" style="display:none" q-show="isShow"></div>
</nav>

      <div id="wrapper" class="body-wrap">
        <div class="menu-l">
          <div class="canvas-wrap">
            <canvas data-colors="#eaeaea" data-sectionHeight="100" data-contentId="js-content" id="myCanvas1" class="anm-canvas"></canvas>
          </div>
          <div id="js-content" class="content-ll">
            
  
    <article id="post-Blockchain-The-revolution-that-hasn-t-quite-happened" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2020/03/04/Blockchain-The-revolution-that-hasn-t-quite-happened/">Blockchain: The revolution that hasn&#39;t quite happened </a>
    </h1>
  

        
        <a href="/study.github.io/2020/03/04/Blockchain-The-revolution-that-hasn-t-quite-happened/" class="archive-article-date">
  	<time datetime="2020-03-04T01:32:09.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-03-04</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Blockchain-The-revolution-that-hasn’t-quite-happened"><a href="#Blockchain-The-revolution-that-hasn’t-quite-happened" class="headerlink" title="Blockchain: The revolution that hasn’t quite happened"></a>Blockchain: The revolution that hasn’t quite happened</h1><p>链接：<a href="https://www.bbc.com/news/business-51281233" target="_blank" rel="noopener">https://www.bbc.com/news/business-51281233</a></p>
<p>来源：BBC News</p>
<blockquote>
<p>Imagine you are out shopping and get to the till but your card doesn’t work. It turns out that your bank has had a computer meltdown and none of its customers, including you, can pay for anything.</p>
</blockquote>
<p>想象一下您在购物并且准备结账，但是您的卡不起作用。 事实证明，您的银行发生了计算机故障，包括您在内的所有客户都无法支付任何费用。</p>
<blockquote>
<p>But what if the till had access to a record, or ledger, of the balance on your credit and debit cards that was updated anytime you bought something?</p>
</blockquote>
<p>但是，如果收银员可以访问信用卡和借记卡上的余额的记录或账本，该记录或账本在您购买任何东西时都会更新？</p>
<blockquote>
<p>Even with the bank’s systems down your card would still work at the supermarket, because the till itself would know your balance.</p>
</blockquote>
<p>即使关闭了银行的系统，您的卡仍然可以在超市使用，因为收银员本身就会知道您的余额。</p>
<blockquote>
<p>That is just one possibility offered by a distributed ledger, also referred to as a blockchain. The technology has been around for more than a decade and has been heavily hyped.</p>
</blockquote>
<p>这只是分布式账本（也称为区块链）提供的一种可能性。 这项技术已经存在了十多年，并被大量宣传。</p>
<blockquote>
<p>It sounds pretty handy, but in practice, it is hardly used. So what happened?</p>
</blockquote>
<p>听起来很方便，但是在实践中，几乎没有使用它。 所以发生了什么事？</p>
<blockquote>
<p>Blockchain has struggled to find a purpose, beyond powering cryptocurrencies like Bitcoin.</p>
</blockquote>
<p>除了为像比特币这样的加密货币提供支持之外，区块链还很难找到目标。</p>
<blockquote>
<p>In that scenario, the blockchain acts as a universal record of every Bitcoin transaction ever made. The blockchain is a ledger, or log, of those transactions and users on the network collaborate to verify new transactions when they occur. They’re rewarded financially for this effort - an enterprise known as “Bitcoin mining”.</p>
</blockquote>
<p>在这种情况下，区块链可记录每笔比特币交易。 区块链是这些交易的账本或日志，网络上的用户将在新交易发生时进行协作以验证新交易。 他们为此付出了金钱上的回报-被称为“比特币挖矿”。</p>
<blockquote>
<p>But the basic idea, of a ledger of information distributed around lots of different users instead of held centrally, has provoked a lot of interest.</p>
</blockquote>
<p>但是，将基本信息分散在许多不同用户而不是集中存储的基本思想引起了很多兴趣。</p>
<blockquote>
<p>Proponents have long argued it could be a better alternative to traditional databases.</p>
</blockquote>
<p>支持者长期以来一直在争辩说它可能是传统数据库的更好替代方案。</p>
<blockquote>
<p>But how transformative would blockchain-style alternatives really be? The shop tills example was suggested by Dave Birch, an author and advisor on digital financial services, who has been critical of some proposed blockchain schemes in the past.</p>
</blockquote>
<p>但是，区块链风格的替代方案到底将带来怎样的变革？ 商店示例是由数字金融服务的作者兼顾问Dave Birch提出的，他过去对某些提议的区块链方案持批评态度。</p>
<blockquote>
<p>“I’m prepared to buy that,” he says, of the tills idea. “I think there’s some value to it.”</p>
</blockquote>
<p>他说：“我已经准备好买了。” “我认为它有一些价值。”</p>
<blockquote>
<p>There are other ideas out there. Prof Gilbert Fridgen, a financial services expert at Luxembourg University suggests a distributed ledger system that keeps track of certificates and degrees issued by universities.</p>
</blockquote>
<p>还有其他观点。 卢森堡大学金融服务专家吉尔伯特·弗里奇恩（Gilbert Fridgen）教授建议采用一种分布式账本系统，该系统可以跟踪大学颁发的证书和学位。</p>
<blockquote>
<p>No one organisation would be responsible for it. Rather, copies of the ledger would be held by multiple parties and individuals would be able to check that records of their own qualifications were accurate.</p>
</blockquote>
<p>无需任何组织对此负责。 相反，该帐本的副本将由多方持有，个人将能够检查自己的资格记录是否正确。</p>
<blockquote>
<p>It would certainly by useful. In 2018, a BBC investigation showed that there were thousands of fake degrees in circulation, so a decentralised system that tracks qualifications might appeal to employers.</p>
</blockquote>
<p>这肯定是有用的。 英国广播公司（BBC）在2018年进行的一项调查显示，流通中的假学位有数千个，因此追踪资格的去中心化系统可能会吸引雇主。</p>
<blockquote>
<p>That said, Prof Fridgen notes that nothing about a blockchain itself can stop some corrupt individuals trying to add fraudulent information to it. Additional checks are needed.</p>
</blockquote>
<p>话虽如此，弗里奇恩教授指出，区块链本身并不能阻止一些恶意的人试图向其添加欺诈性信息，还需要其他检查。</p>
<blockquote>
<p>If those trust issues can be solved, then blockchains could have real benefits.</p>
</blockquote>
<p>如果可以解决这些信任问题，那么区块链将具有真正的好处。</p>
<blockquote>
<p>News surfaced recently of <a href="https://www.bbc.co.uk/news/uk-43782241" target="_blank" rel="noopener">members of the Windrush generation</a> of migrants from the Commonwealth who have had their legal status questioned because records were not kept of their being granted leave to remain in the 1970s. In the future, such errors might be avoided by keeping information like this on a distributed ledger instead of relying on the government to look after it.</p>
</blockquote>
<p>最近，来自Windrush成员的消息浮出水面，这些移民来自英联邦，他们的法律地位受到质疑，因为他们的身分在1970年代并未保存下。将来，可以通过将这样的信息保存在分布式分类账本中，而不是依靠政府来照顾它，来避免此类错误。</p>
<blockquote>
<p>Some big businesses have been incorporating the technology into their operations.</p>
</blockquote>
<p>一些大企业已将区块链技术纳入其运营。</p>
<blockquote>
<p>Take shipping giant Maersk. It uses blockchain technology in TradeLens, a new system for tracking customs documentation on goods that are shipped internationally. The idea is that any stakeholder in the process, from a port to a customs authority, can quickly look up details pertaining to a shipment.</p>
</blockquote>
<p>以航运巨头马士基为例。它在TradeLens中使用了区块链技术，TradeLens是一个用于跟踪国际运输商品海关文件的新系统。这个想法是，从港口到海关当局的任何利益相关者都可以快速查找与装运有关的详细信息。</p>
<blockquote>
<p>Maersk says that 10 million shipping events are now registered in the system every week.</p>
</blockquote>
<p>马士基表示，现在每周在系统中注册1000万个运输事件。</p>
<blockquote>
<p>Unlike Bitcoin, TradeLens uses a permissioned blockchain, this is a non-public ledger to which access is controlled.</p>
</blockquote>
<p>与比特币不同，TradeLens使用许可的区块链，这是对访问进行控制的非公共账本。</p>
<blockquote>
<p>But a similar system could be achieved with other technologies such as cloud-based ledger databases that encrypt data and control who can access what information.</p>
</blockquote>
<p>但是，其他技术也可以实现类似的系统，例如基于云的分类帐数据库，该数据库对数据进行加密并控制谁可以访问哪些信息。</p>
<blockquote>
<p>Another project of interest is the real estate system trialled by the Swedish land registry, Lantmäteriet. A blockchain was designed to track documents during the sale of a property. The buyer and seller, brokers and banks involved could all take part in and keep track of the sale digitally.</p>
</blockquote>
<p>另一个感兴趣的项目是由瑞典土地注册局Lantmäteriet试用的房地产系统。 区块链旨在追踪物业出售过程中的文件。 所涉及的买卖双方，经纪人和银行都可以参与并以数字方式跟踪销售情况。</p>
<blockquote>
<p>While the trial proved such a scheme was possible, a change in legislation would be needed before the system could be scaled up in the future, explains Mats Snäll, chief innovation officer at the Swedish land registry.</p>
</blockquote>
<p>瑞典土地注册局首席创新官MatsSnäll解释说，尽管试验证明了这样的计划是可行的，但在将来对该系统进行扩展之前，需要进行立法上的修改。</p>
<blockquote>
<p>“It was never integrated into the production system of the land registry,” he tells the BBC.</p>
</blockquote>
<p>他告诉英国广播公司：“它从未被集成到土地注册系统的生产系统中。”</p>
<blockquote>
<p>In Thailand, cryptocurrency firm Zcoin developed a blockchain-based system so that members of the Thai Democrat Party could cast digital votes for their new leader in late 2018. Instead of having to trust a central authority to count the votes, they were instead collected on the Zcoin blockchain.</p>
</blockquote>
<p>在泰国，加密货币公司Zcoin开发了一个基于区块链的系统，以便泰国民主党成员可以在2018年底为其新领导人投下数字投票。他们不必信任中央机构来计算票数，而是将其收集在Zcoin区块链。</p>
<blockquote>
<p>Votes were made at polling stations or via a mobile app, where voters needed to submit a photo of themselves when casting their ballot.</p>
</blockquote>
<p>投票是在投票站或通过移动应用程序进行的，选民在投票时需要提交自己的照片。</p>
<blockquote>
<p>These digital votes were also audited by the election committee, a Zcoin spokesman tells the BBC. Zcoin says it is planning to announce a bigger scheme, involving “millions” of voters, in the near future.</p>
</blockquote>
<p>Zcoin发言人告诉英国广播公司，这些数字投票也经过了选举委员会的审核。 Zcoin说，它计划在不久的将来宣布一项更大的计划，涉及“数百万”选民。</p>
<blockquote>
<p>These are thought-provoking ventures, though a debate remains as to whether blockchain is absolutely necessary for any of them.</p>
</blockquote>
<p>这些是发人深省的冒险活动，尽管对于区块链是否绝对对其中任何一个绝对必要仍存在争议。</p>
<blockquote>
<p>Some say that eventually blockchain-style systems will prove to be the most efficient option for organising data at scale. Entrepreneur Helen Disney is one of them.</p>
</blockquote>
<p>有人说，最终，区块链式系统将被证明是大规模组织数据的最有效选择。企业家海伦·迪斯尼就是其中之一。</p>
<blockquote>
<p>“In many cases there is a cost saving to be made once you’ve got past the initial hurdle - obviously bringing in any new system is expensive,” she says.</p>
</blockquote>
<p>她说：“在许多情况下，一旦您克服了最初的障碍，就可以节省成本-显然，引入任何新系统都是很昂贵的。”</p>
<blockquote>
<p>While blockchain bluster will surely continue, even sceptics like Mr Birch think there are some focused applications that could prove worthwhile. So far, blockchain might not have changed the world - but it has got a lot of people thinking.</p>
</blockquote>
<p>虽然区块链的冲击肯定会持续，但甚至像伯奇先生这样的怀疑论者也认为，有些专注的应用可能值得证明。到目前为止，区块链可能并没有改变世界-但是它已经引起了很多人的思考。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2020</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2020/03/04/Blockchain-The-revolution-that-hasn-t-quite-happened/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-什么是比特币，它如何运作以及什么影响它的价格" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2020/03/03/什么是比特币，它如何运作以及什么影响它的价格/">什么是比特币，它如何运作以及什么影响它的价格</a>
    </h1>
  

        
        <a href="/study.github.io/2020/03/03/什么是比特币，它如何运作以及什么影响它的价格/" class="archive-article-date">
  	<time datetime="2020-03-03T14:20:55.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-03-03</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="What-is-bitcoin-how-does-it-work-and-what-affects-its-price"><a href="#What-is-bitcoin-how-does-it-work-and-what-affects-its-price" class="headerlink" title="What is bitcoin, how does it work and what affects its price?"></a>What is bitcoin, how does it work and what affects its price?</h1><p>原文链接：<a href="https://www.telegraph.co.uk/technology/0/what-is-bitcoin-everything-need-know-about-the-cryptocurrency/" target="_blank" rel="noopener">https://www.telegraph.co.uk/technology/0/what-is-bitcoin-everything-need-know-about-the-cryptocurrency/</a></p>
<p>来源：The Telegraph</p>
<blockquote>
<p>Few technologies have the ability to stir passionate online debate and baffle the vast majority of the population as <a href="https://www.telegraph.co.uk/technology/2017/08/01/bitcoin-cash-everything-need-know-bitcoins-hard-fork/" target="_blank" rel="noopener">bitcoin</a>. The virtual currency rocketed in value last year before crashing at the start of 2018.</p>
</blockquote>
<p>很少有技术像比特币一样能够引起激烈的在线辩论，并使绝大多数人感到困惑。 去年虚拟货币的价格猛涨，然后在2018年初崩溃。</p>
<blockquote>
<p>But bitcoin appears here to stay, at least for the time being. Although the <a href="https://www.telegraph.co.uk/technology/0/cryptocurrency-calculator-much-could-have-made-lost-buying-bitcoin/" target="_blank" rel="noopener">price </a>has fallen since the start of the year to around $6,400 (£4,900), well below its peak of $20,000, it is still above its price a year ago and interest in it continues.</p>
</blockquote>
<p>但是，至少暂时而言，比特币似乎在这里存在。 尽管价格自今年年初以来已下跌至约6,400美元（4,900英镑），远低于其20,000美元的峰值，但仍高于一年前的价格，并且人们对该市场的兴趣持续。</p>
<blockquote>
<p>There have been spikes along the way, possibly caused by mass computer trading or <a href="https://www.telegraph.co.uk/business/2018/04/12/stocks-struggle-oil-rally-continues-markets-brace-war-syria/#update-20180412-1512" target="_blank" rel="noopener">short sellers</a> jumping ship and encouraging buyers to flood back in.</p>
</blockquote>
<p>比特币价格一路飙升，可能是由于大规模计算机交易或卖空者跳船并鼓励买主大量涌入造成的。</p>
<blockquote>
<p>It all leaves investors with a slew of questions. Is Bitcoin the future of currency? Is it currency at all? What is it for? And should I buy some? Read on to have your questions answered.</p>
</blockquote>
<p>这给投资者带来了很多问题。 比特币是货币的未来吗？ 它是货币吗？ 它有什么用？我应该买比特币吗？ 请继续阅读以回答您的问题。</p>
<h1 id="What-is-Bitcoin"><a href="#What-is-Bitcoin" class="headerlink" title="What is Bitcoin?"></a>What is Bitcoin?</h1><blockquote>
<p><a href="https://www.telegraph.co.uk/technology/2017/09/06/bitcoin-ethereum-price-rises-cryptocurrencies-make-recovery/" target="_blank" rel="noopener">Bitcoin </a>is a digital currency created in 2009 that uses decentralised technology for secure payments and storing money that doesn’t require banks or people’s names. It was announced on an email circular as a way to liberate money in a similar way to how the internet made information free. </p>
</blockquote>
<p>比特币是2009年创建的一种数字货币，它使用去中心化技术进行安全支付并存储，不需要银行或人名的货币。 它是在一封电子邮件通函中宣布的，以一种类似于互联网使信息免费的方式来释放金钱的方式。</p>
<h1 id="How-does-it-work"><a href="#How-does-it-work" class="headerlink" title="How does it work?"></a>How does it work?</h1><blockquote>
<p>Bitcoin works on a public ledger called a blockchain, which holds a decentralised record of all transactions that is updated and held by all users of the network.</p>
</blockquote>
<p>比特币在被称为区块链的公共账本上运行，该账本保存了网络所有用户更新和持有的所有交易的去中心化记录。</p>
<blockquote>
<p>To create bitcoins, users must generate blocks on the network. Each block is created cryptographically by harnessing users’ computer power and is then added to the blockchain, letting users earn by keeping the network running. </p>
</blockquote>
<p>要创建比特币，用户必须在网络上生成区块。 利用用户的算力资源以加密的方式创建每个区块，然后将其添加到区块链中，让用户通过维护网络运行来获取比特币。</p>
<blockquote>
<p>A limit for how many bitcoins can be created is built into the system so the value can’t be diluted.  The maximum amount is just under 21 million bitcoin. There are currently just over 17 million in circulation, each of which was worth around $6,400 (£4,900) at the time of writing. That puts its total value at around $108.8 billion.</p>
</blockquote>
<p>系统内置了比特币总量的限制，因此比特币的价值不会被稀释。 比特币的最大总量为2100万。 目前有超过1700万的流通量，在撰写本文时，每个比特币的价值约为6,400美元（4,900英镑）。 这使其总价值约为1088亿美元。</p>
<blockquote>
<p>While at first ordinary people could mine thousands of bitcoins, potentially now worth millions of pounds, bitcoin mining now requires a huge amount of computer power to achieve. You can read our guide to bitcoin mining here.</p>
</blockquote>
<p>最初，普通人可以开采成千上万的比特币，这些比特币现在可能价值数百万英镑，而比特币挖矿现在需要大量的算力才能实现。 您可以在此处阅读我们的比特币采矿指南。</p>
<h1 id="What-affects-its-price"><a href="#What-affects-its-price" class="headerlink" title="What affects its price?"></a>What affects its price?</h1><blockquote>
<p>The price of a<a href="https://www.telegraph.co.uk/technology/2017/09/05/bitcoin-price-drops-20pc-three-days/" target="_blank" rel="noopener"> Bitcoin has jumped up and down</a> since it first entered the mainstream consciousness in 2013. That year prices rose by almost 10,000 per cent before the collapse of Mt Gox, the biggest online bitcoin exchange at the time, sent it crashing.</p>
</blockquote>
<p>自从2013年首次进入主流视线以来，比特币的价格经历了暴涨和暴跌。在当时最大的在线比特币交易所Mt Gox崩溃之前比特币的价格上涨了将近10,000％。</p>
<blockquote>
<p>Prices slowly crept up after that but surged again in 2017. This is largely put down to regulators appearing to warm to bitcoin and the rise of initial coin offerings - a way for projects to raise money by selling cryptographic tokens similar to bitcoins. Sceptics believed we were in the middle of a Bitcoin bubble while advocates say we are just beginning to see the rise starting.</p>
</blockquote>
<p>之后价格缓慢攀升，但在2017年再次飙升。这在很大程度上归因于监管机构似乎对比特币感到热心，以及初始代币发行的兴起-项目通过出售类似于比特币的加密代币来筹集资金的一种方式。 怀疑论者认为我们正处于比特币泡沫，而拥护者则表示我们才刚刚开始看到上升的开始。</p>
<blockquote>
<p>Prices have fallen in 2018 amid fears of a regulatory crackdown.</p>
</blockquote>
<p>由于担心会受到监管，价格在2018年下跌。</p>
<h1 id="Who-is-Satoshi-Nakamoto"><a href="#Who-is-Satoshi-Nakamoto" class="headerlink" title="Who is Satoshi Nakamoto?"></a>Who is Satoshi Nakamoto?</h1><blockquote>
<p>Satoshi Nakamoto is the mysterious creator of Bitcoin and blockchain. Despite countless attempts to unmask the person or people behind the name, their identity has remained elusive. </p>
</blockquote>
<p>中本聪（Satoshi Nakamoto）是比特币和区块链的神秘创造者。 尽管无数次尝试揭露姓名背后的人，但他们的身份仍然成谜。</p>
<blockquote>
<p>There have been numerous unsuccessful attempts by journalists to reveal the Bitcoin founder. In a high-profile incident in 2014, Newsweek magazine relaunched with a feature outing Dorian Nakamoto, a 64-year-old Japanese-American man, as the creator. The affair, having fallen apart under scrutiny, ended with a car chase and the real Nakamoto refuting the allegations. </p>
</blockquote>
<p>记者曾多次尝试揭露比特币创始人，但均未成功。 在2014年的一次备受关注的事件中，《新闻周刊》（Newsweek）杂志重新推出了专题报道，推测其中一位是64岁的日裔美国人多里安·中本（Dorian Nakamoto）为比特币创始人。 此事在经过仔细审查后分崩离析，以否认和真正的中本聪驳斥了指控而告终。</p>
<blockquote>
<p>The most recent candidate was Craig Wright, a former Australian academic, who claimed to be the bitcoin inventor. Wright wrote blog posts and gave interviews to Wired, BBC and the Economist in 2015 and 2016 saying he was behind bitcoin.</p>
</blockquote>
<p>最近的候选人是前澳大利亚学者克雷格·赖特（Craig Steven Wright），他声称自己是比特币的发明者。 赖特（Wright）在2015年和2016年撰写了博客文章，并对《连线》，BBC和《经济学人》进行了采访，称他支持比特币。</p>
<blockquote>
<p>After failing to provide unquestionable proof, Wright posted an apology message that said: “I believed that I could put the years of anonymity and hiding behind me. But, as the events of this week unfolded and I prepared to publish the proof of access to the earliest keys, I broke. I do not have the courage. I cannot.”  </p>
</blockquote>
<p>在无法提供确凿的证据之后，赖特发表道歉消息，说：“我相信我可以把多年的匿名性和躲藏在我身后。但是，随着本周事件的发展，我本准备发布私钥的证据。我没有勇气。我不能。”</p>
<h1 id="How-many-people-use-bitcoin"><a href="#How-many-people-use-bitcoin" class="headerlink" title="How many people use bitcoin?"></a>How many people use bitcoin?</h1><blockquote>
<p>One of the largest Bitcoin storage platforms, Blockchain.info, claims it has more than 25 million cryptocurrency wallet holders. This has almost doubled from 10 million at the start of 2017.</p>
</blockquote>
<p>最大的比特币存储平台之一Blockchain.info声称，它拥有超过2500万加密货币钱包持有者。 这比2017年初的1000万几乎翻了一番。</p>
<h1 id="What-is-it-used-for"><a href="#What-is-it-used-for" class="headerlink" title="What is it used for?"></a>What is it used for?</h1><blockquote>
<p>Bitcoin has a range of uses, including funding companies, investing cash and transferring money without fees. It is commonly associated with criminal activity such as drug dealing, cyber crime and money laundering, since it can be near-impossible to tie a bitcoin wallet to any one individual.</p>
</blockquote>
<p>比特币有多种用途，包括成立公司，投资现金和免费转移资金。 它通常与毒品交易，网络犯罪和洗钱等犯罪活动相关联，因为将比特币钱包绑定到任何个人几乎是不可能的。</p>
<blockquote>
<p>Bitcoin can be spent online and at select retailers in the UK. They include CEX stores, some pubs and stores like e-cigarette shops and YourSushi restaurants. A full list of online and offline businesses that accept bitcoin is available <a href="http://www.wheretospendbitcoins.co.uk/search" target="_blank" rel="noopener">here</a>. They can also be withdrawn at a couple of dozen bitcoin ATMs, which can be found <a href="https://coinatmradar.com/country/225/bitcoin-atm-united-kingdom/" target="_blank" rel="noopener">here</a>.</p>
</blockquote>
<p>比特币可以在网上和英国的特定零售商处消费。 它们包括CEX商店，一些酒吧和商店，例如电子烟商店和YourSushi餐厅。 此处提供接受比特币的在线和离线业务的完整列表。 也可以在几十个比特币自动柜员机上取款，可以在此处找到。</p>
<blockquote>
<p>However, a surge of network activity has meant transaction fees spiking, meaning some retailers have lost enthusiasm. Computer maker Dell, for example, ended its pilot of accepting Bitcoins, as did online gaming store Steam.</p>
</blockquote>
<p>但是，网络活动的激增意味着交易费用飙升，使得一些零售商失去了热情。 例如，计算机制造商戴尔和在线游戏商店Steam都结束了接受比特币的试验。</p>
<blockquote>
<p>Others simply hold their Bitcoins, hoping they will accumulate in value and prove to be a lucrative investment. Its price is notoriously volatile, and early investors are now sitting on massive gains.</p>
</blockquote>
<p>其他人只是持有比特币，希望它们积累价值并证明是一笔有利可图的投资。 众所周知，它的价格波动很大，早期投资者现在正坐享巨额收益。</p>
<h1 id="Should-I-invest-in-Bitcoin"><a href="#Should-I-invest-in-Bitcoin" class="headerlink" title="Should I invest in Bitcoin?"></a>Should I invest in Bitcoin?</h1><blockquote>
<p>Bitcoin is safeguarded against fraud and theft through independent and decentralised set up, as well as being free from transaction fees. It has also given great returns to some investors, with the price jumping from a few dollars at the beginning of 2013 to $1,100 by November. People who invested £2,000 five years ago would now be very wealthy. </p>
</blockquote>
<p>比特币通过独立和去中心化的设置来保护其免受欺诈和盗窃，并且免收交易费。 它也为一些投资者带来了丰厚的回报，其价格从2013年初的几美元跃升至11月的1100美元。 五年前投资2,000英镑的人现在将变得非常有钱。</p>
<blockquote>
<p>After a few level years, its<a href="https://www.telegraph.co.uk/technology/2017/05/28/bitcoin-bubble-back-investors-should-avoid/" target="_blank" rel="noopener"> dollar price soared during 2017</a>, and it peaked at more than $20,000. But the price has plunged since then, leaving investors to ponder whether its bubble has burst or the best is yet to come.</p>
</blockquote>
<p>经过几年的发展，其美元价格在2017年飙升，最高达到20,000美元以上。 但此后价格一直暴跌，让投资者思考其泡沫是否破裂或最好的时刻尚未到来。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2020</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2020/03/03/什么是比特币，它如何运作以及什么影响它的价格/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-git本地账号切换" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2020/03/03/git本地账号切换/">git本地账号切换</a>
    </h1>
  

        
        <a href="/study.github.io/2020/03/03/git本地账号切换/" class="archive-article-date">
  	<time datetime="2020-03-03T12:34:50.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-03-03</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <p>1.设置全局用户名和邮箱</p>
<p><code>git config --global user.name &quot;username&quot;</code></p>
<p><code>git config --global user.email &quot;useremail&quot;</code></p>
<p>2.ssh密钥</p>
<p>若已生成ssh密钥</p>
<p><code>cp -R ~/.ssh ~/.ssh_backup</code>        备份</p>
<p><code>rm -r ~/.ssh</code>        删除</p>
<p><code>ssh-keygen -t rsa -C &quot;useremail&quot;</code>        生成密钥对 id_rsa 和 id_rsa.pub</p>
<p><code>ssh-add -K ~/.ssh/id_rsa</code>        添加密钥到ssh</p>
<p>在github的setting中添加ssh密钥，即 id_rsa.pub文件中的内容</p>
<p>3.查看账号信息</p>
<p><code>git config --list</code></p>
<p>4.验证权限</p>
<p><code>ssh -T git@github.com</code> </p>
<p><code>Hi username! You&#39;ve successfully authenticated, but GitHub does not provide shell access.</code></p>
<p>此时成功</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2020</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2020/03/03/git本地账号切换/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-hexo常见命令" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2020/03/03/hexo常见命令/">hexo常见命令</a>
    </h1>
  

        
        <a href="/study.github.io/2020/03/03/hexo常见命令/" class="archive-article-date">
  	<time datetime="2020-03-03T12:23:49.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2020-03-03</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <p>初始化博客</p>
<p><code>hexo init blog</code></p>
<p>开启本地服务器（用于调试，默认端口4000）</p>
<p><code>hexo server</code></p>
<p>新建文件夹</p>
<p><code>hexo new page &quot;foldername&quot;</code></p>
<p>新建文章</p>
<p><code>hexo new &quot;filename&quot;</code></p>
<p>新建草稿(草稿不会显示在页面中)</p>
<p><code>hexo new draft &quot;filename&quot;</code></p>
<p>发布草稿文章</p>
<p><code>hexo publish file</code></p>
<p>生成网页</p>
<p><code>hexo clean(清除缓存)</code></p>
<p><code>hexo generate</code></p>
<p>部署</p>
<p><code>hexo deploy</code></p>
<p>生成并部署</p>
<p><code>hexo generate --deploy</code></p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2020</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2020/03/03/hexo常见命令/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-Heroku搭建自己的服务器教程" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2019/06/22/Heroku搭建自己的服务器教程/">Heroku搭建自己的服务器教程</a>
    </h1>
  

        
        <a href="/study.github.io/2019/06/22/Heroku搭建自己的服务器教程/" class="archive-article-date">
  	<time datetime="2019-06-22T07:48:39.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-06-22</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <p>转载自：<a href="https://ixs.im/fun/Heroku_ssh/" target="_blank" rel="noopener">https://ixs.im/fun/Heroku_ssh/</a></p>
        
          <a class="article-more-a" href="/study.github.io/2019/06/22/Heroku搭建自己的服务器教程/#more">more >></a>
        
      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2019</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">Heroku</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2019/06/22/Heroku搭建自己的服务器教程/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-mac-os：搭建SS服务器" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2019/06/04/mac-os：搭建SS服务器/">mac os：搭建SS服务器</a>
    </h1>
  

        
        <a href="/study.github.io/2019/06/04/mac-os：搭建SS服务器/" class="archive-article-date">
  	<time datetime="2019-06-04T02:41:15.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-06-04</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <p>本文适用于没有一键安装SS脚本的套餐。</p>
<p>[TOC]</p>
        
          <a class="article-more-a" href="/study.github.io/2019/06/04/mac-os：搭建SS服务器/#more">more >></a>
        
      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2019</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2019/06/04/mac-os：搭建SS服务器/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-python进阶" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2019/05/30/python进阶/">python进阶</a>
    </h1>
  

        
        <a href="/study.github.io/2019/05/30/python进阶/" class="archive-article-date">
  	<time datetime="2019-05-30T08:12:46.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-05-30</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<p>[TOC]</p>
<h1 id="args和-kwargs调用函数"><a href="#args和-kwargs调用函数" class="headerlink" title="*args和**kwargs调用函数"></a>*args和**kwargs调用函数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_args</span><span class="params">(f_arg, *args)</span>:</span></span><br><span class="line">    print(<span class="string">'farg: '</span>, f_arg)</span><br><span class="line">    <span class="keyword">for</span> arg <span class="keyword">in</span> args:</span><br><span class="line">        print(<span class="string">'arg:'</span>, arg)</span><br><span class="line"></span><br><span class="line">test = [<span class="string">'python'</span>,<span class="string">'eggs'</span>,<span class="string">'test'</span>]</span><br><span class="line">test_args(<span class="string">'yasoob'</span>,*test)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">farg:  yasoob</span></span><br><span class="line"><span class="string">arg: python</span></span><br><span class="line"><span class="string">arg: eggs</span></span><br><span class="line"><span class="string">arg: test</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_kwargs</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    <span class="keyword">for</span> key, value <span class="keyword">in</span> kwargs.items():</span><br><span class="line">        print(<span class="string">"&#123;0&#125; = &#123;1&#125;"</span>.format(key, value))</span><br><span class="line"></span><br><span class="line">person = &#123;<span class="string">'name'</span>:<span class="string">'lin'</span>,<span class="string">'age'</span>:<span class="number">10</span>&#125;</span><br><span class="line">test_kwargs(**person)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">name = lin</span></span><br><span class="line"><span class="string">age = 10</span></span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_args_kwargs</span><span class="params">(arg1, arg2, arg3)</span>:</span></span><br><span class="line">    print(<span class="string">'arg1:'</span>,arg1)</span><br><span class="line">    print(<span class="string">'arg2:'</span>,arg2)</span><br><span class="line">    print(<span class="string">'arg3:'</span>,arg3)</span><br><span class="line"></span><br><span class="line">args = [<span class="string">'two'</span>,<span class="number">3</span>,<span class="number">5</span>]</span><br><span class="line">test_args_kwargs(*args)</span><br><span class="line">kwargs = &#123;<span class="string">'arg3'</span>:<span class="number">3</span>,<span class="string">'arg2'</span>:<span class="number">2</span>,<span class="string">'arg1'</span>:<span class="number">1</span>&#125;</span><br><span class="line">test_args_kwargs(**kwargs)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">arg1: two</span></span><br><span class="line"><span class="string">arg2: 3</span></span><br><span class="line"><span class="string">arg3: 5</span></span><br><span class="line"><span class="string">arg1: 1</span></span><br><span class="line"><span class="string">arg2: 2</span></span><br><span class="line"><span class="string">arg3: 3</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>#生成器（generators）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibon</span><span class="params">(n)</span>:</span></span><br><span class="line">    a = b = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(n):</span><br><span class="line">        <span class="keyword">yield</span> a</span><br><span class="line">        a, b = b, a + b</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> fibon(<span class="number">10</span>):</span><br><span class="line">    print(x)</span><br><span class="line"></span><br><span class="line">result = fibon(<span class="number">10</span>)</span><br><span class="line">print(next(result))</span><br><span class="line">print(next(result))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">2</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">5</span></span><br><span class="line"><span class="string">8</span></span><br><span class="line"><span class="string">13</span></span><br><span class="line"><span class="string">21</span></span><br><span class="line"><span class="string">34</span></span><br><span class="line"><span class="string">55</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">1</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h1><h2 id="规范"><a href="#规范" class="headerlink" title="规范"></a>规范</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">map(function_to_apply, list_of_inputs)</span><br></pre></td></tr></table></figure>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">items = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>]</span><br><span class="line">squared = list(map(<span class="keyword">lambda</span> x: x**<span class="number">2</span>, items))</span><br><span class="line">print(squared)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">multiply</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x ** <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + x</span><br><span class="line"></span><br><span class="line">funcs = [multiply, add]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">5</span>):</span><br><span class="line">    result = list(map(<span class="keyword">lambda</span> x: x(i), funcs))</span><br><span class="line">    print(result)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[1, 4, 9, 16, 25]</span></span><br><span class="line"><span class="string">[0, 0]</span></span><br><span class="line"><span class="string">[1, 2]</span></span><br><span class="line"><span class="string">[4, 4]</span></span><br><span class="line"><span class="string">[9, 6]</span></span><br><span class="line"><span class="string">[16, 8]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items = range(<span class="number">-5</span>,<span class="number">5</span>)</span><br><span class="line">less_than_zero = list(filter(<span class="keyword">lambda</span> x: x&lt;<span class="number">0</span>, items))</span><br><span class="line">print(less_than_zero)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[-5, -4, -3, -2, -1]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="Reduce"><a href="#Reduce" class="headerlink" title="Reduce"></a>Reduce</h1><p>返回整个列表的计算结果，如需要计算一个整数列表的乘积。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line">value = reduce(<span class="keyword">lambda</span> x,y: x * y,[<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">print(value)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">24</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>#set(集合)数据结构</p>
<p>set不能包含重复值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">items = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'b'</span>,<span class="string">'d'</span>,<span class="string">'m'</span>,<span class="string">'n'</span>,<span class="string">'n'</span>]</span><br><span class="line">value = set([x <span class="keyword">for</span> x <span class="keyword">in</span> items <span class="keyword">if</span> items.count(x) &gt; <span class="number">1</span>])</span><br><span class="line">print(value)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;'b', 'n'&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="交集"><a href="#交集" class="headerlink" title="交集"></a>交集</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">input_set.intersection(another_set)</span><br></pre></td></tr></table></figure>
<h2 id="差集"><a href="#差集" class="headerlink" title="差集"></a>差集</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">input_set.difference(another_set)</span><br></pre></td></tr></table></figure>
<h1 id="三元运算符"><a href="#三元运算符" class="headerlink" title="三元运算符"></a>三元运算符</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">is_fat = true</span><br><span class="line">state = <span class="string">'fat'</span> <span class="keyword">if</span> is_fat <span class="keyword">else</span> <span class="string">'not fat'</span></span><br><span class="line">print(state)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">fat</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>#装饰器（decorators）</p>
<p>之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapFunc</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'before'</span>)</span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">'after'</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapFunc</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running'</span>)</span><br><span class="line"></span><br><span class="line">func = decorator(func)</span><br><span class="line">print(func())</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">before</span></span><br><span class="line"><span class="string">running</span></span><br><span class="line"><span class="string">after</span></span><br><span class="line"><span class="string">None</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>之后：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapFunc</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'before'</span>)</span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">'after'</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapFunc</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running'</span>)</span><br><span class="line"></span><br><span class="line">print(func())</span><br><span class="line">print(func.__name__)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">before</span></span><br><span class="line"><span class="string">running</span></span><br><span class="line"><span class="string">after</span></span><br><span class="line"><span class="string">None</span></span><br><span class="line"><span class="string">wrapFunc</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>函数被<code>wrapFunc</code>替代，它重写函数的名字和注释文档，修改后：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapFunc</span><span class="params">()</span>:</span></span><br><span class="line">        print(<span class="string">'before'</span>)</span><br><span class="line">        func()</span><br><span class="line">        print(<span class="string">'after'</span>)</span><br><span class="line">    <span class="keyword">return</span> wrapFunc</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    print(<span class="string">'running'</span>)</span><br><span class="line"></span><br><span class="line">print(func())</span><br><span class="line">print(func.__name__)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">before</span></span><br><span class="line"><span class="string">running</span></span><br><span class="line"><span class="string">after</span></span><br><span class="line"><span class="string">None</span></span><br><span class="line"><span class="string">func</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>##蓝本规范</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">wrapFunc</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> can_run:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">'can not run'</span></span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> wrapFunc</span><br><span class="line"></span><br><span class="line"><span class="meta">@decorator</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> <span class="string">'can run'</span></span><br><span class="line"></span><br><span class="line">can_run = <span class="literal">True</span></span><br><span class="line">print(func())</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">can run</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>##应用场景（日志）</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logit</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">    @wraps(func)</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">with_logging</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">        print(func.__name__+<span class="string">'was called'</span>)</span><br><span class="line">        <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">    <span class="keyword">return</span> with_logging</span><br><span class="line"></span><br><span class="line"><span class="meta">@logit</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_func</span><span class="params">(x)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> x + x</span><br><span class="line"></span><br><span class="line">print(add_func(<span class="number">4</span>))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">add_funcwas called</span></span><br><span class="line"><span class="string">8</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>##在函数中嵌入装饰器</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">logit</span><span class="params">(logfile=<span class="string">"out.log"</span>)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">logging_decorator</span><span class="params">(func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapFunc</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            log_string = func.__name__+<span class="string">'was called'</span></span><br><span class="line">            print(log_string)</span><br><span class="line">            <span class="keyword">with</span> open(logfile,<span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                opened_file.write(log_string+<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapFunc</span><br><span class="line">    <span class="keyword">return</span> logging_decorator</span><br><span class="line"></span><br><span class="line"><span class="meta">@logit()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func1</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">func1()</span><br><span class="line"></span><br><span class="line"><span class="meta">@logit(logfile='out1.log')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func2</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">func2()</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">func1was called</span></span><br><span class="line"><span class="string">func2was called</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>##装饰器类</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> wraps</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">logit</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, logfile=<span class="string">'out.log'</span>)</span>:</span></span><br><span class="line">        self.logfile = logfile</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self, func)</span>:</span></span><br><span class="line"><span class="meta">        @wraps(func)</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">wrapFunc</span><span class="params">(*args, **kwargs)</span>:</span></span><br><span class="line">            log_string = func.__name__+<span class="string">' was called'</span></span><br><span class="line">            print(log_string)</span><br><span class="line">            <span class="keyword">with</span> open(self.logfile,<span class="string">'a'</span>) <span class="keyword">as</span> opened_file:</span><br><span class="line">                opened_file.write(log_string+<span class="string">'\n'</span>)</span><br><span class="line">            <span class="keyword">return</span> func(*args, **kwargs)</span><br><span class="line">        <span class="keyword">return</span> wrapFunc</span><br><span class="line"></span><br><span class="line"><span class="meta">@logit()</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">print(func())</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">func was called</span></span><br><span class="line"><span class="string">None</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>#对象变动（Mutation）</p>
<p>之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to</span><span class="params">(num, target=[])</span>:</span></span><br><span class="line">    target.append(num)</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line"></span><br><span class="line">print(add_to(<span class="number">1</span>))</span><br><span class="line">print(add_to(<span class="number">2</span>))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[1]</span></span><br><span class="line"><span class="string">[1, 2]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>之后：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add_to</span><span class="params">(num, target=None)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> target <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">        target = []</span><br><span class="line">    target.append(num)</span><br><span class="line">    <span class="keyword">return</span> target</span><br><span class="line"></span><br><span class="line">print(add_to(<span class="number">1</span>))</span><br><span class="line">print(add_to(<span class="number">2</span>))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[1]</span></span><br><span class="line"><span class="string">[2]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="slots"><a href="#slots" class="headerlink" title="slots"></a><strong>slots</strong></h1><p>使用该属性告诉python不要使用字典，而是只给一个固定集合的属性分配空间来减少内存。</p>
<p>之前：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,identifier)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.identifier = identifier</span><br><span class="line"></span><br><span class="line">instance = MyClass(<span class="string">'lin'</span>,<span class="string">'0123'</span>)</span><br><span class="line">print(instance.name, instance.identifier)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">lin 0123</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>之后：</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyClass</span><span class="params">(object)</span>:</span></span><br><span class="line">    __slots__ = [<span class="string">'name'</span>,<span class="string">'identifier'</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,name,identifier)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.identifier = identifier</span><br><span class="line">        </span><br><span class="line">instance = MyClass(<span class="string">'lin'</span>,<span class="string">'0123'</span>)</span><br><span class="line">print(instance.name, instance.identifier)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">lin 0123</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>#容器（Collections）</p>
<p>##defaultdict</p>
<p>与dict类型不同，defaultdict无需检查key是否存在</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> defaultdict</span><br><span class="line">colours = (</span><br><span class="line">    (<span class="string">'yasoob'</span>,<span class="string">'yellow'</span>),</span><br><span class="line">    (<span class="string">'ali'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    (<span class="string">'arham'</span>,<span class="string">'green'</span>),</span><br><span class="line">    (<span class="string">'ali'</span>,<span class="string">'black'</span>),</span><br><span class="line">    (<span class="string">'yasoob'</span>,<span class="string">'red'</span>),</span><br><span class="line">    (<span class="string">'ahmed'</span>,<span class="string">'silver'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">favourite_colours = defaultdict(list)</span><br><span class="line"><span class="keyword">for</span> name, colour <span class="keyword">in</span> colours:</span><br><span class="line">    favourite_colours[name].append(colour)</span><br><span class="line"></span><br><span class="line">print(favourite_colours)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">defaultdict(&lt;class 'list'&gt;, </span></span><br><span class="line"><span class="string">&#123;'yasoob': ['yellow', 'red'], 'ali': ['blue', 'black'], 'arham': ['green'], 'ahmed': ['silver']&#125;)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>一个字典中对一个键进行嵌套赋值</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> collections,json</span><br><span class="line">tree = <span class="keyword">lambda</span>:collections.defaultdict(tree)</span><br><span class="line">some_dict = tree()</span><br><span class="line">some_dict[<span class="string">'color'</span>][<span class="string">'favorite'</span>] = <span class="string">'yellow'</span></span><br><span class="line">print(json.dumps(some_dict))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;"color": &#123;"favorite": "yellow"&#125;&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="counter"><a href="#counter" class="headerlink" title="counter"></a>counter</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line">colours = (</span><br><span class="line">    (<span class="string">'yasoob'</span>,<span class="string">'yellow'</span>),</span><br><span class="line">    (<span class="string">'ali'</span>,<span class="string">'blue'</span>),</span><br><span class="line">    (<span class="string">'arham'</span>,<span class="string">'green'</span>),</span><br><span class="line">    (<span class="string">'ali'</span>,<span class="string">'black'</span>),</span><br><span class="line">    (<span class="string">'yasoob'</span>,<span class="string">'red'</span>),</span><br><span class="line">    (<span class="string">'ahmed'</span>,<span class="string">'silver'</span>)</span><br><span class="line">)</span><br><span class="line"></span><br><span class="line">count_fav = Counter(name <span class="keyword">for</span> name, color <span class="keyword">in</span> colours)</span><br><span class="line">print(count_fav)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Counter(&#123;('yasoob', 'yellow'): 1, ('ali', 'blue'): 1, ('arham', 'green'): 1, ('ali', 'black'): 1, ('yasoob', 'red'): 1, ('ahmed', 'silver'): 1&#125;)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>统计文件</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">with</span> open(<span class="string">'out.log'</span>,<span class="string">'rb'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    line_count = Counter(f)</span><br><span class="line"></span><br><span class="line">print(line_count)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Counter(&#123;b'func1was called\n': 1, b'func was called\n': 1&#125;)</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="deque"><a href="#deque" class="headerlink" title="deque"></a>deque</h2><p>双端队列，可从头/尾两端添加或删除元素</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line">d = deque()</span><br><span class="line">d.append(<span class="number">1</span>)</span><br><span class="line">d.append(<span class="number">2</span>)</span><br><span class="line">d.append(<span class="number">3</span>)</span><br><span class="line">print(len(d))</span><br><span class="line">print(d[<span class="number">-1</span>])</span><br><span class="line">d = deque(range(<span class="number">5</span>))</span><br><span class="line">print(len(d))</span><br><span class="line">print(d.popleft())</span><br><span class="line">print(d.pop())</span><br><span class="line">print(d)</span><br><span class="line">d.extendleft([<span class="number">0</span>,<span class="number">-1</span>,<span class="number">-2</span>])</span><br><span class="line">print(d)</span><br><span class="line">d.extend([<span class="number">4</span>,<span class="number">5</span>,<span class="number">6</span>])</span><br><span class="line">print(d)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">3</span></span><br><span class="line"><span class="string">5</span></span><br><span class="line"><span class="string">0</span></span><br><span class="line"><span class="string">4</span></span><br><span class="line"><span class="string">deque([1, 2, 3])</span></span><br><span class="line"><span class="string">deque([-2, -1, 0, 1, 2, 3])</span></span><br><span class="line"><span class="string">deque([-2, -1, 0, 1, 2, 3, 4, 5, 6])</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="namedtuple"><a href="#namedtuple" class="headerlink" title="namedtuple"></a>namedtuple</h2><p>把元组变成一个简单任务的容器，不必使用整数索引来访问一个namedtuples的数据，可以像字典一样访问namedtuples，但namedtuples不可变。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>,<span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name=<span class="string">'perry'</span>, age=<span class="number">31</span>, type= <span class="string">'cat'</span>)</span><br><span class="line">print(perry)</span><br><span class="line">print(perry.age)</span><br><span class="line">print(perry._asdict())</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">Animal(name='perry', age=31, type='cat')</span></span><br><span class="line"><span class="string">31</span></span><br><span class="line"><span class="string">OrderedDict([('name', 'perry'), ('age', 31), ('type', 'cat')])</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>一个命名元组（namedtuple）有两个必需参数，即元组名称和字段名称。上述例子元组名称为Animal，字段名称为name，age，type。namedtuple的每个实例没有对象字典，所以很轻量，与普通元组比，不需要更多的内存，使得它比字典更快。</p>
<h2 id="enum-Enum"><a href="#enum-Enum" class="headerlink" title="enum.Enum"></a>enum.Enum</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> namedtuple</span><br><span class="line"><span class="keyword">from</span> enum <span class="keyword">import</span> Enum</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Species</span><span class="params">(Enum)</span>:</span></span><br><span class="line">    cat = <span class="number">1</span></span><br><span class="line">    dog = <span class="number">2</span></span><br><span class="line">    horse = <span class="number">3</span></span><br><span class="line">    aardvark = <span class="number">4</span></span><br><span class="line">    butterfly = <span class="number">5</span></span><br><span class="line">    owl = <span class="number">6</span></span><br><span class="line">    platypus = <span class="number">7</span></span><br><span class="line">    gragon = <span class="number">8</span></span><br><span class="line">    unicorn = <span class="number">9</span></span><br><span class="line">    </span><br><span class="line">Animal = namedtuple(<span class="string">'Animal'</span>,<span class="string">'name age type'</span>)</span><br><span class="line">perry = Animal(name = <span class="string">'perry'</span>, age = <span class="number">31</span>, type = Species.cat)</span><br><span class="line">tome = Animal(name = <span class="string">'tome'</span>, age = <span class="number">75</span>, type = Species.gragon)</span><br></pre></td></tr></table></figure>
<h2 id="枚举（Enumerate）"><a href="#枚举（Enumerate）" class="headerlink" title="枚举（Enumerate）"></a>枚举（Enumerate）</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">some_list = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]</span><br><span class="line"><span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(some_list):</span><br><span class="line">    print(index, value)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">0 a</span></span><br><span class="line"><span class="string">1 b</span></span><br><span class="line"><span class="string">2 c</span></span><br><span class="line"><span class="string">3 d</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<p>enumerate接受可选参数，允许我们定制从哪个数字开始枚举。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">some_list = [<span class="string">'a'</span>,<span class="string">'b'</span>,<span class="string">'c'</span>,<span class="string">'d'</span>]</span><br><span class="line"><span class="keyword">for</span> index, value <span class="keyword">in</span> enumerate(some_list,<span class="number">2</span>):</span><br><span class="line">    print(index, value)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">2 a</span></span><br><span class="line"><span class="string">3 b</span></span><br><span class="line"><span class="string">4 c</span></span><br><span class="line"><span class="string">5 d</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="推导式（Comprehensions）"><a href="#推导式（Comprehensions）" class="headerlink" title="推导式（Comprehensions）"></a>推导式（Comprehensions）</h1><h2 id="列表推导式"><a href="#列表推导式" class="headerlink" title="列表推导式"></a>列表推导式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">multiples = [i <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">30</span>) <span class="keyword">if</span> i % <span class="number">3</span> == <span class="number">0</span>]</span><br><span class="line">print(multiples)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[0, 3, 6, 9, 12, 15, 18, 21, 24, 27]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="字典推导式"><a href="#字典推导式" class="headerlink" title="字典推导式"></a>字典推导式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">mcase = &#123;<span class="string">'a'</span>:<span class="number">10</span>,<span class="string">'b'</span>:<span class="number">34</span>,<span class="string">'A'</span>:<span class="number">7</span>,<span class="string">'Z'</span>:<span class="number">3</span>&#125;</span><br><span class="line">mcase_frequency = &#123;</span><br><span class="line">    k.lower():mcase.get(k.lower(),<span class="number">0</span>)+mcase.get(k.upper(),<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">for</span> k <span class="keyword">in</span> mcase.keys()</span><br><span class="line">&#125;</span><br><span class="line">print(mcase_frequency)</span><br><span class="line">print(&#123;v:k <span class="keyword">for</span> k,v <span class="keyword">in</span> mcase.items()&#125;)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">&#123;'a': 17, 'b': 34, 'z': 3&#125;</span></span><br><span class="line"><span class="string">&#123;10: 'a', 34: 'b', 7: 'A', 3: 'Z'&#125;</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h2 id="集合推导式"><a href="#集合推导式" class="headerlink" title="集合推导式"></a>集合推导式</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">squared = &#123;x ** <span class="number">2</span> <span class="keyword">for</span> x <span class="keyword">in</span> [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>]&#125;</span><br><span class="line">print(squared)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[1,4,9]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="异常-amp-finally"><a href="#异常-amp-finally" class="headerlink" title="异常&amp;finally"></a>异常&amp;finally</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    file = open(<span class="string">'test.txt'</span>,<span class="string">'rb'</span>)</span><br><span class="line"><span class="keyword">except</span> EOFError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'an eoferror occured'</span>)</span><br><span class="line">    <span class="keyword">raise</span> e</span><br><span class="line"><span class="keyword">except</span> IOError <span class="keyword">as</span> e:</span><br><span class="line">    print(<span class="string">'an error occured'</span>)</span><br><span class="line">    <span class="keyword">raise</span> e</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    print(<span class="string">'exception'</span>)</span><br><span class="line">    <span class="keyword">raise</span> </span><br><span class="line"><span class="keyword">finally</span>：</span><br><span class="line">		print(<span class="string">'exit'</span>)</span><br></pre></td></tr></table></figure>
<h1 id="try-else"><a href="#try-else" class="headerlink" title="try/else"></a>try/else</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    print(<span class="string">'there may occur exceptions'</span>)</span><br><span class="line"><span class="keyword">except</span> Exception:</span><br><span class="line">    print(<span class="string">'exception'</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'this would run if no exception occurs. And an error would not be caught here'</span>)</span><br><span class="line"><span class="keyword">finally</span>:</span><br><span class="line">    print(<span class="string">'this would be printed in every case'</span>)</span><br></pre></td></tr></table></figure>
<h1 id="lambda表达式"><a href="#lambda表达式" class="headerlink" title="lambda表达式"></a>lambda表达式</h1><h2 id="规范-1"><a href="#规范-1" class="headerlink" title="规范"></a>规范</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">lambda 参数:操作(参数)</span><br></pre></td></tr></table></figure>
<h2 id="应用-1"><a href="#应用-1" class="headerlink" title="应用"></a>应用</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">add = <span class="keyword">lambda</span> x,y : x+y</span><br><span class="line">print(add(<span class="number">3</span>,<span class="number">5</span>))</span><br><span class="line"></span><br><span class="line">items = [(<span class="number">1</span>,<span class="number">2</span>),(<span class="number">4</span>,<span class="number">1</span>),(<span class="number">9</span>,<span class="number">10</span>),(<span class="number">13</span>,<span class="number">-3</span>)]</span><br><span class="line">items.sort(key=<span class="keyword">lambda</span> x:x[<span class="number">1</span>])</span><br><span class="line">print(items)</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">8</span></span><br><span class="line"><span class="string">[(13, -3), (4, 1), (1, 2), (9, 10)]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="列表辗平l"><a href="#列表辗平l" class="headerlink" title="列表辗平l"></a>列表辗平l</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> chain</span><br><span class="line">a_list = [[<span class="number">1</span>,<span class="number">2</span>],[<span class="number">3</span>],[<span class="number">4</span>,<span class="number">5</span>]]</span><br><span class="line">print(list(chain.from_iterable(a_list)))</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">[1, 2, 3, 4, 5]</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>
<h1 id="open函数"><a href="#open函数" class="headerlink" title="open函数"></a>open函数</h1><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">with</span> open(<span class="string">'out.log'</span>,<span class="string">'r'</span>) <span class="keyword">as</span> f:</span><br><span class="line">		print(f.readlines())</span><br><span class="line"><span class="string">'''</span></span><br><span class="line"><span class="string">['func1was called\n', 'func was called\n']</span></span><br><span class="line"><span class="string">'''</span></span><br></pre></td></tr></table></figure>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2019</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2019/05/30/python进阶/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-从比特币到以太坊：下" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2019/05/26/从比特币到以太坊：下/">从比特币到以太坊：下</a>
    </h1>
  

        
        <a href="/study.github.io/2019/05/26/从比特币到以太坊：下/" class="archive-article-date">
  	<time datetime="2019-05-26T15:39:53.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-05-26</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<p>[TOC]</p>
<p>#以太坊是什么</p>
<p>##下一代的智能合约和去中心化应用程序平台（A Next-Generation Smart Contract and Decentralized Application Platform）</p>
<p>与比特币白皮书的标题一样，以太坊白皮书的标题同样已经很明确地定义了什么是以太坊: “下一代的智能合约和去中心化应用程序平台”，这就是以太坊。当然，这个定义里实际上 引入了两个新的概念——智能合约和去中心化应用程序，所以我必须要先介绍一下这两个概念。</p>
<p>##什么是智能合约</p>
<p>智能合约(Smart Contract)这个词最初是由一位美国的计算机科学博士尼克萨博(Nick Szabo)在他 1997 年发表的一篇论文中提出来的。智能合约指的是一种基于计算机技术实现的，可以免除人工干预而自动执行、自动校验、自动基于外部指令给出回应的具有交互性或者互操作性的合约;其本质是一种计算机程序。这个概念本身相对比较抽象，所以尼克萨博本人在后来的一些访谈中曾经用自动取款机或者自动售货机来作为智能合约的物理实例; 它们就是基于某些公开的、众所周知的规则，能够根据用户的指令和实际业务数据的状态给出可预期的回应的这样一种应用程序。</p>
<p>比如我们去自动售货机购买某种商品，我们先要选择商品和购买数量，如果自动售货机中库存不足，它应该会给出相应的提示;如果库存充足，它会提示用户进行实际支付，比如用现金或者电子支付;如果支付金额不足，它会给出提示，并继续等待，直到支付金额足够或者用户取消交易;如果支付金额足够，它们就会吐出正确数量的商品，并进行找零。自动售货机在这整个过程中对用户操作的响应应该是确定的、可预测的、可自动完成的，当然也应该 是正确的。那么能够基于实际情况给出这些正确响应的程序，就可以认为是智能合约。</p>
<p>当然，其实这个过程并不“智能”，从某种意义讲，也并不是“合约”。所以这个词从其诞生开始就有一些争议，尤其是它会给一些不明所以的用户某种程度的误解。从本质来看，所谓 “智能合约”实际上只是一种可以基于某种状态数据自动给出回应的应用程序而已。不过出于历史原因，“智能合约”的叫法还是被业内接受并延用了下来。</p>
<p>##智能合约有什么用</p>
<p>首先是一个租房合约的例子。比如我和房东订立了一个租房合约，约定我每月付给房东 1000 元房租，合约期限为一年。在没有智能合约的情况下，这个合约的履行是需要很多人工介入的，我付钱的动作必须由我主动完成;如果出现意外情况，也需要第三方的介入才能解决，比如中介机构的居间调停乃至民事诉讼、强制执行等等。而如果有一种无需信任的智能合约平台，这整个过程就可以变为下面这样:</p>
<p>我和房东可以在某个智能合约平台上订立一个智能合约，创建合约的时候，我将一年的租金锁定到合约里，然后从订立合约开始，每经过一个月，房东可以从合约中提取一个月的租金，直到合约期限完结或者经双方确认中止合约，合约自动给我退回剩余未支付的租金。这样的场景是可以在像以太坊这样的智能合约平台上简单实现的，这整个过程无需任何第三方介入，并且可以保证执行的过程严格按照约定的条件完成。</p>
<p>请注意，这个过程是“无需信任(trustless)”的。也就是合约双方不需要相互认识乃至相互信任，而是基于一种不可篡改、不可抵赖、不可逆转的自动化的技术方案保证了整个过程的可信性，同时不需要任何第三方的介入。这就是智能合约带来的最重要的特性。</p>
<p>当然，这个例子中的一些细节是和我们普遍采用的人工处理方式有差异的:比如我要支付的 一年的租金是需要在订立合约时就要锁定到合约里的，而不是可以像人工操作的方式那样每月提供;又比如要中止合约时是需要双方确认的，如果有一方故意不进行确认，那么合约会被锁死，这需要事先考虑到，并在合约中设计相应的解决方法。不过即使存在实操上的差异，这种自动化的、不可抵赖的智能合约选项依然称得上是一种进步。</p>
<p>第二个例子是一个简单的保险。比如某地区的一个农民可以与某保险公司订立一份合约，合约条款大概可以是这样:该农民于今年 6 月 30 日前支付 x 元保险费给保险公司;如果今 年 7 月到 9 月某地区的平均降雨量不足 100 毫米，则农民可以在 9 月 30 日之后得到 y 元的保险赔偿;否则无需赔偿。</p>
<p>这个保险，同样可以用像以太坊这样的智能合约平台简单地实现:农民和保险公司可以在 6 月 30 日之前订立合约，农民将 x 元、保险公司将 y 元同时锁定到这个合约中;在 9 月 30 日之后，农民或者保险公司都可以向合约申请执行;合约可以自动从无利益关系的第三方公共服务(比如气象台网站)获取 7 月到 9 月的降水量信息;如果降水量低于 100 毫 米，则将 x + y 元支付给农民，反之则将 x + y 元支付给保险公司。这整个过程同样无需 人工介入，可以基于智能合约自动完成。</p>
<p>在这两个例子里，我们看到智能合约其实是提供了一种“无需信任”的“点对点”的自动化交互特性，这与我们在先前看到的比特币系统中所实现的无需中介机构就能完成的“点对点” 电子现金交易是不是很像呢?没错，所谓智能合约平台，就是将类似于比特币系统这样的 “点对点”状态转换进行了泛化和抽象，将一些可以由用户自定义的“状态变动”保存到基于点对点网络的时间戳服务器上来实现的;简单地说，也就是将泛化的状态变动保存到区块链上来实现的。这就是以太坊所实现的一种通用的基础设施服务，基于这种服务，我们就可以很简单地构建自定义的智能合约。</p>
<p>从逻辑概念上看，智能合约可以理解为一种会经过点对点网络“全网公证”的状态存储和状态转换(也就是程序执行)，以此来确保这个过程“无需信任”。</p>
<p>##去中心化应用程序又是什么</p>
<p>在理解了智能合约的概念之后，再来理解去中心化应用程序就比较容易了。</p>
<p>目前的绝大多数 Web 应用，其用户数据都是保存在由某个公司、组织或者个人控制的“服务器”或者“服务器组”之中的，这些应用中的绝大部分业务计算，也是由这些服务器或者服务器组来提供的;所以这种模式，可以认为是一种“中心化(centralized)”的模式。</p>
<p>那么“去中心化应用程序(Decentralized Application)”，也就是将数据保存到类似于“点对点的时间戳服务器(即区块链)”这样的，并不是保存到由中心化的公司或组织控制的服务中，并且由这样的“去中心化”服务来提供具体的业务数据计算能力的一种应用程序。“去中心化应用程序”也可以简单地理解为是基于智能合约进行状态追踪和计算的一种应用程序。</p>
<p>当然，对于一个应用程序来讲，并不是所有运算都需要用智能合约来实现，通常也不应该这样设计;而是应该根据业务需求，将那些需要做“全网公证”的状态计算在智能合约中实现， 来使应用程序获得某些“无需信任”的可信性。</p>
<h1 id="以太坊协议概要"><a href="#以太坊协议概要" class="headerlink" title="以太坊协议概要"></a>以太坊协议概要</h1><p>##以太坊的诞生</p>
<p>与比特币不同，以太坊白皮书的作者不是匿名的，它的初稿是由 Vitalik Buterin 于 2013 年底完成的。Vitalik 在 1994 年出生于俄罗斯，后来随父母移居加拿大，在写出以太坊白皮书的时候，他只有 19 岁，刚刚从滑铁卢大学大一辍学。不过，在他写出以太坊白皮书之前， 他已经是一个知名的比特币研究者和写作者了，他也是在 2011 年创刊的世界上第一个加密货币期刊——Bitcoin Magazine 的联合创始人。可以说，以太坊白皮书并不是像比特币白皮书那样“凭空出现的”。Vitalik 本人从 2013 年下半年就开始思考如何对比特币系统进行扩展和改进来支持“通用目的”的计算任务。</p>
<p>2013 年 12 月，Vitalik 完成了以太坊白皮书，并在小范围内进行了分享，引起了一些业内人士的关注，其中就包括了“精通比特币(Mastering Bitcoin)”一书的作者 Andreas M.Antonopoulos，但他当时在忙于写作精通比特币，所以并未直接参与以太坊创建初期的具体 工作。真正在工程上帮助 Vitalik 实现了以太坊这个伟大构想的则是 Gavin Wood 博士。</p>
<p>Gavin Wood 博士是英国约克大学(University of York)的计算机科学博士，在以太坊项目最初的两年里，他是在工程上贡献最大的人:他于 2014 年 1 月完成了以太坊的 PoC-1(即第一个概念验证程序，也是以太坊的 C++ 客户端的最初原型);随后在 3 月发表了以太坊黄皮书(即以太坊协议的细节说明和技术手册，是实现以太坊客户端的基础技术资料，在工程上具有极其重要的指导意义，它也是我们后续章节介绍以太坊协议技术细节的主要参考资料);同年 8 月，他公布了专门为智能合约开发而设计的高级语言 Solidity。</p>
<p>2015 年 7 月 30 日，以太坊主网正式上线，创世区块产生，世界上第一个成功的公共智能合约平台才真正诞生。</p>
<p>以太坊的开创意义在于:它借鉴了由比特币系统创造出来的“通过工作量证明算法达成共识的、基于点对点网络的时间戳服务器”(也就是所谓的“区块链”)，构建出了一种可以执行 “通用目的”的计算任务的基础设施，将“区块链”的可编程性提升到了一个新的高度;创造出了真正的“智能合约”平台。</p>
<p>##区块链范式</p>
<p>从技术层面讲，我们可以把类似于比特币这样的、通过分布式共识进行“公证”的公共账本系统(也就是所谓的“区块链”)抽象地理解为一个“状态转换系统(state transition system)”。 这种系统会维持一个“全局的状态”(我们用 S 来表示)，然后通过系统中发生的“交易” (我们用 tx 来表示)来进行相应的状态转换以达到一个“新的全局状态”(我们用 S’来表示)。那么这种状态转换就可以抽象地表示为:Apply(S, tx) = S’。 下图是比特币中的状态转换示意:</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/26/从比特币到以太坊：下/比特币状态转换示意.png" alt="比特币状态转换示意">         </p>
<p>图中用 &lt;txid&gt;:&lt;output_index&gt; 的形式来表示某个 UTXO:其中 txid 即交易哈希，用来标识某个具体的交易;output_index 即交易生成的输出(UTXO)的索引。</p>
<p>如上图所示，比特币中的交易会消耗/使用若干 UTXO，并通过合并和拆分来生成等量的新的 UTXO。上图中的实例就是通过 7b53ab84 这个交易的第 1 个输出和 3ce6f712 这个交易的第 2 个输出来生成了 3 个新的 UTXO，即 bb75a980 这个交易(也就是上图中这个 交易)的输出 0、1 和 2。于是，系统整体的状态，就从 5 个 UTXO 变为了 6 个 UTXO。</p>
<p>所以，比特币系统其实就是一个对当前系统中所有可用的 UTXO 的状态记录，它通过一个具体交易来对当前可用的若干 UTXO 进行合并和拆分来生成新的 UTXO，并将系统状态转换为新的 UTXO 集合;同时，这个过程是在一个点对点对等网络中进行“全网公证”的。</p>
<p>考虑到像比特币这样的“区块链”系统是以区块为单位来打包记录交易的，我们其实已经可以对“区块链”下一个技术上的定义了:“区块链”，其实就是一个通过交易来触发状态变动， 并以区块为单位来记录状态变动的状态转换系统。这也就是所谓的“区块链范式(blockchain paradigm)”。</p>
<p>请注意，这是一个通用的范式，它适用于比特币，也适用于以太坊，并且同样适用于其他类似于比特币和以太坊这样的基于“区块链”的分布式共识账本系统。而不同的区块链系统的差别就在于如何表示系统中的状态以及如何定义状态转换函数(也就是交易)。</p>
<p>那么，对于目标是要实现一个“智能合约平台”的以太坊来讲，使用比特币的 UTXO 模型来保存系统状态和构造交易数据可行么?</p>
<p>##以太坊的“账户模型”和“存储”</p>
<p>在上一讲中我们已经知道，智能合约其实可以看作是一种用于记录和修改“状态”的应用程序。从计算机科学的角度来看，这其实就是“状态机(state machine)”。每个智能合约，都可以看作是一个自定义的状态机。那么对于“智能合约平台”而言，最关键的特性就是允许用户自定义状态机，同时保证这些自定义状态机可以自动地、正确地、不可篡改地执行，且执行过程应该被进行“技术公证”，以此来保证合约参与方之间“无需信任”。</p>
<p>很明显，“技术公证”的问题已经被比特币解决了:我们只需要把所有自定义状态机的状态数据保存到区块链上，通过工作量证明算法达成共识，实际上就实现了对自定义状态数据的 “全网公证”。但是，如何将“自定义状态”保存到区块链上呢?比特币的 UTXO 模型能够做到么?</p>
<p>简单地说，参考业内到目前为止的研究和工程实践成果，基于 UTXO 模型来保存自定义状态数据大概是可行的，但相对而言会非常复杂，或者需要一些特殊的简化或限制。(因为篇幅原因，这里不做详细解释了)所以以太坊采用了简单直接的“账户模型(account model)”，这与我们已经非常熟悉的大部分中心化软件系统中所使用的数据模型非常相似。</p>
<p>在以太坊的账户模型中，用“地址(address)”来作为账户的全局唯一标识，将自定义状态数据与地址进行绑定来实现快速查找、增删和修改;这种思路就像我们在传统的业务系统中所使用的账户数据模型那样，通过唯一的用户账户标识来关联所有业务数据。这可以说是 一种为了实现通用应用平台而进行的工程上的设计妥协和技术简化。</p>
<p>在账户模型中，每个账户都有一个表示其可用“余额(balance)”的字段，来记录其以太币 (以太坊协议中的代币)数量。而在比特币系统中，一个所谓的“账户”是可以持有(使用) 多个 UTXO 的，我们在客户端或者钱包中看到的“账户余额”实际上是这个账户持有的(可以使用的)所有 UTXO 的比特币数量之和。比特币中的交易是对可用 UTXO 的合并和拆分， 而不是像账户模型这样直接对余额数值进行增减。</p>
<p>以太坊中的“账户”，逻辑上分为两种:EOA(External Owned Account，即由外部用户基于椭圆曲线数字签名的私钥控制的账户)和 Contract Account(即合约账户)。从基础数据上看，这两种账户是一样的(下一讲会具体介绍)，它们的区别仅在于账户是否与合约代码相关联:如果一个账户没有关联代码，它就是 EOA;否则它就是合约账户。</p>
<p>我们应该注意到，对于自定义状态机来讲，需要持久化保存的应该是自定义状态数据和用来修改状态数据的可执行代码，这其实就是所谓的合约状态和合约代码。对于智能合约平台来讲，必须能够持久化地保存这两种数据。基于账户模型，以太坊使用了一个全局的数据结构来保存所有的合约状态和合约代码。因为合约是可以由用户自定义的，所以保存这些数据的数据结构必须是可以进行高效的动态查找、增删和修改的，并且是可以进行简单验证的。以太坊中就使用了 Merkle Patricia Tree(简称 MPT 或者 trie)来实现这一点。</p>
<p>MPT 与比特币系统使用的 Merkle Tree 类似:任意叶节点数据的变动都会导致根节点哈希的变动，所以根节点哈希可以用来标识树中所有数据的某个特定的版本。基于这个原理，就可以在点对点网络的参与者之间通过由各个客户端分别维护的一个全局 MPT 的根节点哈希来验证所有自定义状态数据、账户余额和所有代码数据的版本一致性。这个全局的 MPT 也就是以太坊的“状态树(state tree)”，它的根节点哈希代表了以太坊中所有账户数据的某个特定版本，也就是所谓的“世界状态(world state)”。</p>
<p>以太坊中用来保存所有自定义状态数据的全局 MPT 被称为“存储(storage)”，它是独立于 “状态树”之外的另一个全局 MPT，但因为其根节点哈希是作为账户数据的一个字段来保存的，所以它实际上也是“状态树”的一部分。</p>
<p>以太坊中的每个合约账户都可以在“存储”中使用若干“存储单元(storage slot)”:每个合约的代码中可以自定义若干状态数据，每个状态数据可以对应一个或多个“存储单元”;这 些存储单元都可以通过简单的寻址算法进行存取。这就是以太坊的持久化数据存储方案。 (后续的章节中会有更多关于“状态树”和“存储”的技术细节介绍。)</p>
<p>##以太坊中的“状态转换”</p>
<p>基于“账户模型”和“存储”，以太坊中的状态转换自然也就有了不同的形式。下图是以太坊中的状态转换示意:</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/26/从比特币到以太坊：下/以太坊状态转换示意.png" alt="以太坊状态转换示意">     </p>
<p>图中演示了以太坊中的一个由交易引发的状态转换:在初始状态 State 中，14c5f8ba、 bb75a980、892bf92f 和 4096ad65 代表了 4 个账户地址，其中 14c5f8ba 和 4096ad65 是 EOA，bb75a980 和 892bf92f 则为合约账户(因为有关联代码)。然后图中所示的交易，其逻辑意义也很简单，即从 14c5f8ba 向 bb75a980 发送了 10 以太币，并附加了一些额外的数据 Data，这个 Data 数据的意思是将目标合约的第 2 个“存储单元”的数值设定为 “CHARLIE”。这个交易的执行会产生一个新的状态 State’，其中 14c5f8ba 地址的余额减少了 10 以太币，bb75a980 地址的余额增加了 10 以太币，并且 bb75a980 地址的第 2 个“存储单元”的数值变为了“CHARLIE”。</p>
<p>很明显，因为基础数据模型的改动，以太坊中的状态转换与比特币中的状态转换几乎完全不同。与之相应地，构造交易、验证数据等等的逻辑自然也会完全不同。当然，这里只是一个示意介绍，实际上在以太坊的交易中附加的 data 是一种“可执行代码”，是可以由用户自 定义的，用户可以用这些具体的代码来执行任意的计算任务;这种方式和在比特币交易的输入和输出中附加脚本代码是类似的。</p>
<p>##以太坊中的“可执行代码”</p>
<p>在以太坊协议中，我们可以在交易的 data 字段中附加一种特殊的“可执行代码”来完成任意的计算任务，这种“可执行代码”是在一个虚拟的执行环境中运行的。与比特币脚本系统的执行环境类似，以太坊的这种虚拟执行环境也是基于“栈(stack)”的;但以太坊的虚拟执行环境还提供了可以供应用程序在运行时使用的临时存储空间“内存(memory)”和刚刚介绍过的永久存储机制“存储(storage)”。这就使以太坊的虚拟执行环境有了更强的计算能力，更像是一种“虚拟的计算机”，这个虚拟的执行环境就是大名鼎鼎的“以太坊虚拟机 (Ethereum Virtual Machine，简称 EVM)”，EVM 也是以太坊被称为“世界计算机(World Computer)”的由来。</p>
<p>以太坊协议中的这种可以在 EVM 中运行的“可执行代码”就是所谓的“EVM 字节码”。EVM 字节码是以太坊计算能力的根本，这是一种“图灵完备(Turing-complete)”的操作码系统。 以太坊的高级开发语言 Solidity 就可以编译为 EVM 字节码，然后在 EVM 中运行;这种方式与其他编译型的高级语言是类似的，就像 Java 语言和 Java 虚拟机字节码的关系那样。</p>
<p>EVM 字节码的图灵完备性，也是其与比特币的脚本系统相比最大的区别。图灵完备性标志着 EVM 字节码可以用来完成任意的计算任务，同时因为 EVM 中还提供了临时存储机制和永久存储机制，这才使以太坊成为了真正的可以完成“通用目的(general propose)”计算任务的“智能合约平台”。</p>
<p>#以太坊的基础数据结构(上)</p>
<p>##以太币及其计量单位</p>
<p>以太坊中的代币称为“以太币”，通常用 Ether 来表示，缩写为 ETH。其最小计量单位称为 wei，1 以太币(Ether)等于$10^{18}​$wei。</p>
<p>除了 wei 以外，以太币还有如下一些中间计量单位:</p>
<p>● Babbage:$10^{3}$wei，科学标识为 Kilowei 或 femtoether;</p>
<p>● Lovelace:$10^{6}$wei，科学标识为 Megawei 或 picoether;</p>
<p>● Shannon:$10^{9}$wei，科学标识为 Gigawei 或 nanoether;</p>
<p>● Szabo:$10^{12}$wei，科学标识为 Microether 或 micro;</p>
<p>● Finney:$10^{15}$wei，科学标识为 Milliether 或 milli。</p>
<p>##以太坊中的“gas”</p>
<p>在上一讲中，我们已经知道:以太坊就是“区块链”+“以太坊虚拟机”。它本质上是一个与比特币类似的区块链系统，在这个区块链系统的交易数据中，用户可以附加一些可以运行在以太坊虚拟机(简称 EVM)中的“可执行代码”(即 EVM 字节码)来执行任意的计算任务。</p>
<p>EVM 字节码是“图灵完备(Turing-complete)”的，这意味着它可以基于“无限的计算资源” 来运行;但是，在区块链系统中，每个交易都需要在网络中的所有客户端节点上运行，而后才可以通过检查由交易运行结果所引发的状态改动来达成“全网共识”。这种类似于“状态机复制(State machine replication)”的共识方式要求所有客户端节点上的交易执行必须是完全一致的，所以区块链系统在每个客户端节点上都是一种单线程的计算模型。</p>
<p>因此，如果某一个交易需要耗费“无限的计算资源”，且运行在单线程的计算模型中的话， 那么整个区块链系统就将无法再执行后续的其他交易，而变得“不可用”，也就是进入“死锁状态”。所以我们必须设计一种能避免这样的死锁状态的协议机制。这就是以太坊协议中引入“gas”的意义。</p>
<p>以太坊中的“gas”是一种为了避免网络的计算能力被滥用，也就是避免由图灵完备所带来的死锁问题(比如因为无意的或者蓄意的死循环代码所引起的无限的计算资源消耗)而设计的代码执行所消耗的计算量的度量单位。如果把以太坊比作“世界计算机”，那么“gas”就 可以看作是这个“世界计算机”执行计算任务所要消耗的“电”。当然，这个词最初的来源就是其字面的意思，也就是大部分人工机械的动力来源——“汽油”。</p>
<p>##Gas 价格</p>
<p>在以太坊协议中，几乎所有 EVM 字节码都是要消耗 gas 的，也就是说要执行用户附加在交易数据的 data 字段中的代码，是一定是会消耗 gas 的;而以太坊中的 gas 是需要用以太币来购买的。这也就是说，用户需要为他们在交易中指定的“可执行代码”所实际消耗的计算量支付相应的费用。用户购买每单位 gas 的以太币费用就是所谓的“gas 价格 (gasPrice)”。</p>
<p>Gas 价格是一个随着网络中需要打包的交易数量的多寡进行浮动的数值，也就是会基于网络中对 gas 的供需情况动态变化。这种供需情况的波动体现在以太坊客户端节点的“交易池(Transaction Pool)”机制中。</p>
<p>与比特币客户端类似，以太坊客户端中也有“交易池”机制。网络中产生新的交易之后，会广播到全网，矿工节点的客户端程序会把交易数据放入自己本地的“交易池”;矿工会在选择要打包到区块中的交易时优先选择那些“gas 价格”比较高的交易。这样，如果交易池中等待打包的交易很多，那么后续用户在创建交易的时候通常会选择给出相对更高的“gas 价格”来使自己的交易被优先选择，这也就会使网络中的平均“gas 价格”逐渐提高;反之，平均“gas 价格”就会相应降低。</p>
<p>##以太坊中的“地址”</p>
<p>在以太坊协议中，“地址(address)”是作为“账户(account)”的唯一标识存在的。我们已经知道，以太坊中有两类账户:EOA(External Owned Account)和合约账户(Contract Account)。它们都是由一种 160 位的二进制数据来表示的，这种 160 位的二进制数据就是它们的“地址”，通常表示为 20 位十六进制字符。</p>
<p>对于 EOA 来讲，顾名思义，它们都是由外部用户控制的，也就是一个基于“椭圆曲线数字签名算法(Elliptic Curve Digital Signature Algorithm，简称 ECDSA)”随机生成的私钥所控制的账户。如果设 ECDSA 的私钥对应的公钥为 K，则其账户地址就是:$B_{96…255}Keccak256(K)$其中，$B_{96…255}​$ 表示第 96 到第 255 二进制位。所以 EOA 的地址也就是其 ECDSA 公钥的 Keccak256 哈希值的低 160 位数值。</p>
<p>而对于合约账户，其地址的计算稍微复杂一些，后边介绍“合约创建”时会有具体的讲解， 在此暂不做展开。</p>
<p>##MPT 和 RLP</p>
<p>这是两种在以太坊协议中大量应用的基础算法。</p>
<p>MPT，即 Merkle Patricia Tree，通常也用 trie 来指代，因为 trie 是数据结构中“查找树” 的英文术语。在以太坊协议中，MPT 是用来保存大量的“键值对(key-value pair)”数据的基础数据结构，利用其可以通过根节点哈希来表示树中所有数据的版本的这种特性来简化对大量数据的版本验证。</p>
<p>RLP，即“递归长度前缀(Recursive Length Prefix)”，是一种序列化算法(serialization method)， 可以用来对任意结构的二进制数据进行编码。显然，所有需要经过网络传输的数据或需要持久化保存(也就是需要保存到文件中)的数据都是要进行序列化的;所以 RLP 在以太坊协议中也有非常多的应用，包括对交易数据、区块数据、状态数据的序列化以及对很多中间数据的处理。</p>
<p>##以太坊的“账户状态”和“世界状态”</p>
<p>以太坊的数据模型是基于“账户模型(account model)”构建的，其核心就是“账户状态 (account state)”。账户状态数据由 4 个字段组成:</p>
<p>● nonce:对于 EOA，其数值表示由此账户所发出/创建的交易的数量;对于合约账户，其数值表示由此账户所创建的合约账户的数量。</p>
<p>● balance:表示此账户所持有的以太币数量，以 wei 为单位。</p>
<p>● storageRoot:全局唯一的“存储树(StorageTrie，即保存了系统中所有合约账户的“存储”数据的 MPT)”的根节点哈希值。</p>
<p>● codeHash:对于 EOA，其数值为空字符串的 Keccak256 哈希值;对于合约账户，其数值为该账户关联的 EVM 字节码(即合约代码)的 Keccak256 哈希值。</p>
<p>以太坊中所有账户的状态数据是保存在一个全局唯一的 MPT 中的，这就是以太坊的“状态树(StateTrie)”。状态树中保存的键值对数据为 &lt;keccak256(address),RLP(accountState)&gt;， 即以账户地址的 Keccak256 哈希值为键，对应的叶节点数据为上述账户状态数据的 RLP 编码。基于 MPT 的特性，状态树的根节点哈希就可以用来表示状态树中所有数据的特定版本;而状态树中保存的所有地址对应的所有账户状态数据就是所谓的“世界状态(World State)”，是以太坊这个状态机系统的整体状态标识。</p>
<p>##以太坊中的“交易”和“收据”</p>
<p>与比特币系统类似，以太坊中的状态变动同样只能由所谓的“交易(Transaction)”来触发， 但因为以太坊采用了基于“账户”的数据模型，所以其交易数据结构与比特币完全不同。以太坊中的交易数据结构由以下一些字段组成:</p>
<p>● nonce:由交易发送者(EOA 地址)发出的所有交易的数量(包含当前交易)。</p>
<p>● gasPrice:由交易发送者指定的，用于购买那些为执行这个交易花费的每单位 gas 的价格，以 wei 为单位。</p>
<p>● gasLimit:由交易发送者指定的，用于执行这个交易花费的最大 gas 数量。</p>
<p>● to:当前交易的目标地址。</p>
<p>● value:由交易发送者指定的，要转移到目标地址的以太币数量，以 wei 为单位。</p>
<p>● data:由交易发送者指定的任意长度的字节数据，这个字段的数据会按照以太坊协议的规定进行解析执行;它可以是若干 EVM 字节码，也可以是用来指定“要执行的合约代码”的一种特定格式的编码。</p>
<p>● v，r，s:基于椭圆曲线数字签名算法(ECDSA)生成的数字签名的三个组成部分。这种数字签名数据共有 65 字节，其中前 32 字节是 r，33 到 64 字节是 s，65 字节是 v。 而用于生成这种签名的输入数据就是“交易哈希(txHash)”。交易哈希是对交易数据中除了 v、r、s 以外的其他所有字段经过 RLP 编码序列化之后的数据进行 Keccak256 哈希运算所得到的哈希值。基于交易哈希和 v、r、s 数据，就可以通过 ECDSA 恢复用于生成签名数据的私钥所对应的公钥。我们已经知道:以太坊中的地址就是 ECDSA 公钥的低 160 位;所以，交易数据中的 v、r、s 这三个字段实际上就确定了交易发送者的地址。</p>
<p>关于交易的实际执行，尤其是对 data 字段的解析执行，是以太坊协议的核心内容之一，我将在下一讲中再来详细介绍。</p>
<p>与比特币系统类似，以太坊中的交易也是要在以太坊网路中的所有客户端节点上分别执行，并进行相应的数据一致性验证以达成“全网共识”的。这种执行方式也就决定了我们无法像传统的中心化技术那样“实时地”或者“接近实时地”获得交易执行的结果，所以作为一个 “智能合约和去中心化应用平台”，以太坊必须提供一种机制，能让交易和其中所附加的代码的执行结果或自定义信息被外部世界所知晓，从而进行后续处理或响应。以太坊中的“收据(Receipt)”就是为了这个目的而设计的。它包含了以下几个字段:</p>
<p>● gasUsed:当前交易执行实际消耗的 gas 总量。</p>
<p>● logBloom:基于当前交易中产生的所有“日志(log)”数据构造的 Bloom 过滤器，可以用来简单地判断一个自定义数据是否存在于交易日志数据中。</p>
<p>● logs:当前交易中产生的所有日志数据的集合。</p>
<p>● outcome:在以太坊的当前版本(拜占庭版本)中，该字段是当前交易的“状态代码(status code)”，0 表示失败，1 表示成功;在先前的版本中，该字段是当前交易执行结束时的状态树根节点哈希。</p>
<p>以太坊中的每个“交易”执行之后都会生成一个“收据”，收据数据中的所谓“日志”，是由交易中 data 字段所附带的 EVM 字节码或者由交易的 data 字段所指定的合约代码生成的;也就是说，日志是由用户或者开发者自定义的输出数据。</p>
<p>显然，这种可自定义的输出数据特性对于一个“可编程计算平台”而言非常重要，并且也是必须的。有了这种机制，才使所谓的“去中心化应用(DApp)”真正成为可能。</p>
<p>此外，交易的执行是需要交易发送者支付“交易费(Transaction Fee)”的，但交易费的计算逻辑比较复杂，我会在下一讲中再来具体介绍。现在我们只需要知道:这个交易费，最终将从交易发送者地址的余额中扣除，并增加到将此交易打包到合法区块中的矿工所指定的一个地址的余额上。这个逻辑在稍后对区块生成和验证过程的介绍中还会涉及到。 </p>
<p>##以太坊的基础数据结构(下)</p>
<p>##以太坊中的“区块”</p>
<p>与比特币系统类似，以太坊也可以看作是一个以交易触发状态变动，以区块为单位记录状态变动的状态机系统。以太坊中的区块里同样包含了若干交易，不过因为以太坊的数据模型(账户模型)和工作量证明算法(Ethash)都与比特币(UTXO模型)不同，所以其区块结构也完全不同。</p>
<p>以太坊中的“区块(Bloch)”包含了三个部分:区块头(Block Header)、区块中的所有交易数据列表(transaction list)和叔辈区块头列表(ommer header list)。这里边“叔辈区块” 的概念，我稍后再来介绍。我们首先来看看以太坊的区块头数据:</p>
<p>● parentHash:当前区块的前一个区块，也就是父区块的区块头数据的 keccak256 哈希值。</p>
<p>● ommersHash:当前区块的叔辈区块头列表数据的 keccak256 哈希值。</p>
<p>● beneficiary:区块奖励和区块中所有交易的交易费的接收地址。</p>
<p>● stateRoot:当前区块中所有交易执行完成后，且区块奖励和所有交易的交易费发放之后的状态树根节点哈希。</p>
<p>● transactionRoot:由当前区块中所有交易数据组成的“交易树(Transaction Trie)”根节点哈希。</p>
<p>● receipitRoot:由当前区块中所有交易的收据数据组成的“收据树(Receipt Trie)”根节点哈希。</p>
<p>● logsBloom:当前区块中所有交易的收据数据中日志数据的 Bloom过滤器，由所有交易收据数据中的 logBloom 字段按位或计算得到。</p>
<p>● timestamp:当前区块初始化时的 Unix 时间戳。</p>
<p>● difficulty:当前区块的难度值，由前一区块的难度值和当前区块的时间戳一起计算得到。其计算过程相对比较复杂，如果你有兴趣，可以去参考以太坊黄皮书的“4.3.4 Block Header Validity”一节，这里不做具体介绍了。</p>
<p>● number:当前区块的祖先区块数量，也就是我们通常所说的区块号。</p>
<p>● gasLimit:当前区块的所有交易执行所消耗的 gas 总量上限。</p>
<p>● gasUsed:当前区块中所有交易执行所消耗的实际 gas 总量。</p>
<p>● extraData:与当前区块相关的任意字节数据，长度不大于 32 字节。</p>
<p>● mixHash、nonce:这两个字段是基于以太坊的工作量证明算法 Ethash 得到的，用来作为矿工确实进行了一定量的计算尝试的证明。这两个字段的计算过程非常复杂，如果你有兴趣，可以去参考以太坊黄皮书的附录 J，这里不做具体介绍了。但我们需要知道: 这两个字段是基于密码学生成的，就像我在前文介绍的比特币系统使用的那种简单的工作量证明算法中生成的 nonce 那样，以太坊区块头中的 mixHash 和 nonce 也具有生成困难但验证容易的特点，这也是工作量证明算法的一种共同的特性。</p>
<p>以太坊的区块头数据涉及到了以太坊协议中的绝大多数技术细节，其中有几个重要的基本概念需要再单独介绍一下。</p>
<p>##从“区块树”到“区块链”</p>
<p>也许你还记得，我在前文解读比特币白皮书时曾经提到过的，因为工作量证明算法的特性而导致的区块链末端的分叉问题。那么一个分叉的区块链，实际上就成了一个“树”，所以对于用工作量证明算法达成共识的区块链系统而言，它们都需要一个从“区块树”中选择“主分支”的机制，而这个“主分支”也就是所谓的“权威区块链(canoncial blockchain)”。</p>
<p>在比特币系统中，因为其区块时间约 10 分钟，所以它可以忽略网络延迟的影响，而采用简单的“最长链(longest chain)”机制来在分叉的区块链末端选择主分支。(具体细节在本专题的第二讲中有过介绍。)</p>
<p>而作为以太坊这样一个通用的计算平台，10 分钟的区块时间(也就是交易执行时间)显然是不可接受的;所以以太坊中采用了一种特殊的工作量证明算法 Ethash 结合其难度值系统来把区块时间控制在了 15 秒左右。显然，在这样的区块时间下，由于网络延迟造成的客户端节点间对区块链末端数据视图的差异就无法再被忽略了。很可能两个矿工会同时找到符合协议要求的区块数据，而无法立即得知对方找到的区块;所以区块链末端的分叉问题就变成了一种高概率的现象，必须用某种算法来选择合适的分支作为“权威区块链”。</p>
<p>以太坊协议中采用了一种简易的 GHOST(Greedy Heaviest-Observed Sub-Tree)算法来在其区块树末端选择主分支。下图就是一个基于工作量证明算法构造的区块树末端的示意图:</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/26/从比特币到以太坊：下/区块树末端示意图.png" alt="区块树末端示意图">     </p>
<p>在这张示意图中我们可以看到一种因为工作量证明算法所造成的区块链末端的分叉场景。对于同样的分叉情况，在比特币系统中，会基于“最长链”机制选择 5B 区块所在的分支作为主分支;而如果攻击者拥有足够多算力，能够制造出更长的分支(比如图中 6A 区块所在的分支)，那么在比特币系统中，这个分支就可以被选为主分支。而在以太坊协议中，则采用了不同的机制。</p>
<p>首先要解释的就是所谓“叔辈区块(ommer block 或者 uncle block)”的概念。如上图中的 2B、2C 和 2D 这三个区块，它们都是连接在 1B 区块之后的合法区块;也就是说，它们是由三个不同的矿工同时生成的合法区块。在没有确定最终的主分支之前，它们都将被保存，并都可以继续添加后续区块。在这种情况下，这三个区块就互为“兄弟”。对于它们各自的后续区块，它们也就成了所谓的“叔辈区块”。比如对于 3F 区块而言，它的叔辈区块就是 2B 和 2C 区块;同理，对于4B 区块而言，它的叔辈区块就是 3C 和 3E。</p>
<p>因为叔辈区块都是合法区块，所以它们每个区块都需要花费相当的计算量才能生成。而 GHOST 算法则将分支上附带的叔辈区块所消耗的计算量一并算做该分支所包含的计算量，并以此来选择“最重的”(也就是包含了最多计算量的)分支作为主分支。基于这个算法，在计算以下各分支计算量时需要额外累计计算量的区块分别为:</p>
<p>● 5B 区块所在的分支:1A、2B 和 2C 区块;</p>
<p>● 4B 区块所在的分支:1A、2B、2D、3C 和 3E 区块;</p>
<p>● 3B 区块所在的分支:1A、2C 和 2D 区块;</p>
<p>● 6A 区块所在的分支:1B 区块。</p>
<p>所以，“最重的”分支就是 4B 区块所在的分支，它将成为“权威区块链”。</p>
<p>在以太坊协议所采用的简化的 GHOST 算法中会回溯 6 代祖先区块来查找“叔辈区块”， 且仅将距离当前区块最近的最多两个叔辈区块的区块头添加到当前区块的数据中，并将这 最多两个的叔辈区块的区块头数据的哈希值保存到当前区块头的 ommersHash 字段中。基 于这样的算法，包含在以下几个区块中的叔辈区块将是:</p>
<p>● 5B 区块:2B 和 2C 区块;</p>
<p>● 4B 区块:3C 和 3E 区块;</p>
<p>● 3B 区块:2C 和 2D 区块;</p>
<p>● 6A 区块:1B 区块。</p>
<p>在以太坊协议中，为了鼓励更多矿工参与到网络中贡献算力，包含在当前区块中的叔辈区块头中指定的 beneficiary 地址也将获得一定量的以太币作为区块奖励。你稍后会看到相关细节。</p>
<p>##以太坊中的区块生成和验证</p>
<p>以太坊协议中的区块生成和验证的完整过程，其实就是以太坊网络中在各个客户端节点间达成数据共识的过程。这个过程大致如下:</p>
<p>###1.EOA 签发交易</p>
<p>EOA 的持有人构造一个交易数据，即除 v、r 和 s 以外的其他交易数据字段，然后用 EOA 所对应的私钥对交易数据进行签名，生成 v、r 和 s，从而构成一个完整的交易数据。然后将交易数据通过某个以太坊客户端节点的接口(json-rpc 或者 web3 接口) 发送到以太坊网络中。</p>
<p>###2.交易数据的广播</p>
<p>接收到经过 EOA 签发的交易数据的以太坊节点会将此交易数据广播到以太坊网络中， 网络中的矿工节点接收到交易数据之后会将其加入自己本地维护的“交易池”，等待打包到区块中。</p>
<p>###3.矿工打包执行交易</p>
<p>矿工节点从本地维护的“交易池”中选取交易顺序执行，相应地修改本地维护的状态树 (包含存储树)，并生成交易收据，同时生成区块级别的交易树和收据树。反复执行这 个过程，直到执行的所有交易消耗的 gas 总量达到或接近区块的 gasLimit 为止。 注意:这个选取交易的规则是由矿工自主决定的，并没有统一的要求，通常矿工会简单地选取交易池中那些 gasPrice 最高的交易优先执行，以获得最大的收益(交易费)。</p>
<p>###4.发放区块奖励和交易费</p>
<p>矿工将当前区块的区块奖励增加到自己指定的任意地址，并将此地址保存到当前区块头的 beneficiary 字段中。而后，矿工基于本地保存的区块链末端的完整数据找到最多两个叔辈区块，将它们的区块头数据一并作为区块数据，并设定当前区块头中的 ommersHash 字段。同时，叔辈区块头中指定的 beneficiary 地址同样也可以获得区块奖励，但每增加一代祖先，区块奖励减少 1/8;也就是说，与父区块区块号相同的叔辈区块将得到 7/8 的区块奖励， 再早一代，是 6/8，那么可以作为叔辈区块的最早叔辈区块将是 6 代之前的区块，其区块奖励将是 2/8（因此，需要找距离当前区块最近的叔辈区块）。</p>
<p>最后，将所有交易执行的总交易费，增加到当前区块头的 beneficiary 字段所指定的地址余额上。</p>
<p>###5.区块定稿</p>
<p>矿工基于本地执行交易并进行完奖励发放的最终结果来完整构造区块头数据;这是因为某些字段的数值必须要在区块中的所有交易都执行完成且区块奖励和交易费全部发放完成之后才能获得，比如 stateRoot、transactionRoot、receiptRoot、logBloom、 gasUsed。</p>
<p>最后，基于 Ethash 算法获得工作量证明的结果 mixHash 和 nonce，生成完整的区块数据。区块最终定稿。矿工将此合法区块的数据在本地保存并添加到本地维护的完整区块链数据中。</p>
<p>###6.区块数据的广播和验证</p>
<p>矿工本地生成完整的合法区块之后，会将此区块数据广播到网络中。注意，这里广播的仅仅是区块数据，状态树、存储树、交易树、收据树都是由各个客户端节点本地维护的，不会进行网络传输。</p>
<p>其他客户端节点(其他矿工和保存了完整数据的所有“全节点”)接收到区块数据之后会对其进行验证:顺序执行区块中包含的交易列表中的所有交易，并相应修改本地维护的状态树(包含存储树)、生成交易树和收据树;按照区块头指定的 beneficiary 地址进行区块奖励发放和实际交易费发放，给区块中包含的叔辈区块列表中指定的区块头 beneficiary 发放相应的区块奖励。</p>
<p>全部完成之后，比对本地维护的状态树、交易树、收据树的根节点哈希是否与接收到的区块头中给定的 stateRoot、transactionRoot、 receiptRoot 字段值一致;比对本地执行所消耗的总 gas 数量是否与接收到的区块头中给定的 gasUsed 一致;验证区块头中给定的 mixHash 和 nonce 是否一致。如果最终验证成功，则将此区块作为合法区块保存并添加到本地维护的完整区块链数据中。如果验证失败，则将此区块数据丢弃，将本地维护的状态树、存储树恢复为执行此区块中包含的交易之前的状态。</p>
<p>以上就是以太坊中区块的生成和验证的全过程，也是以太坊协议的“共识”过程。</p>
<p>显然，上述过程中第 3 步到第 5 步即区块生成的过程，是仅能由矿工节点完成的。所以如果在这三步的过程中，矿工接收到一个广播来的区块数据，它就需要把自己正在执行的这三步中所做的所有对状态树、存储树的修改撤销，恢复到前一个区块的最终状态。</p>
<p>此外，我刚刚介绍的“从区块树到区块链”的过程其实是在不停发生的，也就是说，区块树中的“主分支”是有可能需要切换的。这就要求客户端节点有一种能够快速切换全局的状态树、存储树数据版本的能力。这个功能是通过所谓的“状态数据库(state database)”来实现的。</p>
<p>状态数据库是以太坊客户端的一个独立功能，它本质上是一个简单的“键值对(key-value pair)”数据库。我们已经知道，MPT 的根节点哈希可以用来作为其中保存的所有数据的版本标识，所以我们只需要把每个区块的最终状态所对应的状态树、存储树的根节点哈希和与此哈希对应的完整数据保存到状态数据库中，即可实现对这两个 MPT 数据状态的快速切换。 在实际工程中，以太坊客户端是用 leveIDB 来实现“状态数据库”的。</p>
<p>#以太坊中的交易执行      </p>
<p>在上一讲中，我们已经了解了以太坊协议中的区块创建和验证的全过程，也就是以太坊协议的共识过程。以太坊中的交易，首先是要在将其打包进区块的那个矿工节点上运行，而后将随区块数据一起被广播到网络中的其他客户端节点上，在其他矿工节点和全节点中再次运行，并以区块为单位验证执行结果。</p>
<p>也就是说，交易是在网络中的所有矿工节点和全节点中分别独立运行并修改由客户端本地独立维护的状态数据的。在本讲中，我就来为你详细介绍一个交易到底是如何在客户端节点上执行的。</p>
<p>##交易的执行过程</p>
<p>在上一讲中我们已经知道了交易数据的基础字段，那么如果用 from 来代表由 v、r、s 所 对应的交易发送者地址的话，交易数据就可以用下面这个元组来表示:</p>
<p>[from, nonce, to, value, gasLimit, gasPrice, data]</p>
<p>这样，一个交易的执行过程，就可以大致描述如下:</p>
<p>###1.有效性验证</p>
<p>a)  交易数据能够严格按照 RLP 编码进行解码，不存在多余的字节数据;</p>
<p>b)  交易中附带的签名数据是有效的，即可以用 v、r、s 恢复出正常的公钥(地址);</p>
<p>c)  交易的 nonce 与交易发送者账户的 nonce 相等;</p>
<p>d)  交易的 gasLimit 不小于执行交易所需的基础 gas 消耗(21000);</p>
<p>e)  交易的 gasLimit 不大于区块的 gasLimit;</p>
<p>f)  交易发送者账户的余额不小于 gasLimit * gasPrice。</p>
<p>###2.不可撤销的状态修改</p>
<p>对于那些通过了有效性验证的交易，会首先进行两个不可撤销的状态修改，不管这个交易最终执行成功还是失败:</p>
<p>a)  交易发送者账户的 nonce 加 1;</p>
<p>b)  从交易发送者账户的余额中扣除 gasLimit * gasPrice。</p>
<p>这个角度讲，实际上并不存在“无效”的交易，所有通过了有效性验证的交易都会产生“状态变动”，也就是会影响“世界状态”，它们的区别仅在于造成状态变动的多寡。</p>
<p>###3.交易的实际执行</p>
<p>交易的实际执行，又可以分为三种情况:</p>
<p>a)  data 字段为空:</p>
<p>也就是交易并未附带任何代码，仅为简单的转账交易，所以只需要对 from 账户和 to 账户的余额进行相应的增减。</p>
<p>b)  data 字段不为空，to 字段为空:</p>
<p>因为 to 字段为空，也就是没有目标地址，所以协议会认为这是“合约创建 (Contract Creation)”交易，data 字段的数据会被作为 EVM 字节码进行执行。 合约创建的具体过程，我稍后再来介绍。</p>
<p>c) data 字段不为空，to 字段也不为空:</p>
<p>因为 to 字段不为空，也就是明确指定了目标地址，所以协议会认为这是“消息调用(Message Call)”;即要调用 to 地址上的某个合约函数。消息调用的具体过程，我也稍后再来介绍。</p>
<p>对于合约创建和消息调用而言，因为执行的都是由用户自定义的程序代码(EVM 代码)，所以这种执行的将有两种结果:如果执行中产生了异常，则该次执行中的所有状态变动都会被撤销;如果执行中没有产生异常，则该次执行中的所有状态变动会就将被永久地保存到世界状态中。</p>
<p>###4.Gas 返还和交易收据生成</p>
<p>a)  对于简单转账交易，没有 gas 返还。对于合约创建和消息调用，在交易附加的代码或者交易指定的合约代码的执行过程中，将可能产生需要“返还”给交易发送者的 gas，这会累加到一个“返还计数”中，并在所有代码执行完成之后计算应该返 还的gas 数量和最终的交易执行 gas 消耗，也就是交易收据中的 gasUsed。这个具体的计算方法我稍后再来介绍。</p>
<p>b)  在代码的执行过程中，特定的 EVM 字节码还能够生成“日志(log)”数据，也就是会被记录到交易收据中的用户自定义日志信息。所以在交易执行完成之后，如果有代码产生了日志信息，则交易收据中的 logBloom 和 logs 会被相应地设定。</p>
<p>c)  如果在合约创建或消息调用过程中合约代码的执行产生了异常，则交易收据中的 outcome 会被置为 0;其他情况，outcome 将为 1，即交易正常结束。</p>
<p>以上就是以太坊中的交易执行过程。可以看到，如果交易数据中的 data 字段不为空，那么这个字段中所给定的数据就将会以合约创建或者消息调用的方式来执行。以太坊中用来执行交易中 data 字段数据的机制就是以太坊虚拟机(下文简称 EVM)，它也是以太坊协议中的所谓“执行模型(Execution Model)”。我将在下一讲中再为你介绍 EVM 的相关技术细节。</p>
<p>##合约创建</p>
<p>目标地址(to)为空，data 字段不为空的交易将被认为是“合约创建”交易。这种交易中的 data 字段的数据会被作为 EVM 字节码来解析执行。因为 EVM 的指令设计中存在可以创建合约的操作码，所以用户实际上可以通过一个交易创建出多个智能合约。为明确起见，我们不妨把由交易直接创建的这个合约称为“主合约”，这个由客户端基于协议的规定直接创建的主合约是唯一的;而由交易中附带的 EVM 字节码创建的若干其他合约，我们就把它们 称为“子合约”，子合约是由用户指定的代码创建的，可以有多个。这里的细节原理，我在下一讲中再来具体介绍。</p>
<p>“合约创建”交易中 data 字段的数据，称为“字节码(bytecode)”，也可以叫做合约创建代码，它是一次性执行的。合约创建代码执行结束之后，会产生一个字节数组作为结果，这个字节数组会被保存到“主合约”账户的地址上，也就是实际的合约代码;而这个由合约创建代码所生成的代码，就叫做“运行时字节码(runtime bytecode)”。所以，合约创建交易中附带的 EVM 代码，实际上是用来生成具体合约代码的代码。</p>
<p>在成熟的面向对象高级开发语言(比如 C++ 和 Java)中，有“构造函数”的概念。这里的 “字节码(合约创建代码)”就可以理解为“构造函数”，但对于智能合约来讲，“构造函数” 并不会永久保存，它们仅存在于合约创建交易中，是一次性的。以太坊的客户端中有一个简单的键值对永久存储机制来保存合约账户地址与合约代码(也就是由合约创建代码所生成的代码)的映射。合约账户的状态数据中的 c􏰀odeHash 字段将保存合约代码的哈希值;因为账户状态是世界状态的组成部分，所以实际上合约代码也是属于世界状态的，是要进行全网共识的。基于目前的协议设计，主合约创建成功之后，其代码就不再能够更改。</p>
<p>由于合约创建交易的目标地址为空，所以客户端在执行这种交易时要做的第一件事就是创建一个新的“合约账户(Contract Account)”。这个新的合约账户的地址和其账户数据字段的初始化规则如下:</p>
<p>● 账户地址:$B_{96…255}(Keccak256(RLP(from, from.nonce-1)))$</p>
<p>● nonce:1</p>
<p>● balance:合约创建交易的 value</p>
<p>● storageRoot:合约创建代码(交易中附加的 data 字段的所有代码)执行完成之后的存储树根节点哈希</p>
<p>● codeHash:合约创建代码执行完成之后所生成的全部合约代码的哈希值</p>
<p>这里需要稍微说明的是新合约账户(也就是主合约)的地址。它是由交易发送者地址和交易发送者账户的 nonce 计算而来的，所以主合约地址是可以预知的，而并不是个随机数。上述的账户地址计算公式中的$ B_{96…255}​$指的是二进制的第 96 到 255 位，也就是 keccak256 哈希值的低160 位。而公式中使用了 from.nonce-1 的原因就是在交易执行的第 2 步中已经对交易发送者账户的 nonce 做了不可撤销的 +1 操作。</p>
<p>在创建完成主合约账户之后，客户端就会生成一个独立的 EVM 实例来具体执行交易中 data 字段的字节数据，也就是执行合约创建代码。合约创建代码通常会对合约的存储进行相应的初始化，所以其执行会影响存储树的状态。如果在合约创建代码执行的过程中产生了任何的异常，那么由这些代码执行所产生的所有状态变动都会被撤销，包括这个新创建的账户。如果合约创建代码全部执行完成时没有发生异常，客户端就会将生成的合约代码永久保存，并将合约代码哈希和此时的存储树根节点哈希保存到主合约账户状态中。合约创建代码可以在交易收据中输出“日志”数据，但如果代码执行中出现异常，交易收据中的日志数据输出也将被撤销。</p>
<p>这里需要特别说明的是:虽然我在这里将由客户端基于合约创建交易直接创建的合约称为 “主合约”，将基于交易中附带的 EVM 代码创建的合约称为“子合约”，但它们并没有本质的不同。“主合约”和“子合约”的区别仅在于:</p>
<p>● 主合约的地址是用签发合约创建交易的 EOA 地址及其账户 nonce 计算而来;子合约的地址则是用主合约的地址及其账户 nonce 计算而来。</p>
<p>● 主合约账户的余额是由合约创建交易的 value 所指定的;子合约账户的余额则是由特定的 EVM 代码所指定的。</p>
<p>除此之外，它们没有任何区别，也没有任何技术上的逻辑关联;它们都是独立存在、独立运作的。</p>
<p>##消息调用</p>
<p>目标地址(to)不为空，data 字段也不为空的交易将被认为是“消息调用”交易。因为合约代码已经在合约创建交易的最后保存到特定地址上了，且无法被更改;所以这里的“消息调用”数据(也就是 data 字段的数据)，并不是可执行代码，而是一种特殊格式的编码，它指明了要调用的具体函数和调用的实际参数。消息调用交易，也就是向客户端指明需要去目标地址上用哪些具体参数去执行哪个合约函数的一种交易。消息调用中使用的这种特殊的编码，叫做 ABI 编码。</p>
<p>ABI 是 Application Binary Interface 的缩写，也就是应用二进制接口，是一种对函数名、函数参数的序列化算法。ABI 编码的完整规则比较复杂，这里不做具体介绍，如果你有兴趣，可以去参考 Solidity 官方文档的 ABI 编码一章。</p>
<p>客户端会基于协议的规定为消息调用交易生成一个“主消息”，它将从消息调用交易所指明的目标地址(to)上获得关联代码，然后按照消息调用交易中附带的 data 字段(也就是 ABI 编码)去查找对应的合约函数，并用 ABI 编码所指定的实际参数去执行找到的合约函数。</p>
<p>这个合约函数是基于目标合约地址的账户状态和存储状态来执行的。因为实际执行的是由用户自定义的 EVM 代码，所以这些代码中可以再次发起的“子消息”调用或创建“子合约”。 刚刚介绍的合约创建交易中合约创建代码的执行，也是一样的情况，同样可以在代码中发起 “子消息”调用或创建“子合约”。这些处理都是由以太坊的“执行模型”(也就是 EVM) 来控制的。我将在下一讲中为你进一步解释这个机制。</p>
<p>##以太坊的 Gas 返还机制</p>
<p>我们已经知道，以太坊是一个通用的计算平台，可以用来解决用户自定义的计算任务，这种计算任务(也就是智能合约)可以认为是一种自定义状态机。那么作为计算平台来讲，就必然要提供持久化保存自定义状态的机制，在以太坊中，就是所谓的“存储(storage)”。存储，是由以太坊网络中的所有矿工节点和全节点来维护的，其状态是要进行全网共识的，所以使用存储是非常昂贵的。在 EVM 的费用设计中，更改存储数据的操作是消耗 gas 最高的操作;也就是说，用户要在存储中持久化保存状态数据，就要支付大量的 gas 使用费。这对于开发者或者最终用户来讲就变成了一种成本负担。</p>
<p>所以从协议设计的角度，以太坊引入了一种平衡机制，在满足特定条件的情况下，可以返还一定量的 gas 来降低交易执行的总 gas 消耗，当然也就降低了实际要支付给矿工的交易费，这就是以太坊的“Gas 返还机制”。</p>
<p>Gas 返还机制同样是基于 EVM 的执行来计算的。在上述的“合约创建”和“消息调用”的过程中，都会执行用户自定义的 EVM 代码。在这些交易的执行过程中，不管合约创建和消息调用代码中出现了多少“子合约创建”和“子消息调用”，客户端都会用一个以交易为单位的“gas 返还计数”来计算 gas 的返还数量。在这些代码的执行过程中，满足以下任意 一个条件，都会获得 gas 返还，并累计到这个交易级别的“gas 返还计数”中:</p>
<p>1.销毁了一个合约账户，即使用 EVM 的 SELFDESTRUCT 指令。</p>
<p>2.将一个合约存储槽清零，即使用 EVM 的 SSTORE 指令将某个存储槽数据置为零。</p>
<p>在一个交易中附加的所有代码，或者由交易指定的合约代码全部执行完成之后，我们会得到交易执行的总 gas 消耗(gc)和 gas 返还计数(ga)。如果用 gr 表示最终会返还给交易 发送者的 gas 数量，则有:</p>
<p>$gr = gasLimit - gc + min(gc/2, ga)$</p>
<p>因为在交易执行的第 2 步已经做了一个不可撤销的状态更改:从交易发送者账户的余额扣除了 $gasLimit<em>gasPrice$，所以在交易执行完成之后会再给交易发送者地址的余额增加 $gr</em> gasPrice$。此外，交易的实际 gas 消耗(也就是交易收据中 gasUsed 字段的数值)就将等于$ gasLimit - gr$。</p>
<p>在上述公式中我们可以看到，除了原始交易中提供的 gasLi􏰁mit 中未使用的 gas 数量以外， 最终返还的 gas 数量中还包含了一个额外的数值，它等于交易执行的总 gas 消耗(gc)的 一半和 gas 返还计数(ga)二者之中较小的那个值。显然，gc 的一半肯定是大于 0 的， 但如果交易执行的过程中没有满足上述两个返还条件的任意一个，那么 ga 就将为 0，就不会得到任何额外的 gas 返还。基于这个公式，要提高 gr，就要去提高 ga 并降低 gc。</p>
<p>我想你应该已经明白了，“Gas 返还机制”的设计意图就是鼓励用户和开发者去销毁不用的合约或者将不再使用的存储槽清零并尽量精简合约代码以获得更多的 gas 返还、降低总体 gas 消耗。</p>
<p>#以太坊的执行模型  </p>
<p>##EVM 概要</p>
<p>顾名思义，EVM 就是一个虚拟的计算机，一个沙盒(Sandbox)，可以用来执行由特定的指令集所构成的代码;它也是以太坊协议的“执行模型”的核心组件。</p>
<p>与真实的计算机类似，EVM 有自己的指令集、运行栈(Stack)、临时存储机制——内存 (memory)和永久存储机制——存储(Storage)。</p>
<p>因为以太坊协议中存在大量的 keccak256 哈希运算，所以 EVM 的“字长”被设计为 256 位，即 EVM 以 32 字节为一个“字(word)”，并以此为单位来进行数据存取。在运行栈、 内存和存储中都是以“字”为基础单位来处理数据的。</p>
<p>EVM 的指令集分为十一大类:</p>
<p>● 停止和算术操作:包含停止、加减乘除、模运算、带符号的除法、带符号的模运算、加法模运算、乘法模运算、乘方以及符号扩展，共 12 个指令。</p>
<p>● 比较和位运算:包含小于、大于、带符号的小于、带符号的大于、等于、算术非、按位与、按位或、按位异或、按位非、字节截取，共 11 个指令。</p>
<p>● 哈希运算:包含 keccak 256 哈希运算一个指令。</p>
<p>● 环境信息:包含了与账户、地址、账户关联代码、消息调用相关的共 15 个指令。</p>
<p>● 区块信息:包含了区块哈希、区块受益人地址、时间戳、区块号、难度和区块 gas 上限共 6 个指令。</p>
<p>● 内存、存储和流程控制:包含了内存读写、存储读写、跳转、条件跳转、程序计数器、获取可用 gas 数量等共 12 个指令。</p>
<p>● 压栈操作:包含了将 1 字节到 32 字节数据压入栈顶的共 32 个指令。</p>
<p>● 复制操作:包含了将栈顶 1 到 16 个元素进行复制的共 16 个指令。</p>
<p>● 交换操作:包含了将栈顶元素与其下的 1 到 16 个元素进行交换的 16 个指令。</p>
<p>● 日志操作:包含了基于 0 到 4 个主题(topic)数据来生成日志数据的共 5 个指令。这里的所谓“主题”就是要参与计算交易收据的 logBloom 字段的日志数据项。</p>
<p>● 系统操作:包含了 CREATE、CALL、CALLCODE、RETURN、DELEGATECALL、STATICCALL、 REVERT、INVALID、SELFDESTRUCT 共 9 个指令。这里单独列出原始的指令助记符是 因为这些指令都非常重要，我稍后的讲解将会涉及到其中的一些指令;这里暂不解释它们的具体意义。</p>
<p>完整的 EVM 指令设计你可以参考以太坊黄皮书的附录 H，这里不做详细罗列了。</p>
<p>显然，与前文中介绍过的比特币的脚本系统相比，EVM 的指令集更像是一个能解决通用计算任务的“虚拟计算机”所应该有的指令集。而这个指令集就是我们可以通过编写智能合约程序来使用的所有计算能力，也就是我们能用以太坊来做的所有事情。从 EVM 的指令集设计可以看到，以太坊能完成的计算任务其实还是有限的，尤其是如果我们将它与其它成熟的带有虚拟机机制的可编程模型(比如 Java 语言的执行环境——JVM)相比的话。</p>
<p>从 EVM 的指令设计中我们还可以看到:EVM 没有网络通信的能力，不能产生随机数，也没有与外部世界或宿主物理计算机主动进行交互的能力。这些都是以太坊和智能合约明显的技术局限;但这种局限，实际上是出于区块链这样的分布式共识系统对于计算结果的确定性要求，所以它并不是设计缺陷，而是一种技术性的“副作用”。在下一讲中我也会再解释一下这个问题，并简单介绍相关的解决方案。</p>
<p>##以太坊的“执行模型”</p>
<p>以太坊的“执行模型”中最重要的概念就是“消息(Message)”。这个所谓的“消息”，也就是在上一讲中介绍的“消息调用”中的消息。以太坊的执行模型是由“消息”来驱动的，要产生一个“消息”只有两种方式:</p>
<p>1.通过一个“合约创建”交易或者“消息调用”交易可以产生一个会基于执行模型来执行 的“消息”，逻辑上的过程就像我在上一讲中介绍的那样。</p>
<p>2.通过特定的几个 EVM 指令，具体来说，就是 CREATE、CALL、CALLCODE、 DELEGATECALL 和 STATICCALL 这 5 个指令，也可以产生一个会基于执行模型来执行的“消息”。其中CREATE 指令对应“合约创建”(在以太坊最新的君士坦􏰇堡版本中， 增加了 CREATE2 指令，它和 CREATE 指令的功能是类似的，同样也会创建一个新合 约);CALL、CALLCODE、DELEGATECALL 和 STATICCALL 指令对应了四种“消息调用” (它们的区别比较复杂，需要更多的技术解释，这里不再展开了)。</p>
<p>从逻辑上讲，通过第一种方式产生的消息，可以理解为“主消息”。因为它只能由 EOA 签发的一个交易来产生，也就是只能由外部用户通过自己掌握的私钥签发一个具体的交易来主动触发。所以在一个交易的执行过程中，“主消息”只会有唯一的一个。</p>
<p>而通过第二种方式产生的消息，则可以理解为“子消息”。因为它们是由具体的 EVM 指令所产生的，并且可以在“子消息”的执行过程中，再通过上述几个特定的指令继续产生“子消息”，以此类推。所以在一个交易的执行过程中，是可以产生多个“子消息”的。</p>
<p>这种机制使以太坊的执行模型体现为一个链式的“消息”模型。于是，在上一讲中介绍的“合约创建”和“消息调用”的过程本质上都是通过创建一个“主消息”来具体执行的，它们的区别仅在于如何构造/初始化这个“主消息”数据和如何处理其执行结果。</p>
<p>下面的示意图更清晰地展示了以太坊中执行模型的运作机制:</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/26/从比特币到以太坊：下/以太坊执行模型.png" alt="以太坊执行模型">     </p>
<p>图中的实线表示必然发生的情况，虚线表示可能发生的情况，并用数字和单向箭头标注了产生子消息时的处理流程顺序样例。注意这整个执行过程都是基于实际代码顺序进行的，并不存在“并行”执行的情况。此外需要再次强调:图中的主消息是通过“合约创建”交易或“消息调用”交易产生的，是必定会进行的过程;而所有子消息都是通过 EVM 指令产生的，第一列子消息是由主消息中运行的具体代码决定的，其后每列子消息则由其前一列子消息中运行的具体代码决定。</p>
<p>以太坊中的每个消息执行都会产生特定的输出结果:</p>
<p>● 主消息的输出结果是客户端基于协议规定直接处理的:对于合约创建而言，将会把新的智能合约的运行时代码保存到世界状态中，并更新合约账户的状态数据;而对于消息调用，将没有其他额外操作(这是因为主消息的输出并不是由用户自定义的合约代码来处理的，所以即使具体调用的合约函数有返回值，这个返回值也无法被用户程序处理，只能丢弃)。</p>
<p>● 对于子消息而言，如果它是由 CREATE 指令所创建，则相应的新账户状态和新合约代码将直接更新到世界状态中;如果它是由 CALL、CALLCODE、DELEGATECALL 或 STATICCALL 指令所创建，则实际调用的合约函数的执行结果将可以返回到调用者消息 中，由调用者消息中的后续代码进行处理。</p>
<p>于是，从交易的维度看，一个“合约创建”交易或者“消息调用”交易的执行结果都可能会是修改了多个账户的状态或者创建出了多个新合约，它们的区别仅在于主消息本身是否会直接创建出一个新合约，也就是仅区别于如何构造主消息和如何进行主消息的后处理。</p>
<p>最后，主消息的后处理大概会包含以下几个工作:</p>
<p>● 如果当前是“合约创建”交易，则将主消息执行产生的新合约的代码保存，并更新主消息对应的新合约地址的账户状态。</p>
<p>● 将主消息执行过程中销毁的所有合约的状态数据(包括存储)实际清除。要销毁的合约地址是个列表，包含了那些在主消息和所有子消息执行过程中用 SELFDESTRUCT 指令指定的合约地址和用 CREATE 指令创建但创建代码中产生了异常导致创建失败的合约 地址。</p>
<p>● 将主消息执行过程中产生的所有日志数据保存到交易收据中，并生成交易收据的logBloom 字段。</p>
<p>● 计算当前主消息执行的实际 gas 消耗(结合上一讲中介绍的 gas 返还机制)，保存到交易收据的 gasUsed 字段，并根据主消息执行结果设置交易收据的 outcome 字段。</p>
<p>以上就是以太坊“执行模型”的基本原理。下面我们来看看 EVM 在执行模型中具体扮演了什么角色。</p>
<p>##EVM 和“消息”的执行</p>
<p>以太坊中“消息”的执行是通过 EVM 来实现的。每个消息(不管是主消息还是子消息)都会初始化一个独立的 EVM 实例;然后这个 EVM 实例会执行初始化它的消息中所指定的 EVM 代码。</p>
<p>每个 EVM 实例都有自己的“内存”，内存是一个简单的一维字节数组。内存中的前 4 个“字” 是预置的，有特定意义，其后的数据可以自由使用，并可以任意增长。</p>
<p>每个 EVM 实例只能对初始化它的那个消息所指定的一个地址的“存储”进行存取操作，不能操作其他任何地址的存储。</p>
<p>基于在一个交易执行的过程中产生的主消息和所有子消息构造的所有 EVM 实例将共用一个运行栈。运行栈的最大深度是 1024，栈中的每个元素是一个“字”(即 32 字节)。在上图中执行第 4 步之前(即从子消息 1-1 返回主消息之前)栈中至少会自顶向下保存子消息 1-1 中要使用的所有临时数据和主消息中要使用的所有临时数据。所以一个交易中子消息的最大调用深度(也就是上图中的一)是有限的，不可能大于 1024。</p>
<p>好，在了解了 EVM 的基本特性之后，下面我们就来看看以太坊中的“消息”都包含了哪些具体的数据，以及这些数据将如何影响消息在 EVM 实例中的执行:</p>
<p>● code_address:当前消息要执行的代码所在的地址。</p>
<p>● code_hash:当前消息要执行的代码数据的 keccak 256 哈希值。</p>
<p>● address:当前消息执行要使用的账户状态、存储所在的地址，它通常与 code_address 相同，除非消息是由 CALLCODE 或 DELEGATECALL 指令生成的。(这两个指令的机制比较复杂，已经超出了这个专题的范围，这里不再详细讲解了。)</p>
<p>● origin:签发原始交易的地址。origin 一定是 EOA 地址。</p>
<p>● sender:发出当前消息的地址。在上一节中的示意图里，所有消息的 origin 都是签发原始交易的 EOA 地址;对于主消息，它的 sender 和 origin 是相同的;对于子消息， 它们的 sender 就是消息链中的前一个消息的 address(比如子消息 1-1 的 sender 将 是主消息的 address，子消息 1-2 的 sender 将是子消息 1-1 的 address，以此类推)。</p>
<p>● gas:当前消息执行所能使用的最大 gas 数量。</p>
<p>● gas_price:产生当前消息的原始交易中指定的 gas 价格。</p>
<p>● value:当前消息执行所附带的以太币数量，以 wei 为单位。</p>
<p>● code:当前消息要执行的 EVM 代码。</p>
<p>● data:当前消息执行要使用的输入数据。</p>
<p>● call_type:指明当前消息是由 CALL、CALLCODE、DELEGATECALL、STATICCALL 这 4 个指令中的哪个所生成的。</p>
<p>● params_type:指明当前消息执行要使用的输入数据是与代码一起包含在 code 字段中,还是保存在 data 字段中。</p>
<p>● stack_depth:当前消息构造时的运行栈深度。</p>
<p>如果我们用 msg 来表示消息数据，用 tx 来表示交易数据的话，那么基于“合约创建”交 易或“消息调用”交易来构造主消息数据的逻辑可以整理如下:</p>
<p>● code_address:对于合约创建交易，为 $B_{96…255}(Keccak 256(RLP(tx.from,tx.from.nonce-1)))​$; 对于消息调用交易，为 tx.to。</p>
<p>● code_hash:keccak 256(msg.code)</p>
<p>● address:msg.code_address</p>
<p>● origin:tx.from</p>
<p>● sender:tx.from</p>
<p>● gas:tx.gasLimit</p>
<p>● gas_price:tx.gasPrice。</p>
<p>● value:tx.value</p>
<p>● code:对于合约创建交易，为 tx.data;对于消息调用交易，为 tx.to 地址的关联代码中由 tx.data 的前 4 字节指定的那个函数的全部 EVM 代码。</p>
<p>● data:对于合约创建交易，为空;对于消息调用交易，为 tx.data 中除前 4 字节以外的所有字节数据。</p>
<p>● call_type:对于合约创建交易，为 None(即不是函数调用);对于消息调用交易，为 Call(即与通过 CALL 指令产生的消息等价)。</p>
<p>● params_type:对于合约创建交易，为 Embeded(即输入数据包含在 msg.code 中); 对于消息调用交易，为 Separate(即输入数据在 msg.data 中)。</p>
<p>● stack_depth:0。</p>
<p>通过这样的方式，以太坊客户端就把“合约创建”交易和“消息调用”交易统一成了一个“消息”。这个消息将由一个独立的 EVM 实例来实际执行。基于刚刚介绍的“执行模型”的机制，这个 EVM 实例在执行由主消息指定的代码的过程中，就可能产生一个或多个子消息， 这些子消息再由各自独立的 EVM 实例来分别执行，但所有子消息会与主消息共用一个运行栈，且会从主消息继承可用 gas( 当然也可以通过代码来调整允许子消息使用的 gas 数量)。 在所有子消息执行结束之后，主消息才可能结束。这是一种链式的执行机制。</p>
<p>一个交易的执行过程中产生的每个消息都会由一个独立的 EVM 实例来执行，EVM 是一个 “沙盒”，其初始状态将由客户端保存。如果 EVM 在执行由消息指定的代码的过程中产生了异常，则会直接终止代码执行，并恢复到初始状态，也就是会把产生异常之前做的所有状 态修改全部撤销。这里的“状态修改”指的是对 msg.address 地址的账户状态和其“存储” 中数据的修改。</p>
<p>需要注意的是，子消息执行失败，并不一定会导致其消息链中上一个消息的失败，这取决于上一个消息的代码中如何处理子消息的异常结果;但子消息的执行失败肯定会撤销消息链中后续所有子消息对状态的修改。这是因为消息链中前一个消息的初始状态显然不会包含后续子消息的状态修改，这个结果是由子消息的链式调用机制决定的。</p>
<p>所以，如果主消息代码的执行中产生了异常，将会使世界状态恢复到交易执行开始时的版本 (也就是构造主消息时的版本)，所有子消息所做的状态修改都会被撤销，不管它们是否执行成功。同时，如果主消息执行失败，则当前交易会被直接标记为失败(即交易收据中的 outcome 将被设置为 0)。</p>
<p>这里提到的 EVM 中的异常，一般有以下几个原因:</p>
<p>● 可用 gas 不足。即由 msg.gas 指定的 gas 数量不足以完成 msg.code 中指定的代码的执行。</p>
<p>● 无效指令。也就是 msg.code 中指定的 EVM 字节码中存在协议规定的指令集以外的操作码数据。</p>
<p>● 栈空间不足或 msg.stack_depth 大于 1024。因为运行栈的最大深度是 1024，所以在当前消息的 msg.stack_depth 已经接近 1024 时，就将可能发生栈顶的空余元素不足以执行当前代码的情况。</p>
<p>● 无效的跳转指令。即由跳转和条件跳转指令指定的跳转目标位置超出有效范围。</p>
<p>● 在 STATICCALL 中修改了状态。STATICCALL 也就是“静态调用”，是不允许修改任何状态数据的，这里的状态数据指的是任意的账户状态或合约账户的存储。</p>
<p>#以太坊中的其他重要细节     </p>
<p>##随机数和预言机</p>
<p>在上一讲中我们看到，基于 EVM 的指令设计，以太坊这个通用的计算平台实际上并不能产生随机数，也没有网络通信能力，它无法主动与外部世界或者宿主物理计算机进行数据交互。 那么为什么要这么设计呢?</p>
<p>用最简单的一句话来回答:这是因为区块链系统不能包含不确定的因素。</p>
<p>通过前文对比特币和以太坊基本原理的介绍，我们已经知道，一个区块链系统，实际上是一个基于点对点网络的分布式共识系统。这种共识的逻辑在于:参与网络的所有节点都需要自己独立运行所有的交易，获得所有交易的执行结果的版本标识(通常为某个数据结构的哈希值)。而后将自己本地计算得到的这个版本标识，和在网络中广播的对应状态的版本标识进行比对，只有这两个版本标识相同时，才认为网络达到了新的“共识状态”。所以基于这样的协议，如果一个交易在不同的节点或者不同的时间执行时会产生不同的结果，那么这个交易就将无法在这样一个基于分布式共识的系统里得到共识。</p>
<p>以以太坊为例，如果某个交易会“不确定地”修改某个账户状态或者产生不确定的日志数据， 那么这个交易在不同的节点客户端上运行时，就会得到不同的 stateRoot 或 receipt Root， 于是包含了这个交易的区块也就无法在网络中达成“共识”;因为本地计算得到的数据状态版本标识与网络中广播的数据状态版本标识不同。</p>
<p>所以在区块链这样的有严格“确定性”要求的系统中，是不能包含那些执行结果无法预知的操作的。这种“执行结果无法预知的操作”就包括:</p>
<p>● 产生随机数。</p>
<p>● 与外部世界进行网络通信。(因为网络的状况是无法预知的，创建网络连接有可能成功,也有可能失败;基于网络连接传输数据同样存在失败的可能。)</p>
<p>● 主动获取外部数据。(比如主动发出一个 http 调用去某个公共数据服务获取数据，那么同样的请求，在不同的节点上执行时，因为实际执行时间一定是不同的，所以也将无法确定获得同样的返回结果。)</p>
<p>那么如果一个实际应用场景中需要使用随机数或者外部数据源提供的数据时怎么办呢?解决方法就是使用“预言机”。</p>
<p>所谓“预言机”的英文术语是 oracle，这个中文的说法大概会有些歧义，因为这里的 oracle 实际上既不是预言，也不是机器;这就像我先前提到的:智能合约既不智能，也不是合约。</p>
<p>预言机也是一种先入为主或者约定俗成的叫法。它本质上就是一种为区块链系统提供外部数据服务的技术设施。</p>
<p>预言机系统是独立于区块链系统之外的技术服务设施，它通常是以如下方式与区块链系统进行交互的:</p>
<p>1.预言机数据服务在区块链(比如以太坊)上发布一个智能合约，我们称之为 S，S 会包含一个合约函数 f 来接收其他合约的外部数据请求，这可以理解为一个数据请求注册函数。此外，S 合约至少还应该包含一个 r 函数，来接收外部数据输入。</p>
<p>2.当一个其他合约 A 需要外部数据服务时，它们可以向 S 发起一个消息调用，调用 S 的 f 函数，将它们需要的数据类别作为 f 的实际参数传入。</p>
<p>3.f 函数执行时会生成某种特定的日志数据，将数据请求的类别和其他必要信息输出。</p>
<p>4.预言机数据服务会监视与 S 合约相关的所有日志数据，当它在 S 合约的日志数据中看到有某个数据类别的请求发生时，则生成一个满足条件的具体数据，并将这个数据作为输入参数来发起一个“消息调用”交易以调用 S 合约的 r 函数。(r 函数通常仅接受来自特定发送者的调用请求，即仅接受由可信的数据源提供的数据服务。)</p>
<p>5.r 函数接收到外部数据之后，会将外部提供的这个输入数据作为参数调用 A 合约用来接收数据结果的特定函数(这个函数名可以在最初调用 S 的 f 函数时传入，也可以由预言机服务指定为固定的函数名和参数表)。这样，A 合约就可以基于由区块链外部的预言机服务提供的数据继续后续处理了。</p>
<p>当然，这个过程并不是实时完成的，而至少需要两个交易:首先是请求数据的人签发一个交易来调用 A 合约的某个函数，这个函数再去调用 S 合约的 f 函数;然后是由预言机数据服务签发的一个交易来调用 S 合约的 r 函数。所以整个过程至少要经过两个区块时间才能 完成。</p>
<p>可以看到，在这样的一个过程中，那些不确定的外部数据，比如随机数、天气信息、股票信 息等等，就变成了“消息调用”的输入参数，也就是包含在交易的 data 字段中的一次性使用的确定的数据。于是相应的交易在不同节点上、不同时间运行时，就都可以获得同样的结果了，也就和普通的交易一样，可以达成全网共识了。</p>
<p>对于像以太坊这样的可编程区块链来讲，预言机是非常重要的生态组成部分，为封闭的区块链系统提供了与外部世界交换数据的能力。</p>
<p>##以太坊与外部应用的交互q</p>
<p>对于一个可编程的公共计算平台来讲，它显然还应该提供与外部应用进行交互的技术手段。</p>
<p>刚刚介绍的这种预言机数据服务与区块链系统的交互方式，其实也是 DApp 与智能合约平台进行数据交互的通用方式，即由 DApp 向数据处理合约发起消息调用，而后监视特定合约的日志输出，再基于日志输出进行后续业务处理(发起后续消息调用)。这种处理方式是我们应该理解和记住的。</p>
<p>此外，以太坊客户端中都提供了 JSON-RPC 服务，允许外部应用基于 http 请求来与以太坊区块链进行交互。以太坊客户端的 JSON-RPC 服务是一个由客户端维护的 http 服务，通常会与客户端服务同时启动，默认监听于 8545 端口(Python 客户端是 4000 端口)。比如我们可以向某个启动的客户端的 JSON-RPC 服务发送一个请求来获得客户端程序的版本信息:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">// JSON-RPC 请求</span><br><span class="line">curl-X POST --data &apos;&#123;&quot;jsonrpc&quot;:&quot;2.0&quot;,&quot;method&quot;:&quot;web3_clientVersion&quot;,&quot;params&quot;:[],&quot;id&quot;:67&#125;&apos;</span><br><span class="line">// JSON-RPC 服务的回应 &#123;</span><br><span class="line">&quot;id&quot;:67,</span><br><span class="line">&quot;jsonrpc&quot;:&quot;2.0&quot;,</span><br><span class="line">&quot;result&quot;: &quot;Mist/v0.9.3/darwin/go1.4.1&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<p>以太坊的 JSON-RPC 接口提供了数十个 API，可以用于向以太坊客户端查询特定的客户端息、区块信息、交易信息、日志信息、账户信息、存储信息等等，并可以直接进行签发交易、调用合约函数(在客户端本地执行)等操作。完整的 JSON-RPCAPI，你可以在<a href="https://github.com/ethereum/wiki/wiki/JSON-RPC#json-rpc-methods">以太坊社区的官方 wiki</a>中找到，这里不再详细罗列了。</p>
<p>此外，以太坊客户端还提供了所谓的 Web3 接口，即用 Javascript 语言对 JSON-RPC API 进行的简单包装，以方便在前端程序或者像 nodejs 这样的后端程序中与以太坊客户端进行 交互。以太坊客户端的 Web3 服务默认监听于 8546 端口。对 Web3 接口的具体介绍你同 样可以在<a href="https://github.com/ethereum/wiki/wiki/JavaScript-API">以太坊社区的官方 wiki</a>中找到，这里也不再详细介绍了。     </p>
<p>##以太坊中的 Whisper 协议</p>
<p>Whisper 协议是以太坊客户端实现的一种匿名的消息服务协议。它利用以太坊底层的点对点网络提供了一种“发布-订阅”模式的匿名消息通信功能。从本质上讲，它就像一个不用做数字签名、不用进行额外计算、不用打包到区块中的交易，也就是一个在以太坊网络中广播的数据包，各个客户端节点可以根据自己的需要来具体处理其中的数据。Whisper协议目前还处在比较早期的阶段，实际提供的功能也比较简单。</p>
<p>在使用上，主要是基于 JSON-RPC API 中的 ssh_postAPI(Web3 中的 ssh.post 函数)来实现的。它有以下几个参数:</p>
<p>● from:消息的发送者(可选)。通常可以用 ssh_newIdentity API事先生成一个身份标识。</p>
<p>● to:消息接收者标识(可选)。如果指定了这个字段，则协议会用指定的接收者公钥对消息数据进行加密，以使消息仅能被指定的接收者解密。</p>
<p>● topics:消息主题。实际消息中会用此参数的值生成一个 Bloom 过滤器，这样，知道原始主题内容的用户就可以通过 ssh_newFilter API(Web3 中的 ssh.filter)来过滤出相关的消息。</p>
<p>● payload:消息的具体内容。可以是公开的非加密信息;也可以是用接收者私钥对应的公钥进行加密之后的信息，这样就只有接收者可以解密获得实际信息。</p>
<p>● ttl:消息有效时间。</p>
<p>● priroty:消息优先级。</p>
<p>显然，通过这样的 API 我们既可以发布公开的信息，也可以发送私密的、仅能由特定接收者获得的信息，是一种很灵活的消息服务。</p>
<p>以太坊社区也计划在 2019 年对 Whisper 协议进行升级，增强其功能和实用性。</p>
<p>##用于开发智能合约的高级语言</p>
<p>在以太坊项目的早期曾出现了很多参考其他已有高级语言的语法特征创造出来的智能合约开发语言，但到目前为止依然在持续迭代更新升级的只剩下 Solidity 语言。Solidity 是 Gavin Wood博士参考了 C++、Python 和 Javascript 的语法特性，专门为智能合约开发而创造出来的面向对象的高级程序设计语言，最早发布于 2014 年 8 月。在其后的三四年间， Solidity 语言逐渐成为了智能合约开发中事实上的标准语言，有很大的影响力。</p>
<p>Solidity 也是编译语言，由专门的编译器来编译为可以在 EVM 中执行的字节码。它的语法规则非常简单，任何学习过其他高级语言的开发者都可以很快上手写出符合语法规则的合约程序。但这个语言的难点其实在于那些与区块链特性或 EVM 特性紧密相关的语言特性和运行时特性上，是一门上手容易、精通难的语言，初学者很容易出现各种各样的错误，并且某些错误可能会相对比较费解。这也导致以太坊早期出现了很多合约漏洞或恶意攻击的事件。</p>
<p>于是大概从 2017 年下半年开始，以太坊社区提出要开发一种新的更安全、更简单且更容易进行代码审计乃至形式化验证的高级语言作为 Solidity 的补充，以使更多用户能够在相对较短的时间内就写出安全可靠的智能合约。这就是 Vyper 语言。</p>
<p>Vyper 语言的语法上主要借鉴了 Python 语言，代码结构简单清晰，并且移除了 Solidity 中的很多灵活、强悍但也相对比较复杂的语法特性，比如修改器(Modifiter)、合约继承、内联汇编、函数重载、操作符重载、递归调用、无限循环等等。其设计目标就是尽可能地简化语法规则和编译器逻辑，强调安全性，并最大化代码可读性以降低代码审计的难度。</p>
<p>Vyper 语言项目的大量更新开始于 2018 年下半年，目前 Vyper 语言还没有正式发布的版本，属于 beta 阶段。虽然 Vyper 语言中移除了 Solidity 中最强悍的特性——内联汇编(也就是直接书写 EVM 汇编代码，相当于直接手工控制 EVM 的执行)，但这种语言仍然具有 很大的潜力，可以适用于大部分以业务逻辑为主的智能合约，未来有可能成为初中级合约开发者的首选高级言。</p>
<p>#UTXO 模型和账户模型比较</p>
<p>##隐私性(privacy)</p>
<p>在 UTXO 模型中，代币是以“交易输出”为单位来管理的，某个具体的未使用交易输出 (UTXO)并没有一个明确的“主人”，而只包含了一个“锁定脚本”。通过这个锁定脚本，并不能直接发现“谁”能够使用/花掉它(如果你已经忘了这种机制，你可以去复习一下——比特币的脚本系统)。只有当某个 UTXO 被使用/花掉之后，通过引用了这个 UTXO 的某个“交易输入”中包含的“解锁脚本”我们才能知道“谁”是它的主人。也就是说，在我没有使用一个 UTXO 的时候，其他人并不知道“我”能够使用它，所以我自己的可用“余额”只有我自己知道。这就在一定程度上保证了代币持有人的隐私，尤其是对那些还从未使用过 UTXO 的“新地址”而言。这对于一个公共、公开的账本系统而言是一个非常重要的特性。</p>
<p>而在账户模型中，某一个地址的可用“余额”是以具体数值的形式保存在“账户状态”的 balance 字段中的，所以任何人都可以看到某个地址的所有可用余额。这当然就谈不上有任何的“隐私性”。</p>
<p>##安全性：交易的验证和追踪</p>
<p>在 UTXO 模型中，一个交易就是通过构造“输入”来使用 UTXO、产生新的 UTXO 的过程。 要验证一个交易的正确性，我们需要根据它的输入来追溯之前的所有历史交易，直到一个合法的 coinbase 交易(即由矿工根据协议规定生成的一个没有输入、只有输出的交易，是区块中的第一个交易)。这个过程本身就是一个完整的对交易数据的追踪过程，我们可以明确地知道一个 UTXO 经历了多少个主人或者被拆分了多少次。从验证角度来讲，就是只需要获取与要验证的交易相关的若干历史交易数据，不需要其他的全网数据。这实际上是一种协议级的、天然的交易验证和追踪机制，如果把这种机制集成在一个公开的、全网共识的账本系统中，它就具有了极高的安全性，极难被攻击。</p>
<p>而在账户模型中，因为所有交易是直接修改相关地址的“余额”字段的数值，所以它也就不具备 UTXO 模型提供的这种天然的可追踪性和安全性。而从验证上看，在账户模型中要验证账户状态，则几乎必然地要引入“世界状态”，也就是像以太坊协议那样，将所有账户状态数据放到一个 MPT(MerklePatriciaTree)中，通过在区块头中包含其根节点哈希来在全网节点间对其中保存的所有数据的版本达成“共识”。这当然是更复杂，也需要更多计算的。</p>
<p>##可扩展性(scalability)</p>
<p>从刚刚介绍的交易验证过程中我们还可以看到，因为 UTXO 模型中的交易验证并不需要全网所有数据，只需要与此交易相关的所有历史交易数据，所以“并行”地验证多个交易从技术上说是可行的。这也就使通过类似于“分片(sharding)”这样的技术分案对区块链系统进行扩展变得相对比较容易(这里说的“分片”，是一种通行的、通过并发执行相同的协议逻辑来对区块链进行水平扩展以提高其整体处理性能的技术方案) 。即使仅仅针对单一的客户端或者代理服务程序，也可以通过“多线程”的方式同时进行多个交易的验证，这样也就提高了客户端程序的处理性能。</p>
<p>而基于账户模型的系统，因为即使是验证单一的交易，也要依赖于全网数据状态(也就是“世界状态”)的变动，所以即使客户端硬件性能很强，也不可能在同一个客户端/代理服务程序中并行地进行交易验证。在通过类似于“分片”这样的技术方案进行性能扩展时也会相对更加复杂，尤其是对那些不在同一地址空间(也就是不在一个“分片”上)的地址之间进行交易的时候。</p>
<p>##可编程性</p>
<p>在 UTXO 模型中，因为每个交易都会使用/花掉若干 UTXO 来生成若干新的 UTXO，且 UTXO 只能被使用一次，所以要实现“跨交易”的状态存储变得非常复杂，因为没有一个跨交易的数据标识机制。也就是说，如果一个业务计算无法通过一个单独的交易完成，那么它就很难在基于 UTXO 模型的区块链系统中实现。但通常一个稍微复杂的计算任务，比如一个自定义状态机，都肯定不止仅有一个初始状态和一个终止状态，而像这样的计算任务的中间状态就很难基于 UTXO 模型来保存，所以 UTXO 模型的“可编程性”就受到了很大的限制。当然，基于 UTXO 模型的这种特性，也就自然而然地产生了很多所谓的“二层(layer2)” 扩展方案，来将中间状态/中间计算过程拿到区块链之外去执行，而只在区块链上保存“初始状态”和“终止状态”，这同样是可行的;并且可以在获得一些额外的技术特性的前提下还同时享受基于 UTXO 模型的底层区块链所提供的隐私性和安全性。</p>
<p>而在账户模型中，我们就可以像以太坊那样，通过账户的全局唯一标识——地址来简单地对自定义状态、自定义代码进行保存(持久化)，以实现“跨交易”的状态存储。就像在对 EVM 的介绍中看到的那样，基于账户模型来提供一个更接近于通常意义上的“计算机”的计算环境当然也就简单了很多。</p>
<p>##其他细节</p>
<p>我们已经知道，在以太坊的交易数据中有一个 nonce 字段，它是交易发送者所发出的所有交易的计数，且无论交易执行成功或失败，它的数值都会增加。而在比特币的交易中则不存在这样的字段。那么，为什么账户模型中要引入这个字段呢?</p>
<p>这是为了解决所谓的“交易重放(transaction replay)”问题。我们可以通过前文中使用过的 一个示意图来解释这个问题:</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/26/从比特币到以太坊：下/广播节点.png" alt="广播节点">           </p>
<p>在上图中，如果节点 8 接收到了一个交易，要从账户 A 转 50 个代币到账户 B，那么节点 8 就会把这个交易“广播”给与它相临的节点 6 和节点 7。同理，节点 6 则会将此交易广播给节点 5;而节点 7 则会将此交易广播给节点 4 和节点 5。这样，对于节点 5 来 讲，它就会收到两个交易，其内容都是从账户 A 转 50 个代币到账户 B。你发现这里的问题了么?</p>
<p>是的，如果没有 nonce 这个顺序号的话，虽然节点 5 能确定这两个交易都是由账户 A 的 私钥签发的合法交易，但它无法确定这两个交易到底是同一个交易在广播过程中的“重放”， 还是两个不同的交易，仅仅恰好是转账金额和转账目标都相同。这就是账户模型中必须由一 个全局的顺序号 nonce 来记录从一个地址签发的所有交易计数的原因。</p>
<p>那么在 UTXO 模型中，因为某个交易必定是花费若干 UTXO 来生成若干新的 UTXO，且 UTXO 只能被使用一次，所以如果出现两个“输入”和“输出”完全相同的交易，那么它们必然是同一个交易，不需要额外的字段来确保这一点。而如果“输入”相同“输出”不同， 那就要看这两个交易哪个被全网公认地首先被执行了，后执行的交易则必然会失败，因为 “输入”中引用的 UTXO 已经被花掉了。</p>
<p>除了 nonce 的问题以外，这两种数据模型对账本数据存储(持久化)的数据量需求也有差异。账户模型因为不需要像 UTXO 模型那样单独追踪所有的“输出”，账户余额只需要一个 字段就能保存，所以从账本数据上肯定是要大大小于 UXTO 模型的。但这并不是说以太坊的客户端所需的存储容量小于比特币客户端，因为以太坊中最主要的存储消耗在于用户自定义的状态数据的持久化，也就是前文里介绍的合约存储(storage)，对全节点来讲，这是非常巨大的存储开􏰁。</p>
<p>再有，在对轻客户端的支持上，它们也有差别。基于 UTXO 模型的系统，只能通过轻客户端确认交易是否发生了，但因为没有保存所有历史数据，所以无法独立验证一个交易是有效的(即交易中引用的 UTXO 没有在别的交易里被引用，且可以追溯到合法的 coinbase 交 易)。而基于账户模型的系统，轻客户端则仅需要保存“世界状态”的最新版本就可以验证一个新区块以及其中包含的所有交易是否合法(前提是轻客户端保存的最新“世界状态”不是伪造的)。</p>
<p>通过上边的介绍，你可以明显看到，在隐私性、安全性和可扩展性上，UTXO 模型都更好， 它不愧是一个伟大的、很简单但又极其聪明的创新;而在可编程性上，账户模型则当然地胜出(它也是我们传统的中心化计算技术里最常采用的数据模型)。这就是比特币这样一个更接近于应用系统的协议选择了 UTXO 模型，而以太坊这样一个通用的公共计算平台选择了账户模型的根本原因。</p>
<h1 id="比特币和以太坊的未来方向"><a href="#比特币和以太坊的未来方向" class="headerlink" title="比特币和以太坊的未来方向"></a>比特币和以太坊的未来方向</h1><p>##比特币的未来方向</p>
<p>比特币社区和其核心开发者相对而言可以说是非常保守的。自 2009 年初比特币网络正式上线开始，比特币系统的改动一直非常谨小慎微，这当然主要源于系统最初设计的简单和健壮，同时也出于那些核心开发者们所达成的一种意识形态上的共识。我们应该明白:比特币系统中采用 UTXO 模型并简化脚本系统的功能是故意为之的，并不是设计缺陷。</p>
<p>比特币系统是目前为止“分叉”最多的加密货币，在未来，也极有可能再度被分叉。这里要讨论的未来方向，仅仅是指所谓正统的“比特币核心(Bitcoin Core)”项目的一些技术发展方向。</p>
<p>2017 年 8 月，比特币历史上最大的改进——“隔离见证(Segregated Witness)”正式上线，在之前的介绍中曾有简单的提及。伴随着隔离见证，还有几个在社区内讨论比较多的技术方案也已经或接近进入日程表，可能在未来的一到两年中能够实现。</p>
<p>首先是“默克尔抽象语法树(Merkle Abstract SyntaxTree，简称 MAST)”，你可以在 Github 上的 BIP 项目中找到它(BIP-114)的技术说明。MAST 定义了两种新的脚本作为隔离见证 的扩展支持，完善了一种与前文介绍过的 P2SH(Pay-To-Script-Hash)相似的 P2WSH(Pay- To-Witness-Script-Hash)机制，可以使实际执行的脚本容量大大增加，同时保证“偿付脚本”的隐私性。MAST 就是一个基于特定的脚本所构成的“默克尔树(Merkle Tree)”，脚本代码按照一定的规则组成叶节点，这样就可以通过相应的哈希计算生成根节点哈希和某个脚本步骤的“默克尔证明(Merkle Proof)”(即某个脚本步骤所在的叶节点到根节点的路径上所有分支的另一个节点的哈希值，用以证明叶节点和根节点的对应关系)。</p>
<p>这里我们稍微回忆一下 P2SH 的机制:我们需要在锁定脚本中加入偿付脚本的哈希值，然后在解锁脚本中附加实际的偿付脚本来花掉对应的 UTXO。这种机制虽然能保证在 UTXO 没有花掉的时候没人知道怎么去花掉它，但在有人实际花掉它之后，如何解锁这个 UTXO 的偿付脚本就变成公开的了，所有人都可以看到“谁”通过“什么方式”花掉了这个 UTXO。</p>
<p>而在引入 MAST 之后，偿付脚本将变成一个 MAST 中的“默克尔证明”，在 UTXO 中预先保存的则变为 MAST 的根节点哈希。于是，原始的脚本代码就不需要公开到使用这个 UTXO 的输入中了，除了实际脚本代码的使用者之外，其他人虽然可以知道“谁”花掉了这 个 UTXO，但已经无法得知脚本代码的参与者是通过“什么方式”花掉了这个 UTXO 了。 当然，这里的前提是交易是合法的，也就是任何人都可以简单地通过“默克尔证明”来验证偿付脚本和 MAST 根节点哈希的对应关系，以此来证明解锁脚本是成立的。</p>
<p>除了 MAST 以外，schnorr 签名也是比特币的核心开发者正在研究和实践的一个技术方案。</p>
<p>虽然它还没有正式进入 BIP，但你可以在一位比特币核心开发者 Pieter Wuille 的 Github 上找到具体的技术说明。这是一种对 ECDSA 算法的改进，它可以简化对“多重签名 (Multisignature)”和“阀值签名(Threshold Signature)”以及“适配签名(Adaptor Signature)”、“盲签名(Blind Signature)”的构造和验证过程。这些签名技术可以将多个 ECDSA 数字签名合并为一个 64 字节的复合数字签名。你可以在<a href="https://github.com/sipa/bips/blob/bip-schnorr/bip-schnorr.mediawiki">这个 Github 工程</a>中获得更多信息。</p>
<p>在 2018 年 1 月，一位比特币核心开发者，同时也是 Blockstream CTO 的 Gregory Maxwell，提出了一种新的方案，它结合了 MAST 和 schnorr 签名，提供了一种更为隐私的 P2WSH 方案——Taproot。在这个方案里，除了实际脚本代码只被所有参与者掌握以外，连所有参与者的信息都被隐藏到一个 64 字节的复合签名(也就是 schnorr 签名)中了。所以除了所有脚本代码(也就是智能合约)的参与者以外，其他人则完全无从得知是“谁”通过 “什么方式”花掉了一个 UTXO。Taproot 实际上是提供了一种完全私密的“链外智能合约 (off-chain smart contract)”实现方案。它将对比特币生态发生很深远的影响，因为这其实 是一种非常灵活且私密的扩展方案，有可能成为一种通用的模式。</p>
<p>比特币作为世界上第一个公共的电子现金网络，其先入优势非常明显;而在具有了这种私密的智能合约实现能力之后，它也很可能会成为某种数字资产平台，并能够实现一些真正有价值的业务。</p>
<p>##以太坊的未来方向</p>
<p>以太坊项目目前也已经进入了下一个版本的设计和概念验证阶段，这就是在以太坊项目创建初期就确定的所谓“宁静(Serenity)”版本，也是在 2018 年下半年被社区正式定名为 “以太坊 2.0”的版本。你可以在 Github 上找到社区公开的对以太坊 2.0 版本的研究和<a href="https://github.com/ethereum/eth2.0-specs">设计文档</a>。但具体方案仍然在不断修改完善。</p>
<p>以太坊的 2.0 版本引入了非常多的创新和技术概念，基于内容的篇幅和这个专题的目的，我在此仅简单地介绍一下其主要思路和大致的实现方案。</p>
<p>从核心技术上看，以太坊 2.0 的最大创新就是其共识算法将由“工作量证明(即 Proof of Work，PoW)”切换到“权益证明(即 Proof of Stake，PoS)”。虽然这个方向是早在以太坊黄皮书撰写的过程中就确定了的，但能真正从一种物理性的随机共识转换为社会化参与的投票共识，依然是一个非常大的挑战，并存在很高的风险，无论是从技术层面还是社区治理的层面。</p>
<p>除了共识算法的转换以外，以太坊 2.0 的最主要目标就是解决目前以太坊主网的处理能力低下的问题，也就是已经被讨论了很久的所谓 TPS 问题。我们已经知道，目前的以太坊实际上可以看作是一个“单线程”的“世界计算机”，其计算能力也就当然地受到了目前技术方案的限制。那么在以太坊 2.0 中，计划将通过“分片(sharding)”的方式使以太坊这个世界计算机具备并行计算能力，也就是可以通过类似“多线程”的方式允许以太坊在同一时间同时处理多个交易。</p>
<p>以太坊 2.0 的大致技术方案是将实际的交易处理分散到“分片链(shard chain)”中，然后用一个全局唯一的“信标链(beacon chain)”作为基础区块链来统一处理分片链的状态确认。我们可以把信标链看作是以太坊 2.0 的“主链”，把分片链看作是可以并行处理交易的同构“子链”，这样就把目前的单一顺序处理交易的方式变为了多子链并行处理的方式。</p>
<p>根据目前的设计，在以太坊 2.0 初期，将同时存在 1026 个区块链:</p>
<p>● 第一个是目前的以太坊主网，它仍将基于“工作量证明(PoW)”算法运作，并作为信标链的基础，通过一个智能合约来管理参与信标链投票的所有参与者的资金，并处理相应的进入、退出动作。</p>
<p>● 然后是信标链，它将基于“权益证明(PoS)”算法运作，来生成区块并确认分片链中的交易执行结果。</p>
<p>● 最后就是 1024 个用来并行处理交易的分片链，其状态变动将由信标链统一确认并记录数据版本。</p>
<p>其中将在信标链中使用的“权益证明(PoS)”算法有如下几个要点:</p>
<p>● 任何参与者都可以向在目前的以太坊主网上存在的一个智能合约发送 32 个以太币来使自己成为信标链的注册“验证者(validator)”，合约会锁定这些以太币，直到满足退出条件。</p>
<p>● 信标链会定期邀请若干注册的验证者成为“活跃验证者(active validator)”，并从中选择若干验证者组成“委员会(committee)”。这里说的“定期”就是说这些验证者和委员会都是有“任期”的，经过一定时间之后就会“换届”，也就是会重新选择。</p>
<p>● 信标链中选择的“活跃验证者”有权创建信标链的区块或者验证分片链的区块，当前的“委员会”则负责投票确定新的信标链区块和分片链区块是否合法。这其中还包含了相应的惩罚机制，比如某个“委员”恶意不签发合法区块或者签发非法区块，则其质押在目前的以太坊主网合约中的以太币将被剥夺，并失去“委员”资格。</p>
<p>显然，这是一种对真实的人类社会治理方式的模拟。正常情况下，注册的验证者大概会有数万，每一期的活跃验证者大概会有上千或数千，每一期的委员会则会控制在 128。从注册验证者到活跃验证者以及从活跃验证者到委员会的这两步选择都是随机的，所以这个机制设计的目的就是尽可能地从概率上保证公平。即使那些持有非常多“权益”的人可以控制很多注册验证者，但因为委员会的成员会经过两次随机筛选，所以这些被控制的注册验证者同时 被选为委员会的几率仍然是非常低的(除非绝大多数注册验证者都被控制)。于是在这种算法之下，理论上将极难连续控制多个信标链区块的产生和确认。</p>
<p>此外，在这样一个并行处理交易的方案中，对于分片链而言，一个很容易想到的问题就是“跨片交易(cross shard transacton)”的确认问题。因为每个分片链都有自己独立的地址空间， 所以如果一个交易影响的地址不都在一个分片链中，其确认就必然要经过信标链与所有相关的分片来同步修改状态，这个过程当然会影响系统的总体处理性能。因此，采用 1024 个分片链来并行处理交易，并不意味着系统的整体处理性能就可以简单地扩大 1024 倍;信标链对跨片交易处理的瓶颈效应是必然的、无法避免的。所以最终的实际处理性能提升，将取决于具体的跨片同步算法和工程技术实现。</p>
<p>目前已经确定的以太坊 2.0 的工程阶段有两个，其中 Phase 0 将实现“信标链(Beacon Chain)”;Phase1 将实现“分片数据链(Shard Data Chain)”。当然，这里边有非常多的技术细节，从技术难度讲也是很有挑战性的，所以最终效果如何目前尚不明朗。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2019</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">区块链</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2019/05/26/从比特币到以太坊：下/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-从比特币到以太坊" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2019/05/25/从比特币到以太坊/">从比特币到以太坊上</a>
    </h1>
  

        
        <a href="/study.github.io/2019/05/25/从比特币到以太坊/" class="archive-article-date">
  	<time datetime="2019-05-25T01:30:33.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-05-25</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <a id="more"></a>
<h1 id="区块链基本概念"><a href="#区块链基本概念" class="headerlink" title="区块链基本概念"></a>区块链基本概念</h1><h2 id="Peer-to-Peer-Network"><a href="#Peer-to-Peer-Network" class="headerlink" title="Peer-to-Peer Network"></a>Peer-to-Peer Network</h2><p>当前的互联网服务大多基于服务器架构工作，即B/S和C/S架构。其共同特点是网络中的绝大部分的计算都是由服务器完成的，网络中的所有数据都是由服务器保存的。而服务器是由特定的公司、组织乃至个人所控制。以上就是所谓的”中心化”模式架构。中心化网络通常构造在http/https/ftp/smtp/pop3/imap等”中心化”的网络协议上。</p>
<p>P2P网络，对等网络，即网络中的节点(参与者)的地位和作用是平等的。因此网络中的节点能够提供网络的部分计算能力，并保存网络中的部分乃至全部数据。在该网络中不存在拥有绝对主导地位的”服务器”，网络中的数据由参与网络的所有节点共同保存，网络中的计算也由参与网络的节点共同提供。因此个别节点的加入或退出并不影响整个网络的运作，使得P2P网络具有”去中心化”特性，即没有任何公司、组织或个人能够完全控制网络数据和计算。</p>
<p>P2P网络协议的种类繁多，包括bittorrent和eDonkey等。比特币和以太坊使用自己定制的P2P网络协议，即比特币使用一种简单的网络广播协议，以太坊使用devp2p网络协议。</p>
<p>此外，P2P协议与http/https/ftp/smtp/pop3/imap等协议相同，都是基于tcp/ip协议之上的应用层协议，通过不同的tcp端口进行区分。如http使用80端口，https使用443端口，比特币协议使用8333端口，以太坊协议使用30303端口。因此它们彼此之间并不冲突，它们是对现有互联网生态的补充和完善。</p>
<h2 id="数字签名"><a href="#数字签名" class="headerlink" title="数字签名"></a>数字签名</h2><p>非对称加密，即加密和解密使用不同的秘钥。每一个密钥通常由一个私钥和一个公钥组成，公钥基于私钥确定生成，且与私钥唯一对应。私钥是由持有人控制、不公开的秘钥。公钥是公开的、可以供任何人使用的密钥。非对称加密算法既支持公钥加密、私钥解密，也支持私钥加密，公钥解密。</p>
<blockquote>
<p>Bob有两把钥匙，一把公钥，一把私钥。Bob把公钥送给他的朋友们Patty、Doug和Susan每人一把。</p>
<p>Susan要给Bob写一封保密的信，写完后用Bob的公钥加密，达到保密效果。Bob收信后用私钥解密，即可看见内容。只要Bob的私钥不泄露，这封信就是安全的。</p>
<p>Bob给Susan回信，决定采用”数字签名”。他写完后先用hash函数，生成摘要，再使用私钥，对摘要加密，生成数字签名。Bob将签名附在信件下发给Susan。Susan收到后，取下数字签名，用Bob的公钥解密，得到信件的摘要。由此证明，这封信确实由Bob发出。Susan再对信件内容使用hash函数，将得到的结果与摘要对比，若两者一致，则证明这封信没有被修改过。</p>
<p>Doug想欺骗Susan，他偷偷使用Susan电脑，用自己的公钥换走Bob的公钥。此时，Susan拥有的是Doug的公钥，但是还以为是Bob的公钥。因此，Doug可以冒充Bob，用自己的私钥做成”数字签名”，写信给Susan，让Susan用公钥解密，让Susan以为是Bob写的信。但是，Susan感觉不对，发现自己不确定手里的公钥是否属于Bob。因此Susan要求Bob去找证书中心(CA)，为公钥做认证。CA用自己的私钥，对Bob的公钥和一些相关信息进行加密，生成”数字证书”。Bob拿到数字证书后，给Susan写信，在签名的同时，附上数字证书。Susan通过CA的公钥揭开数字证书，拿到Bob的真实公钥，证明数字签名是Bob签的。</p>
</blockquote>
<p>基于私钥和公钥的特性，用公钥加密的数据，因为仅能由持有私钥的唯一用户进行解密，所以提供高度安全的数据加密性(如https和ssh)。对于使用私钥加密的数据，任何人可通过公钥验证其数据内容，而能对数据加密的用户只有持有相应私钥的人，此时变成了私钥持有人对其数据的”数字签名”。在区块链和智能合约中大量应用了数字签名来证明数字的真实性和数字资产的归属权。</p>
<h2 id="密码学哈希函数"><a href="#密码学哈希函数" class="headerlink" title="密码学哈希函数"></a>密码学哈希函数</h2><p>哈希函数可以将任意长度的输入数据映射到固定长度的输出数据上，且输入与输出是唯一对应的。区块链和智能合约中广泛应用的哈希函数是所谓的”密码学哈希函数”，其基于密码学特生设计为单向函数，即由输出值无法推导出输入值。因此保证了不知道输入数据的人要伪造相同的输出数据会非常困难，或者花费的时间和计算能量非常高。</p>
<p>比特币协议使用的密码学哈希函数是SHA-256(属于SHA-2算法集，输出为256为定长数据)和RIPEMD-160(输出为160位定长数据)。以太坊使用Keccak-256(属于SHA-3算法集，输出为256位定长数据)。这些算法可以把任意长度的输入数据，单向地映射为定长的输出数据。这样，就相当于为输入数据生成了一个可以作为其版本标识的哈希值，同时也可通过该哈希值确保网络中的所有节点生成的数据是”相同的、一致的”。</p>
<h2 id="Merkle-Tree"><a href="#Merkle-Tree" class="headerlink" title="Merkle Tree"></a>Merkle Tree</h2><p>Merkle Tree是基于密码学哈希函数构造的二叉树。其构成算法可以描述为：</p>
<ul>
<li>树种的所有叶子节点其数值都是原始输入数据的密码学哈希值</li>
<li>树中的所有分支节点(包括根节点)的数值都是由其两个子节点的数值经过字符串连接之后再计算密码学哈希值所得到</li>
</ul>
<p>因此，基于密码学哈希函数的特性，Merkle Tree中任意输入数据的变动，都会导致树的根节点哈希值的变动。因此，可用Merkle Tree的根节点哈希值表示树中所有输入数据的版本。比特币协议中使用Merkle Tree来验证网络中各节点间数据的一致性。</p>
<h1 id="解读比特币白皮书-上"><a href="#解读比特币白皮书-上" class="headerlink" title="解读比特币白皮书(上)"></a>解读比特币白皮书(上)</h1><p>比特币是结合多种技术概念创造出来的第一个成功的数字货币系统，是”加密经济”的起源和开端。它同时是一个无可争议的、革命性的分布式应用程序，创造出所谓的”区块链”技术。</p>
<h2 id="比特币：一个点对点的电子现金系统-Bitcoin-A-Peer-to-Peer-Electronic-Cash-System"><a href="#比特币：一个点对点的电子现金系统-Bitcoin-A-Peer-to-Peer-Electronic-Cash-System" class="headerlink" title="比特币：一个点对点的电子现金系统(Bitcoin: A Peer-to-Peer Electronic Cash System)"></a>比特币：一个点对点的电子现金系统(Bitcoin: A Peer-to-Peer Electronic Cash System)</h2><p>比特币是一个点对点的电子现金系统。点对点现金并不简单指基于点对点网络的电子现金，而是指一种仅通过交易双方就能完成的、不需要借助任何第三方的、安全的电子现金支付方式。</p>
<h2 id="介绍-Introduction"><a href="#介绍-Introduction" class="headerlink" title="介绍(Introduction)"></a>介绍(Introduction)</h2><p>在比特币出现以前，人们的电子支付都是通过一个交易双方共同信任的第三方金融机构进行。目的是为了防止”双花(double spend)”。双方是指同一个数字货币被花费一次以上。这个问题的产生是因为数字货币并没有物理实体，通常由计算机可处理二进制文件或数据来保存，使得数字货币容易被复制或者伪造。</p>
<p>在传统金融模型中，进行在线转账和电子支付时需要交易双方在各自信任的一个或多个金融机构事先开设账户，实际转账时由金融机构对双方的账户余额进行相应的增减。这个过程中由金融机构来防止双花操作。但是该模式存在单点故障的风险，即一旦金融机构的系统被攻破或网络通信数据被伪造，就会导致双花。</p>
<p>以此比特币提出一种全新的方案，即可在不引入交易双方共同信任的第三方金融机构的情况下，实现安全的电子现金支付。具体的方案可以总结为：</p>
<ul>
<li>一个去中心化的点到点网络</li>
<li>一个公开的交易账本</li>
<li>一组独立的交易验证和货币发行规则</li>
<li>一种可以达成去中心化全网共识的算法</li>
</ul>
<h2 id="交易-Transactions"><a href="#交易-Transactions" class="headerlink" title="交易(Transactions)"></a>交易(Transactions)</h2><p>比特币的电子货币，即比特币，是一个由数字签名组成的链。如下图所示</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/比特币.png" alt="比特币"></p>
<p>以上图第二个交易为例，该交易是Owner1转账给Owner2。通过Owner1对左边的交易进行签名，要签名的数据是基于左边的交易数据加上Owner2的公钥数据生成的哈希值；而左边的交易对应的比特币由Owner0转账到Owner1，证明Owner1有权使用该比特币。但是我们无法证明该比特币是否双花。要证明没有双花，只有检查该比特币从发行开始的所有交易，也就是要验证比特币的所有转账历史。而要做到这点，必须有一个机制，可以保证网络中的所有参与者都持有同样的交易历史，都能对单独的交易进行其完整历史的追踪，交易历史中的所有交易执行顺序相同。</p>
<h2 id="时间戳服务器-Timestamp-Server"><a href="#时间戳服务器-Timestamp-Server" class="headerlink" title="时间戳服务器(Timestamp Server)"></a>时间戳服务器(Timestamp Server)</h2><p>为验证所有比特币的所有转账历史，这些历史交易数据应按照一个统一的时间顺序被收集到”区块”中，这些区块按照时间的先后顺序进行关联，后一个区块的时间戳必须大于前一个区块。如下图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/区块.png" alt="区块"></p>
<p>为确定每个区块数据的版本，需要为每个区块计算一个哈希值。每个区块的哈希值基于前一个区块的哈希值和当前区块的具体数据一起计算得到的。这样一个由若干区块通过哈希值进行关联，以时间先后顺序进行排列而成的链，即”区块链”术语的意义。在比特币系统中，区块的条目(item)就是具体的比特币交易。</p>
<p>时间戳服务器，是区块链的具体数据，是要在比特币全网的所有参与者之间达成共识，所有参与者都应该持有一份完全一样的数据。</p>
<h2 id="工作量证明-Proof-of-Work"><a href="#工作量证明-Proof-of-Work" class="headerlink" title="工作量证明(Proof-of-Work)"></a>工作量证明(Proof-of-Work)</h2><p>工作量证明算法是基于点对点网络实现分布式时间戳服务器的一种解决方案，并且是目前唯一一种经过软件工程验证的长期可行的实现方案。</p>
<p>工作量证明算法的原理是要求给出一个满足特定条件的哈希值，如开头的若干位数据均为0这样的条件。已知哈希函数是可以把任意的输入数据不可逆地映射为固定长度的输出数据，那么得到一个开头若干位为0的数据就需要随机生成输入数据来尝试计算其哈希值，直到满足条件。这需要花费一定的物理计算能力来进行，需要花费一定的”工作量”才能完成。</p>
<p>加入工作量证明之后，需要在区块中加入能验证该工作量的数据。如下图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/区块数据.png" alt="区块"></p>
<p>比特币的区块需要包含前一个区块的哈希值、一个nonce数据以及若干交易数据。nonce是一个为找到满足特定难度的哈希值所做的哈希计算的总次数，而并不是最终找到的哈希值结果，也不是个随机数。因此，通过nonce的值可以验证工作量。</p>
<p>工作量证明算法中的难度(difficulty)是哈希计算结果的具体条件。eg.在SHA-256哈希值的值域范围(0~$2^{256}$-1)内找到一个小于$2^{200}$的数值这样的条件，其中的$2^{200}$这个临界数值，被称为难度目标(difficult target)。而每个区块中的nonce是为了找到这样的哈希值所做的尝试次数。</p>
<p>在协议层面，规定整个系统每小时平均产生多少区块，即一小时可找到多少满足条件的哈希值。若实际情况过快，则加大难度；反之，则降低难度。这是所有参与者共同遵守的协议规定。</p>
<p>此外，工作量证明还解决了如何在一个点对点网络中随机选取记账人的问题。因为所有参与者都有权进行记账，所以需要有一种机制来使所有人都有机会获得记账权。通过工作量证明，从物理上模拟一种随机选择机制。</p>
<h2 id="网络-Network"><a href="#网络-Network" class="headerlink" title="网络(Network)"></a>网络(Network)</h2><p>如下图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/广播节点.png" alt="广播节点"></p>
<p>在点对点网络中，某个节点不需要和其他所有节点建立连接使得网络资源被浪费。当某个节点产生一个消息或数据时，需要通过所谓的广播(broadcast)来发送数据给网络中的其他节点。</p>
<p>上图中，节点1产生一个消息，若要把消息通知到所有8个节点，需要以下步骤：</p>
<ol>
<li>1-&gt;2</li>
<li>2-&gt;3,4,5</li>
<li>4-&gt;5,7，此时节点5会从节点2，4分别收到一个相同消息，但它会判断消息是否相同，若相同，则不做处理。5-&gt;6,7，节点7判断。</li>
<li>6-&gt;8 7-&gt;8 节点8判断</li>
</ol>
<p>在该网络中，产生消息的节点不同，导致广播的效率不同。如节点5产生消息，则只需要两次广播就可以通知到所有节点。当对等网络中的不同节点同时产生新的消息时，其他节点接收消息的顺序并不一定相同，顺序由网络节点的具体链接结构和网络延迟决定，由一定的随机性。</p>
<p>比特币的网络协议有以下几个步骤：</p>
<ol>
<li>当有一个新交易产生，交易被广播到网络中所有节点。基于产生交易的节点不同，交易数据到达所有节点所需的总体网络交互时间也不同。</li>
<li>每个记账节点会将收到的交易收集到区块中</li>
<li>每个记账节点会尝试为它们制作的区块找到一个符合当前难度的工作量证明，即找到满足条件的哈希值的尝试次数nonce。</li>
<li>当记账节点找到合适的工作量证明后，就将完整的区块数据广播到网络中的所有其他节点。这里同样有达到时间的区别，就是其他节点接收到广播的区块数据的时间不一致。</li>
<li>接收到这个新区块的节点会对区块的数据进行检查，若所有数据有效、合法，则接受此区块作为最新区块</li>
<li>接受的新区块的节点链接到区块链末端，并以此区块作为前一个区块来创建后续新区块。</li>
</ol>
<p>特殊情况：若网络中的多个记账节点同时找到符合条件的工作量证明，那么对于其他节点来说，就有可能同时接收多个合法区块。这就是”分叉问题”。</p>
<p>此时，需要一个机制来确定用哪个区块作为最终的区块链末端区块。比特币采用”先入为主”的原则，即每个节点都以它们首先接受到的合法区块作为末端区块来添加后续区块，但也同时保存其他合法新区块，使区块链末端出现多个分支。在下一个区块到来时，因为每个区块都会包含前一个区块的哈希值，我们就可知道这个新区快应该添加到哪个分支上。</p>
<p>随着时间的推移，网络中叫多数节点使用的那个分支的长度，该分支的区块数量会逐渐超过其他分支。此时可以确定该分支为主分支，即”最长链(Longest Chain)”机制。</p>
<p>总结：比特币是一个基于点对点网络的分布式记账系统，所有比特币交易都以区块为单位进行顺序记录，以工作量证明顺发确定新的合法区块，并将所有区块基于时间戳的先后顺序组成一个链，链上所有相邻区块都通过哈希值进行关联。</p>
<p>#解读比特币白皮书(下)</p>
<h2 id="激励-Incentive"><a href="#激励-Incentive" class="headerlink" title="激励(Incentive)"></a>激励(Incentive)</h2><p>已知通过工作量证明算法找到合适的nonce，实际上是用户反复尝试变换输入数据获得哈希值的过程，这个过程需要消耗计算能力，也就是消耗电力使得CPU运转获得相应的算力。</p>
<p>比特币系统设计一种激励机制：每个新的合法区块的第一个交易将是一个提供固定数值的比特币的交易，且不需要引用任何历史交易，直接由找到区块的人指定这些比特币可由谁来使用。这就是比特币的发行机制——随着区块的产生逐步发行。</p>
<p>因为新的合法区块是通过工作量证明这种随机的方式产生，所以比特币的发行实际上也是一种随机方式。通过付出工作量，即付出算力来随机获得比特币奖励，这种方式与淘金相似，这种行为成为挖矿(mining)，从事挖矿活动的人被成为矿工(miner)。</p>
<p>假设有不怀好意的人集中网络中的大部分算力，则他们便可伪造交易。但是，他们需要权衡是否用网络的绝大部分算力按协议生成新区块来获得大量区块奖励，还是仅仅把转出的比特币再反转回来。若造假的成本大于正常提供算力所能获得的收益，则没人选择造假。其中的关键在于：造假需要多大的成本，多高的算力。</p>
<h2 id="减少磁盘空间-Reclaiming-Disk-Space"><a href="#减少磁盘空间-Reclaiming-Disk-Space" class="headerlink" title="减少磁盘空间(Reclaiming Disk Space)"></a>减少磁盘空间(Reclaiming Disk Space)</h2><p>由于比特币系统要求所有节点保存网络中的所有交易数据来保证所有交易都是有效的、可追溯的。同时这要求参与网络的节点消耗大量存储空间来持久化存储交易数据。当网络运行时间较长之后，随着历史数据量的增加，节点的存储消耗增加，提高对参与网络节点的硬性要求。</p>
<p>因此，比特币系统中采用一种特殊的数据存储结构来节省永久存储空间同时保持整个协议的完整性。这种数据结构就是Merkle Tree。</p>
<p>Merkle Tree是一种”哈希树”，树中的所有节点通过哈希值进行关联，所以它们有一个共同特性：树的根节点哈希可以表示树中所有数据的某个特定版本。在比特币系统中，每个区块的区块头数据中都保留了由区块内所有交易构成的Merkle Tree的根节点哈希，作为区块内所有交易数据的一个版本标识。</p>
<p>比特币的交易通过一个基于哈希值进行关联的、可追溯的交易历史来生成的，所以理论上只需要保留比特币被转移的最后一个交易的具体数据，就可以用来生成新的交易。而对于每个历史区块，若其中不包含某个比特币的最新交易数据，则只需保留区块头的Merkle Tree的根节点哈希，而不用保留完整的交易数据。</p>
<p>若区块中包含某个比特币的最新交易，则需要保留最新交易数据以及可证明该交易数据与当前区块Merkle Tree根节点哈希的对应关系的必要数据。这种给Merkle Tree进行”剪枝”处理的原理，可以用下图表示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/MerkleTree剪枝.png" alt="MerkleTree剪枝"></p>
<p>在剪枝之后，只需要保留Merkle Tree中从某个叶节点即某个具体交易到根节点的路径上所有分支的另一个节点的哈希值就可验证该叶节点与根节点的对应关系。</p>
<p>经过这种对存储数据的最小化裁剪后，可以估算需要验证网络中完整账本数据版本所需的最小存储空间。由于大部分历史区块可以不保留具体的交易数据，只需保留区块头的Merkle Tree根节点哈希值，因此区块头所需的数据大小约为80KB。基于每10min产生一个新区块的频率来看，每年的历史数据仅会占用约4.2M存储空间。</p>
<p>这种方案为实现”轻客户端”提供可能。轻客户端是不用保留全部数据，仅保存可对数据有效性进行验证的最少数据的一种简化的、降低对客户端硬件要求的客户端程序。</p>
<h2 id="简化支付验证-Simplified-Payment-Verification"><a href="#简化支付验证-Simplified-Payment-Verification" class="headerlink" title="简化支付验证(Simplified Payment Verification)"></a>简化支付验证(Simplified Payment Verification)</h2><p>已知可以通过”剪枝”后的Merkle Tree来验证交易数据和根节点哈希的对应关系，也是对交易数据版本的一个验证。这给轻客户端实现提供一种可能，使得其仅保存与所管理的私钥相关的交易数据和用来验证其版本的”剪枝”后的Merkle Tree数据。如图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/简化支付验证.png" alt="简化支付验证"></p>
<p>轻客户端程序通过保存网络中最长链的区块头数据，外加与当前私钥相关的所有交易数据的版本证明就可对交易进行验证并生成新的交易。但是，这种验证，仅是对数据版本的验证，并不能验证交易数据本身的正确性，即无法验证交易中的比特币是否被”双花”，因为轻客户端中并没有保存所有历史交易。</p>
<p>因此系统中需要一个机制：如果保存全部历史交易数据的”全节点”客户端在当前的最长链分支上发现无效的，不符合协议规定的数据格式或数据逻辑关联的区块，它们应通知网络中的其他节点，尤其是那些没有保存全部数据的”轻客户端”，让它们尝试重新获取完整的数据信息，以保证数据的安全。</p>
<h2 id="结合和分离值-Combining-and-Splitting-Value"><a href="#结合和分离值-Combining-and-Splitting-Value" class="headerlink" title="结合和分离值(Combining and Splitting Value)"></a>结合和分离值(Combining and Splitting Value)</h2><p>介绍构造交易数据的扩展方案。</p>
<p>对于一个支付系统来说，交易的具体数额会有很多情况。例如，通过一个交易获得较大数额的比特币，也可通过交易获得较小数额的比特币。则在生成新的交易时，需要组合从历史交易中获得的比特币来作为新交易的输入。输出数据同理。</p>
<blockquote>
<p>例如，我用前一个交易收入的50BTC发起一个交易，要给另一个人转账10BTC，则从50BTC的输入中扣除要转账的10BTC后，还需要一个单独的输出将剩余的BTC返还给我。</p>
</blockquote>
<p>所以对于一个交易的输出组合来讲，不止一个。于是，比特币系统中设计了一个可以组合输入并拆分输出的交易数据模型。如下图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/交易数据模型.png" alt="交易数据模型"></p>
<blockquote>
<p>例如，我分别从4笔历史交易中获得10、1、2、4 BTC。如果我需要向其他人转账5.5BTC，则我可用收入10BTC的交易作为输入，构造一个1输入、2输出的交易(输入10，输出5.5和4.5)；也可用收入1、2、4BTC的三个交易同时作为输入，构造一个3输入、2输出的交易(即输入1、2、4，输出5.5和1.5)。同理，如果我需要同时向两个人转2.5BTC，则构造一个1输入、3输出的交易(即输入10，输出2.5、2.5和5)；也可构造一个3输入、3输出的交易(即输入1、2、4，输出2.5、2.5、2)。</p>
</blockquote>
<p>但不管如何组合和拆分交易的输入和输出，一个交易的总输出必须与总输入相等，这样就保证整个交易历史的正确性和可追溯性。</p>
<h2 id="隐私-Privacy"><a href="#隐私-Privacy" class="headerlink" title="隐私(Privacy)"></a>隐私(Privacy)</h2><p>比特币系统中的隐私模型，和我们目前广泛使用的基于交易双方都信任的第三方金融机构来完成的电子支付的隐私模型有本质的不同。如下图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/隐私模型.png" alt="隐私模型"></p>
<p>在目前广泛使用的基于第三方金融机构来完成的电子支付模型中，交易双方必须分别信任该金融机构(如支付宝、微信支付)，付款方需要将自己的应付款项转账给第三方，再由第三方转账给收款方。在这个过程中，交易双方的身份标识信息由第三方金融机构保存、验证并展示给交易对手方，并且交易双方的信息和交易本身都不公开，仅参与交易的三方明确知道交易的信息。</p>
<p>在比特币系统中，由于通过密码学(数字签名)的支持、全局串行化的交易处理并公开全部账本数据(交易数据)的方式确保交易的正确、安全、不可篡改、不可撤回地执行，从而不再需要通过第三方见证的方式来完成交易。这使得比特币系统的隐私模型变为了仅需要交易双方参与即可完成，但只有交易双方的身份标识不公开。</p>
<p>基于比特币的隐私模型，如果某个唯一的身份标识进行了大量的交易，那么通过交叉分析交易对手方，是有可能获得额外信息的，这其实是一种隐私风险。因此比特币白皮书提出消除此风险的方案：每次交易都使用一个不同的密钥对(地址)，这样系统中的每个公开身份标识(公钥或地址)都只会被使用一次。</p>
<p>于是这种因为交易历史引起的身份标识泄露风险也就被避免。当前我们使用的大部分比特币钱包都支持该特性，即为每笔收款交易单独生成一个地址(同时，花费该地址收到的比特币，需要以这个交易作为后续交易的输入，于是对于后续交易来说，该转出地址是一次性的)。</p>
<p>##计算(Calculation)</p>
<p>对比特币网络进行攻击的成本问题。</p>
<p>假设：</p>
<ol>
<li>$p$为诚实的节点找到下一个区块的概率</li>
<li>$q$为攻击者找到下一个区块的概率</li>
<li>$q_z$为攻击者追上$z$个区块的概率</li>
</ol>
<p>则规律为：<br>$$<br>q_z=<br>\begin{cases}<br>1, &amp;p\leq q \<br>(q/p)^z, &amp;p &gt; q<br>\end{cases}<br>$$<br>显然，若诚实节点找到区块的概率比攻击者找到区块的概率高，则攻击者能追上正常产生区块的概率是呈指数递减的。”找到区块的概率”是它们各自的总算力。攻击者要进行攻击，必须使自己的总算力超过诚实节点的总算力，否则它们的成功概率呈指数递减，这就是”51%攻击”原理。</p>
<p>要对比特币系统进行攻击，需要大量的算力，只有拥有超过全网50%的算力，才有较大可能完成攻击。而若真拥有如此多的算力，却只为了修改先前发生的某些具体交易，是得不偿失的。因为若用超过全网50%的算力去正常为网络提供计算服务，能得到全网50%左右的挖矿奖励，比翻转具体交易的收益大得多。</p>
<p>##总结(Conclusion)</p>
<p>比特币是一个通过数字签名来确定数字货币权属，通过基于点对点网络的工作量证明算法来公开地记录所有交易的历史，以此实现一种不需要任何第三方介入的、安全的、难以篡改和伪造的电子支付系统。整个系统简单且健壮，因为只有在超过50%的全网算力被用来作弊时才会出现安全风险，但这种风险又被非常聪明地通过经济激励的设计降到最低(同等的算力进行攻击所能带来的收益远低于正常挖矿所能带来的收益)。</p>
<p>在比特币系统中，任何节点可以随时加入或退出，它们只需要在加入时进行必要的最长链数据同步即可。</p>
<h1 id="比特币的基础数据结构"><a href="#比特币的基础数据结构" class="headerlink" title="比特币的基础数据结构"></a>比特币的基础数据结构</h1><h2 id="地址"><a href="#地址" class="headerlink" title="地址"></a>地址</h2><p>比特币中的地址可以简单认为是一个收款人的标识，是在创建交易时指定收款方。比特币中的地址有两种，一种是普通的Bitcoin Address，另一种是Pay-to-Script-Hash Address。</p>
<p>普通的Bitcoin Address是基于椭圆曲线加密算法中的公钥计算得到的。具体的计算方法如下图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/椭圆曲线加密算法.png" alt="椭圆曲线加密算法"></p>
<p>假设某用户私钥对应的公钥为$K$，其比特币地址为$A$，则：$A=RIPEMD160(SHA256(K))$</p>
<p>这个计算过程被成为”Double Hash”或HASH160，因为做了两次哈希运算，第一次是SHA256，第二次是RIPEMD160。RIPEMD160的输出是定长的20字节数据(160位)，也就是一个由40个字符的十六进制字符串。</p>
<p>为了使最终用户使用这些地址时能更加清晰、易识别和易输入，比特币系统中的地址还需要进行一次Base58 Check编码。Base58 Check编码是在Base58编码结果之后添加特定的checksum(校验码)作为结尾的一种编码方式，因为它在编码中添加了针对输入错误或者变换输入错误的额外检查数据，所以这种编码提供更好的安全性。</p>
<p>Base58编码是Base64编码的子集，在Base64编码的结果字符集中去掉容易在肉眼识别时被混淆的0、大写的O、小写的L、大写的I以及加号(+)和出号(/)；所以其编码结果字符集是由1到9的数字，加上所有大小写英文字母中除大写的O、小写的L和大写的I以外的所有字符组成。</p>
<p>Base58 Check编码的具体规则如图所示。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/Base58Check编码的具体规则.png" alt="Base58Check编码的具体规则"></p>
<p>具体到比特币地址的编码中，需要使用版本前缀为0x00，payload就是比特币地址A，是公钥K经过HASH160计算得到的20字节的哈希值。经过上图的计算过程，最后由Bash58编码计算，得到一个以字符1开头的编码结果。所以在比特币主网上使用的大部分比特币地址都是1开头的一个Base58字符串。</p>
<p><strong>Base58编码并不是单向的哈希函数，它是可解码的；</strong>比特币中对地址以及其他需要人来识别、记录、输入的数据进行编码转换仅仅是出于易用性的目的，可以理解为应用层的优化；在内部计算或者脚本系统中会直接使用公钥K或者K的HASH160哈希值A。</p>
<p>比特币系统的另一种地址Pay-to-Script-Hash Address与脚本系统相关，下一讲再介绍。</p>
<h2 id="交易"><a href="#交易" class="headerlink" title="交易"></a>交易</h2><p>比特币系统中的交易是由若干输入和若干输出组成的。比特币交易中的输出只有两个字段：value和scrpitPubKey。value字段表示输出所包含的可以用来使用的比特币的数量；该字段的数值单位是satoshi(聪)，比特币的最小单位，相当于$10^{-8}$比特币。另一个字scrpitPubKey代表一个可以自定义的密码学条件，这个字段也被称为”锁定脚本(locking script)”或者”见证脚本(witness script)”；它的具体数值是一段可执行脚本代码，只有当这段脚本代码的最终执行结果为true时，这个输出才可被消费。</p>
<p>比特币系统的整个数据模型围绕一个简单的”输出”来构造。比特币系统中由两种交易，一种是系统中的绝大部分交易，由若干输入和输出组成；另一种特殊的交易叫做coinbase transaction，这种交易没有输入，且只有一个输出；它们是比特币系统中每个区块的第一个交易，是由找到该区块的矿工来创建的。coinbase transaction中的唯一输出的value是根据协议所固定的区块奖励；区块奖励的初始值为50BTC，每21万个区块，大概4年左右，区块奖励减半；目前处于第二个减半期，每个区块的奖励为12.5BTC，而该减半期将会在2020年结束。coinbase transaction中的唯一输出中的scrpitPubKey是一个由找到该区块的矿工自定义的锁定脚本，通常需要矿工所控制的地址对应私钥才可解开，因此只有找到该区块的矿工才能消费这个12.5BTC的输出。这种产生比特币的机制，也是比特币的发行机制。</p>
<p>除coinbase交易外，其他交易的输入比输出稍微复杂一些。其包含4个字段：txid、vout、scriptSig和sequence。其中，txid是这个输入要消费的那个输出所在的交易的哈希值；vout是这个输入要消费的那个输出在包含它的交易中的索引顺序(从0开始)；scriptSig是可以解锁要消费的那个输出的一段脚本数据，通常称为解锁脚本(unlocking script)；而sequence则是一个通常为0xffffffff的4字节整数值。因此，”输入”实际上是对某个”输出”的引用，如果输入中的scriptSig数据可以解锁输入所指定的那个输出，那么该输入合法，可以产生这个交易中指定的新的输出。我们可以将一个输入中的可消费输出拆分为若干更小数额的新的输出；也可将若干输入，也就是若干小额的可消费输出合并为一个更大额度的新的输出。</p>
<p>在比特币中，所有的交易实际上构成一个链式的数据结构。这个链式数据结构，一定是开始于一个或多个基于coinbase交易产生的输出，经过具体的交易来进行拆分或合并，由此产生新的输出；但不管如何进行拆分或合并，系统中的某个时间点的所有可用输出，一定是与到这个时间点的所有区块的coinbase交易所产生的输出中包含的比特币总量相等。比特币系统的状态，或者说比特币网络中的全部数据状态，就是目前所有已发行比特币的一个分布情况汇总；这个分布情况，就是当前系统中所有未花费输出的全集。未花费的交易输出(unspent transaction output，UTXO)，比特币的数据模型通常被称为UTXO模型。</p>
<p>对于一个交易的具体数据来讲，必然要包含一个输入的数组和一个输出的数组。其中输入的数组可以包含任意个输入，而输出的数组则至少包含一个输出。此外，交易数据中还有个叫lock_time的字段用来指定”锁定时间”的字段。若该字段的数值为0，则表示交易不做锁定，就是被包含到任意区块中都是有效的；在这种情况下这个交易输入中的sequence字段也将被忽略。若lock_time数值大于0小于500w，则它代表一个区块高度，表示该交易不应该被包含在指定区块高度以下的区块中；如果这个字段的数值大于500w，则它表示一个Unix时间戳，表示该交易应该被包含在时间戳大于这个特定数值的区块中。在这两种情况下，若交易输入中的sequence字段数值不等于0xffffffff，则sequence字段被认为是指定一个”关联时间锁(relative timelock)”，其意义是表明这个输入需要在它所引用的输出所在的交易被包含到某个区块之后多久才可以花费这个输出。</p>
<h2 id="区块"><a href="#区块" class="headerlink" title="区块"></a>区块</h2><p>区块也是记录UTXO模型状态变动的基本单位，每个区块都会产生若干UTXO，它们可能被后续区块中的交易花费，也可能自产生之后就没有被花费过。若扫描比特币系统中的所有区块，必然能得到一个所有UTXO的分布状况(即哪些地址持有UTXO，以及它们各自持有多少)，虽然基于比特币系统中每次收款都使用新地址的原则，从这个分布状况中大概的不到更多有用的额外信息，但系统中所有UTXO的综合是一定会与当前的比特币总发行量相等。</p>
<p>具体到一个区块的数据结构，包含以下数据：</p>
<ul>
<li>区块大小(block size)：4字节数据，其数值为区块的字节数大小</li>
<li>区块头(block header)：总长度80字节的若干字段</li>
<li>交易计数(transaction counter)：1到9字节的变长数据，表示区块中包含的总交易数</li>
<li>交易数据(transactions)：变长数据，表示区块中包含的所有交易序列化之后的字节数据。</li>
</ul>
<p>其中的区块头则是区块的元数据(metadata)，由以下6字段组成</p>
<ul>
<li>Version：4字节，用来表示客户端软件/协议版本</li>
<li>Previous Block Hash：32字节，表示区块链中前一个区块(即父区块)的哈希值</li>
<li>Merkle Root：32字节，表示由当前区块中的所有交易所组成的Merkle Tree的根节点哈希值</li>
<li>Timestamp：4字节，表示标志区块创建时间的Unix时间戳</li>
<li>Difficulty Target：4字节，表示区块的工作量证明难度值目标</li>
<li>Nonce：4字节，表示基于工作量证明算法找到符合难度目标的结果所实际进行的尝试次数。</li>
</ul>
<p>#比特币的脚本系统</p>
<p>在比特币的核心数据结构“输出”中有一个字段 scriptPubKey 是用来保存比特币脚本的。这种脚本可以看作是一种汇编语言，有自己的指令集，并且是基于“栈(stack)” (一种先进后出的线性数据结构)来执行的。</p>
<p>与其他类汇编的语言一样，比特币的脚本语言的指令也都是用一字节二进制数值来表示的， 并有各自的标识符，方便人工阅读或编写程序。比如 OP_EQUAL，指令数值为 0x87，可以用来判断栈顶的两个元素是否相等;又比如 OP_SHA256，指令数值为 0xa8，可以计算栈顶元素的 SHA256 哈希值。</p>
<p>比特币的脚本指令分为十大类:</p>
<p>● 常数:包含了有固定意义的常数，比如将 -1、0(假)、1(真)、2 到 16 的常数压栈、将后续若干字节数据压栈等 8 个指令。</p>
<p>● 流程控制:包含了条件判断、空操作、设置无效标志(OP_VERIFY)和返回数据 (OP_RETURN)等 7 个指令。</p>
<p>● 栈操作:包含了栈内单元素交换、复制，栈内双元素交换、复制，栈内元素弹出以及对栈状态的查询操作等 19 个指令。</p>
<p>● 字符串操作:目前仅包含获取后续字符串长度操作这 1 个指令。早期的字符串拼接操作指令已经禁止。</p>
<p>● 位运算:目前仅包含等于(OP_EQUAL)操作和等于后设置无效标志(OP_EQUALVERIFY) 这两个指令。早期的位运算指令已经禁止。</p>
<p>● 算术运算:目前仅包含加减法、算术非、布尔值运算和数值比较操作等 20 个指令。早期的乘除法、模运算、移位运算已经禁止。</p>
<p>●密码学操作:包含了 RIPEMD160、SHA1、SHA256、HASH160(先做 SHA256 再做RIPEMD160)、HASH256(做两次 SHA256)以及检查签名数据、多重签名数据操作的共 10个指令。</p>
<p>●锁定时间:与锁定时间(Locktime)处理相关的两个指令。“锁定时间”操作可以用来限定某个 UTXO 只有在超过某个指定的时间戳之后才能被“花费/使用”。</p>
<p>●伪指令:用来代替 HASH160、公钥数据和无效操作码的三个占位指令。</p>
<p>●保留字:6 个仅在未执行的条件分支中才能正常通过，否则将设置交易无效标志的保留字和其他所有 0 到 255 值域范围内未明确定义功能的指令数值(这些指令在执行时会被忽略)。</p>
<p>完整的比特币脚本命令及其实际功能的解释，可以在比特币的<a href="httts://en.bitcoin.it/wiki/Script" target="_blank" rel="noopener">wiki</a>中找到。</p>
<p>下面通过一个具体脚本实例来看看比特币的脚本系统是如何运作的。比如有如 下脚本命令:</p>
<p>2 3 OP_ADD 5 OP_EQUAL</p>
<p>如果你了解汇编语言，应该很容易看懂，这里是为了方便阅读使用了所谓的“指令式”汇编语言的写法。其具体执行过程就是:</p>
<p>1.将数值 2 压入栈顶。</p>
<p>2.将数值 3 压入栈顶;此时，栈中就将存在两个元素，栈顶是 3，其下是 2。</p>
<p>3.执行 OP_ADD，也就是加法指令，这个指令会从栈顶弹出两个元素，按顺序就是 3 和 2，然后执行加法运算，并将结果 5 放回栈顶。</p>
<p>4.将数值 5 压入栈顶，这样栈顶的元素将是 5，其下的元素是刚刚的加法计算结果 5。</p>
<p>5.执行OP_EQUAL，这个指令会从栈顶弹出两个元素，然后比较它们的数值，如果相同,则将数值 1(也就是 true)放回栈顶;反之，则将数值 0 (也就是 false)放回栈顶。 所以这里的执行结果就是栈顶有一个元素，其数值为 1。</p>
<p>这就是一个基于栈来执行比特币脚本的大致过程。</p>
<p>当然，比特币的脚本系统本身的语言能力相对比较弱，它甚至不是完整的汇编语言，不支持循环，也就不是“图灵完备”的。但它还是可以完成一些相对复杂的功能的。下面我就来简单介绍一下我们可以利用比特币的脚本系统来做哪些事。</p>
<p>##比特币交易中的锁定脚本和解锁脚本</p>
<p>首先就是比特币交易中对脚本系统的使用，这也是最初设计脚本系统的初衷。</p>
<p>已知，在比特币交易的“输出”中有一个字段 scriptPubKey，保存的是“锁定脚本”。锁定脚本也就是一个自定义的谜题，以此来限定只有能解开此谜题的那个后续“输入”才能花费/使用这个“输出”。</p>
<p>对于比特币系统中的绝大部分转账交易，其锁定脚本都是类似的，叫做“Pay-to-Public-Key- Hash”或“P2PKH”脚本，这个脚本的写法是固定的，如下所示:</p>
<p>OP_DUP OP_HASH160 &lt;Public Key Hash&gt; OP_EQUALVERIFY OP_CHECKSIG</p>
<p>其中的 &lt;Public Key Hash&gt;就是收款人的地址所对应的公钥的 RIPEMD160 哈希值，这个公钥哈希可以通过收款人的比特币地址解码得到（比特币地址是公钥哈希通过base58 check编码得到）。</p>
<p>那么后续交易中的“输入”要使用这个输出，就必须提供一个“解锁脚本”。也就是比特币交易的“输入”数据的 scriptSig 字段。对于上述锁定脚本，其解锁脚本的写法也是固定的， 如下所示:</p>
<p>&lt;Signature&gt; &lt;Public Key&gt;</p>
<p>其中的 &lt;PublicKey&gt; 就是收款人的公钥，&lt;Signature&gt; 就是用收款人的私钥对整个交易数据的哈希值的签名。</p>
<p>比特币系统在验证后续交易的“输入”的合法性时，会把后续交易输入中的 scriptSig 和这个输入所引用的输出中的 scirptPubKey 这两个字段的值拼接在一起组成一个脚本代码，并执行，如果这个脚本代码最终在栈顶返回 1(也就是 true)这个“输入”才是合法的。在上述这个最常见的例子里，拼接之后的完整验证脚本代码就将是:</p>
<p>&lt;Signature&gt; &lt;Public Key&gt; OP_DUP OP_HASH160 &lt;Public Key Hash&gt; OP_EQUALVERIFY OP_CHECKSIG</p>
<p>其执行过程就是:</p>
<p>1.将 Signature、Public Key 压栈，此时栈顶为 Public Key，其下为 Signature。</p>
<p>2.执行 OP_DUP，这个指令会复制栈顶元素并压栈，于是栈顶为 Public Key，其下顺序为Public Key、Signature。</p>
<p>3.执行 OP_HASH160，这个指令会弹出栈顶元素并计算 RIPEMD160 哈希，并将计算结果压栈，于是栈顶为 Public Key Hash，其下顺序为 Public Key 和 Signature。</p>
<p>4.将 Public Key Hash 压栈，于是栈顶为 Public Key Hash，其下顺序为 Public Key Hash、Public Key 和 Signature。</p>
<p>5.执行 OP_EQUALVERIFY，这个指令会从栈顶弹出两个元素（步骤4 Public Key Hash和步骤3 Public Key Hash），如果这两个元素数值不相等，直接将交易标记为非法，反之，则继续执行，不向栈内添加数据。</p>
<p>6.执行 OP_CHECKSIG，这个指令会从栈顶弹出两个元素（ Public Key 和 Signature），按顺序作为公钥和签名数据，然后这个指令会基于椭圆曲线数字签名算法通过当前交易数据和签名数据计算得到公钥;如果计算得到的公钥与从栈顶取出的 Public Key 相同，则在栈顶压回 1(true)，否则压回 0(false)。</p>
<p>如果最终的执行结果是栈顶有一个数值为 1 的元素，则这个“输入”就是合法输入。也就是后续的“输入”可以解锁它所引用的“输出”。</p>
<p>这显然是一个非常漂亮的设计，在实现了基本的转账功能的同时，还提供了额外的灵活性，让我们可以通过这种“锁定脚本”和“解锁脚本”实现一些更复杂的功能，比如多重签名。</p>
<p>##多重签名(Multisignature)</p>
<p>多重签名是我们可以要求仅当指定的 N 个公钥中的 M 个提供了对应的签名才可以解锁使用某个“输出”。这种“输出”的 scriptPubKey，也就是锁定脚本的写法也是固定的，如下所示:</p>
<p>M &lt;Public Key 1&gt; &lt;Public Key 2&gt; … &lt;Public Key N&gt; N CHECKMULTISIG</p>
<p>与之相应的解锁脚本就应该是 M 个 Signature 数据。所以要计算的完整脚本应该是如下格 式:</p>
<p>&lt;Signature 1&gt;&lt;Signature 2&gt; … &lt;Signature M&gt;</p>
<p>M &lt;Public Key 1&gt; &lt;Public Key 2&gt; … &lt;Public Key N&gt; N CHECKMULTISIG</p>
<p>这个脚本的执行也很容易理解，CHECKMULTISIG 指令会从栈顶弹出 M + N + 2 （2=&gt;M and N）个元素， 然后进行相应的计算检查，这里不再详细罗列了。</p>
<p>这里有一个很有趣的事情，就是目前的比特币客户端实现中实际上是有个 bug 的:如果我们仅按上述方式在后续“输入”的 scriptSig 里给出 M 个签名数据，这个脚本的执行会失败;这是因为 CHECKMULTISIG 指令实际上会从栈顶弹出 M+N+3 个元素，而不是理论上的 M + N + 2 个元素。所以这要求我们在实际设定 scriptSig 的时候需要多设定一个元素的数据，这个元素的数据可以是任意数值(通常我们就用 0 来设置)。于是目前来说，可以验证通过的 scriptSig 应该如下所示:</p>
<p>0 &lt;Signature 1&gt; &lt;Signature 2&gt; … &lt;Signature M&gt;</p>
<p>这当然是个客户端代码实现上的 bug，但如果要修改它，会影响太多的应用和外围工具，乃至对历史交易中输出数据的使用，所以目前这个 bug 也已经成为事实上的规则。这大概也是在区块链世界里所谓“代码即法律(code is law)”文化的一种独特的现象。</p>
<p>##Pay-to-Script-Hash</p>
<p>这是一种改进的锁定脚本，以刚刚介绍的多重签名锁定脚本为例，在使用了 Pay-to-Script- Hash 之后，锁定脚本和对应的解锁脚本将变为如下形式:</p>
<p>偿付脚本(redeem script):M &lt;PubKey1&gt; &lt;PubKey2&gt; … &lt;PubKeyN&gt;N CHECKMULTISIG</p>
<p>锁定脚本(locking script):HASH160 &lt;Hash160 of redeem script&gt; EQUAL</p>
<p>解锁脚本(unlocking script):&lt;Sig1&gt; &lt;Sig2&gt; … &lt;SigM&gt; &lt;redeem script&gt;</p>
<p>很明显，这种形式是将原始“偿付脚本(redeem script)”的保存从“输出”转移到“输入”（原本偿付脚本redeem script是在锁定脚本中，现在锁定脚本中保存redeem script的哈希值，将redeem script放入解锁脚本中保存）。“输出”中需要保存的锁定脚本的数据量变得很小，且与偿付脚本的实际大小无关。 因为锁定脚本是要保存到交易的输出中的，所以这实际上是大幅度减小了发送比特币的一 方需要构造的交易的实际数据大小，也就降低了发送比特币的一方需要支付的手续费(因为比特币中的交易手续费是基于交易数据的实际字节数大小来计算的)。这样的话，针对偿付脚本数据的相应手续费，也就不需要在对应的“输出”还没有被花费/使用时就预先支付了。</p>
<p>##Pay-to-Script-Hash 地址</p>
<p>Pay-to-Script-Hash其实就以刚刚介绍的“偿付脚本”的 RIPEMD160 哈希值作为原始地址进行 Base58 Check 编码所获得的地址。不过需要注意的是，在针对偿付脚本的 RIPEMD160 哈希值进行 Base58 Check 编码时，需要使用 0x05 作为版本前缀（之前的版本前缀为0x00，编码结果以1开头），所以其编码结果将以 3 开头。这也就是我们会在比特币主网上见到的那些以 3 开头的地址。</p>
<p>Pay-to-Script-Hash 地址最大的优点就是隐藏了“偿付脚本”的具体数据，也隐藏了收款人的公钥。在收款人没有花费/使用这个地址上的输出(也就是 UTXO)的情况下，任何人都无从获得任何额外信息，这使交易的隐私性有了一定程度的提升。</p>
<p>##OP_RETURN 指令</p>
<p>这是一个非常特殊的脚本指令，它将直接把交易标记为非法交易，所以如果一个“输出”的 scriptPubKey 字段中包含了这个指令，那么这个输出就将变为不可花费/使用，也就是相当于会把这个输出中的比特币永远锁定在这个输出中;所以这样的“输出”并不是 UTXO，因为它们不可花费/使用。</p>
<p>其实，包含了这个指令的输出通常也被称为“数据记录输出(Data Recording Output)”，那么它的意义也就很明显了，就是可以用来记录一定数量的数据。这个指令可以附加最多 80 字节的数据，可以由创建输出的人或程序自定义。因为这个指令和其附加的数据是作为输出的一部分永久保留在区块链上的，所以它可以作为某些应用程序在比特币区块链上保存自定义数据的途径来使用区块链的不可篡改、不可伪造的这些特性。</p>
<p>比如，应用程序可以把特定的链外数据的哈希值通过 OP_RETURN 指令保存到某个数额很小的“输出”中，来作为它们所使用的原始数据的一个不可篡改的版本标识，以此来获得数据的“可信度”。</p>
<p>#比特币系统中的其他细节</p>
<p>##BIP</p>
<p>所谓 BIP，也就是“比特币改进建议(Bitcoin Improvement Proposal )”，它实际上是一种公开的社区治理方式，也在事实上成为了一种典范式的标准方式。</p>
<p>BIP 是一个 Github 上的开源工程，任何社区参与者都可以在这个工程中提出自己对比特币项目的意见和建议，包括技术的和非技术的。如果某个提议被社区内大部分人所赞同，那么它就可以成为最终的 BIP，会被社区所遵守，或由工程贡献者反映到比特币的客户端代码实现中或者与比特币相关的其他应用程序的实现中。</p>
<p>这是一种非常好的公开的开源社区治理方式，也被大多数开源的加密货币项目所采用，包括以太坊。</p>
<p>##关于区块头中的 nonce</p>
<p>区块头数据中的 nonce 并不是一个随机数，而是一个矿工为找到符合难度目标的哈希值所做的哈希计算次数，也就是总的尝试次数，可以代表这个矿工的实际工作量。我想你大概也会产生一个疑问，既然这个 nonce 只是个尝试次数，并不是实际找到的那个哈希值，那么其他节点接收到这个区块时，如何验证这个结果是否真实呢?(用区块头的这 80 字节数据连接上 nonce 一起作为输入数据来计算 SHA-256 哈希值，最终的哈希值需要满足难度目标)</p>
<p>比特币系统的工作量证明算法在这里采用了一个或许看起来比较“笨”的简化方案:</p>
<p>我们已经在“比特币的基础数据结构”中看到，比特币系统中的区块头是一个由 6 个定长字段组成的，总长度 80 字节的数据。比特币的工作量证明算法其实就是简单地用区块头的这 80 字节数据连接上 nonce 一起作为输入数据来计算 SHA-256 哈希值。如果计算结果不满足难度目标，则对 nonce 加 1 之后再进行计算，直到计算结果哈希值满足难度目标。 所以最终的 nonce 其实就是为达到难度目标所做的哈希计算的总次数。</p>
<p>于是，当其他节点接收到一个新区块时，就会首先用此区块的区块头数据连接上区块头中的 nonce 来计算其 SHA-256 哈希值，只有实际计算结果满足当前难度目标时，才接受新区块作为合法区块。(当然，一个新区块的合法性并不仅仅取决于 nonce 的正确性。)</p>
<p>##如何实现每个交易使用一个独立的地址</p>
<p>比特币系统建议用户为每笔收款都创建新的地址，也就是尽量使每个收款地址仅关联一次交易，以此来提高交易的隐私性。那么在软件工程上如何做到这一点呢?这实际上是一个所谓“钱包(wallet)”的机制。</p>
<p>“钱包”这个词目前已经成为一个通用词汇，泛指加密货币中用来管理用户私钥、地址以及追踪余额、帮助最终用户与加密货币网络进行交互的一种应用程序。其中对私钥、地址的管理当然就是它们最重要的功能。</p>
<p>在比特币中，钱包的技术方案也经过了数次改进。最初的比特币钱包是通过保存若干随机生成的私钥来实现对“每交易一地址”的支持的。但这种方案的缺点非常明显，我们必须对钱包数据进行完整备份或者挨个记录已经使用过的私钥，这显然很不安全、也很不方便。于是一种新的基于“种子(seed)”的、“确定性(deterministic)”的新型钱包(BIP-32)就应运而生了。这种钱包中的私钥都是通过在最初创建钱包时随机产生一个“种子”，依照特定的算法来生成、扩展出来的，所以我们只需要备份、记录最初的那个“种子”即可通过相同的 算法恢复所有可能的私钥，这显然是更有效率的方式。这种新型钱包的典型应用就是著名的 “HD 钱包(hierarchical  deterministic wallet)”，它的逻辑概念可以用下图来表示:</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/HD钱包逻辑.png" alt="HD钱包逻辑">     </p>
<p>这种方案就是由创建钱包时随机产生的“ 种子( seed )”来生成一个“主密钥(master key )”， 然后基于“主密钥”再生成若干“子密钥(child key)”，“子密钥”再生成“孙密钥(grandchild key)”;以这样的派生方式来管理所有可用密钥。注意这里基于派生关系生成的密钥都是“私钥”，最终使用的地址则是由“孙密钥”加上一个顺序增加的整数“索引”来生成的，所以这种钱包中管理的可用密钥是非常多的。</p>
<p>那么在解决了私钥的管理之后，另一个问题就是如何使最重要的“种子”数据更加安全、易识别、易恢复。于是所谓的“助记词(Mnemonic Code)”(BIP-39)就出现了。助记词通常是一组英文单词，最终用户可以更容易地识别、记录它们，这通常会使用实体纸张、卡片,所以可以避免电子备份所带来的安全问题;只要用户能按顺序提供这些简单的英文单词，钱包程序就可以随时恢复“种子”，也就是可以恢复所有可用私钥，这就大大提高了钱包的可用性、易用性和安全性。</p>
<p>目前的主流钱包程序都是基于助记词的 HD 钱包，这种钱包设计思路也成为了一种通用的加密货币钱包的设计标准，可以适用于所有使用以椭圆曲线数字签名算法的公私钥对作为地址标识的加密货币。这种通用的密钥派生关系可以表示为:</p>
<p>m / purpose’ / coin_type’ / account’ / change / address_index</p>
<p>其中，m 表示主密钥(由基于助记词生成的“种子”来生成);purpose 使用固定的常数作为一级分支标志(比如对于比特币固定使用 44);coin_type 是由应用程序定义的二级分支标志，可以用来表示其他不同的加密货币(比如同样使用椭圆曲线数字签名私钥的莱特币或者其他加密币); account 即账户标识，通常用一个从 0 开始的顺序号来区分不同的账户; change 用常量 0 和 1 来表示后续地址是否为外部可见，这一层可以用作公共扩展(即由应用程序进行自定义扩展);最后的 address_index 也就是用来生成地址的顺序号，从 0 开 始，同样可以用作公共扩展。</p>
<p>这种通用的钱包，也就是基于 BIP-32、BIP-39、BIP-43 和 BIP-44 标准来构造的钱包;这也可以看作是比特币生态对整个加密货币领域的一项重要贡献。</p>
<p>##SPV 节点</p>
<p>所谓 SPV 节点即“简化的交易验证节点(Simplified Payment Verification Node)”，也就是我们通常所说的“轻客户端(lightweight client)”节点。</p>
<p>很明显，并不是所有节点都有能力、有必要保存完整的区块链数据，比如在智能手机、便携电脑或者嵌入式系统中通常并不具备保存所有历史数据的条件。所以我们就需要一种技术方案来允许运行在这些设备上的节点客户端程序同样可以验证或创建交易数据，这就是“简化的交易验证”要解决的问题。</p>
<p>因为 SPV 节点仅会保存所有区块的区块头数据，而不是完整的所有交易数据，所以它们不能像全节点那样通过交易数据中输入对输出的引用关系追溯到最初的 coinbase 交易来验证交易数据的正确性。</p>
<p>在 SPV 节点中验证一个交易的时候，需要先向它连接到的全节点请求这个交易在其所在区块中的“Merkle Path”，也就是这个交易对应的叶节点在区块的 Merkle Tree 中到根节点的完整路径中每个分支上的另一个节点的哈希值。比如在下图的 Merkle Tree 中，交易 K 的 Merkle Path 就是 HL、HIJ、HMNOP、HABCDEFGH。</p>
<p><img src="/RookieLinLucy666/study.github.io/2019/05/25/从比特币到以太坊/MerklePath.png" alt="MerklePath">     </p>
<p>但是，Merkle Path 只能验证交易是否真的包含在特定区块中，并不能证明交易数据的正确性;这是因为 SPV 节点中没有完整的历史数据，所以无法追溯完整的交易引用链来证明这个交易的输入中引用的输出没有被“双花(double-spend)”。因此，SPV 节点通常需要等待包含了要验证的交易的区块之后至少已经又添加了 6 个区块以上时，才认为交易已经被网络中的其他全节点检查过并接受为正确数据，不再可能更改。</p>
<p>由于 SPV 节点本身并不保存具体的交易数据，所以与全节点相比，它们更容易受到“女巫攻击(Sybil Attack)”的影响，也就是如果它们被大量恶意节点包围，无法连接到任何诚实节点的话，它们是无法单独检查交易合法性的。同样是因为 SPV 节点并不保存所有历史交易数据，所以它们通常只会请求那些与它们感兴趣的地址相关的交易，这也使它们的隐私性受到了巨大挑战。</p>
<p>为了解决这种隐私性风险，很多轻客户端(也就是 SPV 节点)实现方案中都允许轻客户端请求一个所谓的“Bloom 过滤器(Bloom Filter)”作为它们感兴趣的地址的过滤条件，而不是具体指定地址。Bloom 过滤器是一种用于验证存在性的单向数值映射算法，我们可以通过对输入数据的计算来验证输入数据是否存在于特定的 Bloom 过滤器中，但无法通过 Bloom 过滤器的数值反算出所要求的输入数据。通过这种方式，全节点在接收到一个新的有效交易之后，会计算这个交易是否满足 SPV 节点所指定的 Bloom 过滤器;如果满足，就将交易数据及其 Merkle Path 发送给 SPV 节点。于是 SPV 节点就可以不再需要明确暴露自己感兴趣的地址了。但即使如此，如果与 SPV 节点保持足够长时间的连接，依然会存在相应的隐私问题，所以通常 SPV 节点都会随机寻找可用的全节点来请求数据。</p>
<p>##隔离见证(Segregated Witness)</p>
<p>我们可以简单地把“隔离见证”理解为一种对使用 UTXO 的方式的改进，它其实就是将交易“输入”中的“解锁脚本(unlocking script)”字段从交易的输入数据中拿出来作为与交易输入输出数据并列的交易数据字段来处理。当然，从共识的角度来讲，还需要为“见证”数据设计对应的标识，并将由“见证”数据组成的 Merkle Tree 根节点也保存到区块头中来进行数据验证。</p>
<p>隔离见证的具体设计细节和关联技术改进方案包含在以下几个 BIP 之中:BIP-141、BIP-143、 BIP-144、BIP-145 和 BIP-173。这种看似简单的技术改进，实际上提供了很多技术优点:</p>
<p>● 交易延展性(Transaction Malleability):这也是隔离见证要解决的最主要的问题。在引入隔离见证之后，因为交易哈希(也就是 txid)不再会被可由第三方应用程序修改的字段(也就是交易输入中的 scriptSig 字段)所影响（因为是与交易输入输出数据并列的交易数据字段），所以除了创建交易的一方以外，不再有其他人能影响交易哈希，这对一些链外数据处理协议而言非常重要;比如支付通道 (payment channel)、链式交易(chained transactions)和闪电网络(lightning network) 等;因为它们需要确定的交易哈希来进行对 UTXO 的锁定和额外处理。</p>
<p>● 脚本版本(Script Versioning):在引入隔离见证之后，锁定脚本中需要加入对脚本版本的标识数据，这个特性将允许脚本的向后兼容，允许我们引入不同的操作码、语法或者语义标识，而不需要去修改历史交易数据。这对于提高比特币协议的可扩展性非常重要。 也使“软分叉(soft fork)”成为了可能(就是在不强迫所有客户端或者外围应用程序都进行代码升级的情况下就可以对脚本系统进行改进或调整)。</p>
<p>● 网络和存储扩容(Network and Storage Scaling):引入隔离见证之后，因为见证数据不再影响交易哈希，所以见证数据也就不再会影响区块头中的交易 Merkle Tree 根节点哈希，节点可以选择在用见证数据验证了交易的正确性之后不再持久化保存原始的见证数据。从长远来看，这对全节点的持久化数据存储需求是一个非常大的优化。同时对于 SPV 节点(轻客户端)而言，它们甚至可以完全忽略见证数据，因为绝大部分情况下它们都不需要验证交易的正确性，而只需要确认交易是存在的;这大概可以降低 75% 的交易数据传输量。</p>
<p>● 签名校验优化(Signature Verification Optimization):引入隔离见证将简化 CHECKSIG、 CHECKMULTISIG 操作码的具体处理，它们不再需要额外计算签名数据的哈希来验证签名（原本计算签名数据的哈希在脚本中进行，可查看比特币脚本系统章节），这是一个对节点计算量的大幅降低。</p>

      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2019</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color4">区块链</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2019/05/25/从比特币到以太坊/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
    <article id="post-python-Getting-along-with-Integer-Partitions" class="article article-type-post  article-index" itemscope itemprop="blogPost">
  <div class="article-inner">
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="article-title" href="/study.github.io/2019/05/22/python-Getting-along-with-Integer-Partitions/">python:Getting along with Integer Partitions</a>
    </h1>
  

        
        <a href="/study.github.io/2019/05/22/python-Getting-along-with-Integer-Partitions/" class="archive-article-date">
  	<time datetime="2019-05-22T08:29:05.000Z" itemprop="datePublished"><i class="icon-calendar icon"></i>2019-05-22</time>
</a>
        
      </header>
    
<!-- 目录内容 -->

<!-- 目录内容结束 -->
    <div class="article-entry" itemprop="articleBody">
      
        <h1 id="Getting-along-with-Integer-Partitions"><a href="#Getting-along-with-Integer-Partitions" class="headerlink" title="Getting along with Integer Partitions"></a>Getting along with Integer Partitions</h1>
        
          <a class="article-more-a" href="/study.github.io/2019/05/22/python-Getting-along-with-Integer-Partitions/#more">more >></a>
        
      

      
    </div>
    <div class="article-info article-info-index">
      
      
	<div class="article-tag tagcloud">
		<i class="icon-price-tags icon"></i>
		<ul class="article-tag-list">
			 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">2019</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color2">python</a>
        		</li>
      		 
        		<li class="article-tag-list-item">
        			<a href="javascript:void(0)" class="js-tag article-tag-list-link color5">algorithm</a>
        		</li>
      		
		</ul>
	</div>

      

      
        <p class="article-more-link">
          <a class="article-more-a" href="/study.github.io/2019/05/22/python-Getting-along-with-Integer-Partitions/">展开全文 >></a>
        </p>
      

      
      <div class="clearfix"></div>
    </div>
  </div>
</article>

<aside class="wrap-side-operation">
    <div class="mod-side-operation">
        
        <div class="jump-container" id="js-jump-container" style="display:none;">
            <a href="javascript:void(0)" class="mod-side-operation__jump-to-top">
                <i class="icon-font icon-back"></i>
            </a>
            <div id="js-jump-plan-container" class="jump-plan-container" style="top: -11px;">
                <i class="icon-font icon-plane jump-plane"></i>
            </div>
        </div>
        
        
    </div>
</aside>




  
  
    <nav id="page-nav">
      <a class="extend prev" rel="prev" href="/study.github.io/">&laquo; Prev</a><a class="page-number" href="/study.github.io/">1</a><span class="page-number current">2</span><a class="page-number" href="/study.github.io/page/3/">3</a><a class="extend next" rel="next" href="/study.github.io/page/3/">Next &raquo;</a>
    </nav>
  


          </div>
        </div>
      </div>
      <footer id="footer">
  <div class="outer">
    <div id="footer-info">
    	<div class="footer-left">
    		&copy; 2020 Yijing Lin
    	</div>
      	<div class="footer-right">
      		<a href="http://hexo.io/" target="_blank">Hexo</a>  Theme <a href="https://github.com/litten/hexo-theme-yilia" target="_blank">Yilia</a> by Litten
      	</div>
		</div>
		<div calss="count-span">
			<span id="busuanzi_container_site_pv">
				总访问量: <span id="busuanzi_value_site_pv"></span>|
			</span>
			<span id="busuanzi_container_site_uv">
				总访客: <span id="busuanzi_value_site_uv"></span>
			</span>
		</div>
  </div>
</footer>
<script async src="//dn-lbstatics.qbox.me/busuanzi/2.3/busuanzi.pure.mini.js"></script>

    </div>
    <script>
	var yiliaConfig = {
		mathjax: false,
		isHome: true,
		isPost: false,
		isArchive: false,
		isTag: false,
		isCategory: false,
		open_in_new: false,
		toc_hide_index: true,
		root: "/study.github.io/",
		innerArchive: true,
		showTags: false
	}
</script>
<script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>

<script>!function(t){function n(e){if(r[e])return r[e].exports;var i=r[e]={exports:{},id:e,loaded:!1};return t[e].call(i.exports,i,i.exports,n),i.loaded=!0,i.exports}var r={};n.m=t,n.c=r,n.p="./",n(0)}([function(t,n,r){r(195),t.exports=r(191)},function(t,n,r){var e=r(3),i=r(52),o=r(27),u=r(28),c=r(53),f="prototype",a=function(t,n,r){var s,l,h,v,p=t&a.F,d=t&a.G,y=t&a.S,g=t&a.P,b=t&a.B,m=d?e:y?e[n]||(e[n]={}):(e[n]||{})[f],x=d?i:i[n]||(i[n]={}),w=x[f]||(x[f]={});d&&(r=n);for(s in r)l=!p&&m&&void 0!==m[s],h=(l?m:r)[s],v=b&&l?c(h,e):g&&"function"==typeof h?c(Function.call,h):h,m&&u(m,s,h,t&a.U),x[s]!=h&&o(x,s,v),g&&w[s]!=h&&(w[s]=h)};e.core=i,a.F=1,a.G=2,a.S=4,a.P=8,a.B=16,a.W=32,a.U=64,a.R=128,t.exports=a},function(t,n,r){var e=r(6);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n){var r=t.exports="undefined"!=typeof window&&window.Math==Math?window:"undefined"!=typeof self&&self.Math==Math?self:Function("return this")();"number"==typeof __g&&(__g=r)},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n,r){var e=r(126)("wks"),i=r(76),o=r(3).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n,r){var e=r(94),i=r(33);t.exports=function(t){return e(i(t))}},function(t,n,r){t.exports=!r(4)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(2),i=r(167),o=r(50),u=Object.defineProperty;n.f=r(10)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){t.exports=!r(18)(function(){return 7!=Object.defineProperty({},"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(14),i=r(22);t.exports=r(12)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(20),i=r(58),o=r(42),u=Object.defineProperty;n.f=r(12)?Object.defineProperty:function(t,n,r){if(e(t),n=o(n,!0),e(r),i)try{return u(t,n,r)}catch(t){}if("get"in r||"set"in r)throw TypeError("Accessors not supported!");return"value"in r&&(t[n]=r.value),t}},function(t,n,r){var e=r(40)("wks"),i=r(23),o=r(5).Symbol,u="function"==typeof o;(t.exports=function(t){return e[t]||(e[t]=u&&o[t]||(u?o:i)("Symbol."+t))}).store=e},function(t,n,r){var e=r(67),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){var e=r(46);t.exports=function(t){return Object(e(t))}},function(t,n){t.exports=function(t){try{return!!t()}catch(t){return!0}}},function(t,n,r){var e=r(63),i=r(34);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(21);t.exports=function(t){if(!e(t))throw TypeError(t+" is not an object!");return t}},function(t,n){t.exports=function(t){return"object"==typeof t?null!==t:"function"==typeof t}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n){var r={}.hasOwnProperty;t.exports=function(t,n){return r.call(t,n)}},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n,r){var e=r(11),i=r(66);t.exports=r(10)?function(t,n,r){return e.f(t,n,i(1,r))}:function(t,n,r){return t[n]=r,t}},function(t,n,r){var e=r(3),i=r(27),o=r(24),u=r(76)("src"),c="toString",f=Function[c],a=(""+f).split(c);r(52).inspectSource=function(t){return f.call(t)},(t.exports=function(t,n,r,c){var f="function"==typeof r;f&&(o(r,"name")||i(r,"name",n)),t[n]!==r&&(f&&(o(r,u)||i(r,u,t[n]?""+t[n]:a.join(String(n)))),t===e?t[n]=r:c?t[n]?t[n]=r:i(t,n,r):(delete t[n],i(t,n,r)))})(Function.prototype,c,function(){return"function"==typeof this&&this[u]||f.call(this)})},function(t,n,r){var e=r(1),i=r(4),o=r(46),u=function(t,n,r,e){var i=String(o(t)),u="<"+n;return""!==r&&(u+=" "+r+'="'+String(e).replace(/"/g,"&quot;")+'"'),u+">"+i+"</"+n+">"};t.exports=function(t,n){var r={};r[t]=n(u),e(e.P+e.F*i(function(){var n=""[t]('"');return n!==n.toLowerCase()||n.split('"').length>3}),"String",r)}},function(t,n,r){var e=r(115),i=r(46);t.exports=function(t){return e(i(t))}},function(t,n,r){var e=r(116),i=r(66),o=r(30),u=r(50),c=r(24),f=r(167),a=Object.getOwnPropertyDescriptor;n.f=r(10)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(24),i=r(17),o=r(145)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n){t.exports={}},function(t,n){t.exports=!0},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(14).f,i=r(8),o=r(15)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(40)("keys"),i=r(23);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(5),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n,r){var e=r(21);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(36),u=r(44),c=r(14).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){n.f=r(15)},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n){t.exports=function(t){if(void 0==t)throw TypeError("Can't call method on  "+t);return t}},function(t,n,r){var e=r(4);t.exports=function(t,n){return!!t&&e(function(){n?t.call(null,function(){},1):t.call(null)})}},function(t,n,r){var e=r(53),i=r(115),o=r(17),u=r(16),c=r(203);t.exports=function(t,n){var r=1==t,f=2==t,a=3==t,s=4==t,l=6==t,h=5==t||l,v=n||c;return function(n,c,p){for(var d,y,g=o(n),b=i(g),m=e(c,p,3),x=u(b.length),w=0,S=r?v(n,x):f?v(n,0):void 0;x>w;w++)if((h||w in b)&&(d=b[w],y=m(d,w,g),t))if(r)S[w]=y;else if(y)switch(t){case 3:return!0;case 5:return d;case 6:return w;case 2:S.push(d)}else if(s)return!1;return l?-1:a||s?s:S}}},function(t,n,r){var e=r(1),i=r(52),o=r(4);t.exports=function(t,n){var r=(i.Object||{})[t]||Object[t],u={};u[t]=n(r),e(e.S+e.F*o(function(){r(1)}),"Object",u)}},function(t,n,r){var e=r(6);t.exports=function(t,n){if(!e(t))return t;var r,i;if(n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;if("function"==typeof(r=t.valueOf)&&!e(i=r.call(t)))return i;if(!n&&"function"==typeof(r=t.toString)&&!e(i=r.call(t)))return i;throw TypeError("Can't convert object to primitive value")}},function(t,n,r){var e=r(5),i=r(25),o=r(91),u=r(13),c="prototype",f=function(t,n,r){var a,s,l,h=t&f.F,v=t&f.G,p=t&f.S,d=t&f.P,y=t&f.B,g=t&f.W,b=v?i:i[n]||(i[n]={}),m=b[c],x=v?e:p?e[n]:(e[n]||{})[c];v&&(r=n);for(a in r)(s=!h&&x&&void 0!==x[a])&&a in b||(l=s?x[a]:r[a],b[a]=v&&"function"!=typeof x[a]?r[a]:y&&s?o(l,e):g&&x[a]==l?function(t){var n=function(n,r,e){if(this instanceof t){switch(arguments.length){case 0:return new t;case 1:return new t(n);case 2:return new t(n,r)}return new t(n,r,e)}return t.apply(this,arguments)};return n[c]=t[c],n}(l):d&&"function"==typeof l?o(Function.call,l):l,d&&((b.virtual||(b.virtual={}))[a]=l,t&f.R&&m&&!m[a]&&u(m,a,l)))};f.F=1,f.G=2,f.S=4,f.P=8,f.B=16,f.W=32,f.U=64,f.R=128,t.exports=f},function(t,n){var r=t.exports={version:"2.4.0"};"number"==typeof __e&&(__e=r)},function(t,n,r){var e=r(26);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(183),i=r(1),o=r(126)("metadata"),u=o.store||(o.store=new(r(186))),c=function(t,n,r){var i=u.get(t);if(!i){if(!r)return;u.set(t,i=new e)}var o=i.get(n);if(!o){if(!r)return;i.set(n,o=new e)}return o},f=function(t,n,r){var e=c(n,r,!1);return void 0!==e&&e.has(t)},a=function(t,n,r){var e=c(n,r,!1);return void 0===e?void 0:e.get(t)},s=function(t,n,r,e){c(r,e,!0).set(t,n)},l=function(t,n){var r=c(t,n,!1),e=[];return r&&r.forEach(function(t,n){e.push(n)}),e},h=function(t){return void 0===t||"symbol"==typeof t?t:String(t)},v=function(t){i(i.S,"Reflect",t)};t.exports={store:u,map:c,has:f,get:a,set:s,keys:l,key:h,exp:v}},function(t,n,r){"use strict";if(r(10)){var e=r(69),i=r(3),o=r(4),u=r(1),c=r(127),f=r(152),a=r(53),s=r(68),l=r(66),h=r(27),v=r(73),p=r(67),d=r(16),y=r(75),g=r(50),b=r(24),m=r(180),x=r(114),w=r(6),S=r(17),_=r(137),O=r(70),E=r(32),P=r(71).f,j=r(154),F=r(76),M=r(7),A=r(48),N=r(117),T=r(146),I=r(155),k=r(80),L=r(123),R=r(74),C=r(130),D=r(160),U=r(11),W=r(31),G=U.f,B=W.f,V=i.RangeError,z=i.TypeError,q=i.Uint8Array,K="ArrayBuffer",J="Shared"+K,Y="BYTES_PER_ELEMENT",H="prototype",$=Array[H],X=f.ArrayBuffer,Q=f.DataView,Z=A(0),tt=A(2),nt=A(3),rt=A(4),et=A(5),it=A(6),ot=N(!0),ut=N(!1),ct=I.values,ft=I.keys,at=I.entries,st=$.lastIndexOf,lt=$.reduce,ht=$.reduceRight,vt=$.join,pt=$.sort,dt=$.slice,yt=$.toString,gt=$.toLocaleString,bt=M("iterator"),mt=M("toStringTag"),xt=F("typed_constructor"),wt=F("def_constructor"),St=c.CONSTR,_t=c.TYPED,Ot=c.VIEW,Et="Wrong length!",Pt=A(1,function(t,n){return Tt(T(t,t[wt]),n)}),jt=o(function(){return 1===new q(new Uint16Array([1]).buffer)[0]}),Ft=!!q&&!!q[H].set&&o(function(){new q(1).set({})}),Mt=function(t,n){if(void 0===t)throw z(Et);var r=+t,e=d(t);if(n&&!m(r,e))throw V(Et);return e},At=function(t,n){var r=p(t);if(r<0||r%n)throw V("Wrong offset!");return r},Nt=function(t){if(w(t)&&_t in t)return t;throw z(t+" is not a typed array!")},Tt=function(t,n){if(!(w(t)&&xt in t))throw z("It is not a typed array constructor!");return new t(n)},It=function(t,n){return kt(T(t,t[wt]),n)},kt=function(t,n){for(var r=0,e=n.length,i=Tt(t,e);e>r;)i[r]=n[r++];return i},Lt=function(t,n,r){G(t,n,{get:function(){return this._d[r]}})},Rt=function(t){var n,r,e,i,o,u,c=S(t),f=arguments.length,s=f>1?arguments[1]:void 0,l=void 0!==s,h=j(c);if(void 0!=h&&!_(h)){for(u=h.call(c),e=[],n=0;!(o=u.next()).done;n++)e.push(o.value);c=e}for(l&&f>2&&(s=a(s,arguments[2],2)),n=0,r=d(c.length),i=Tt(this,r);r>n;n++)i[n]=l?s(c[n],n):c[n];return i},Ct=function(){for(var t=0,n=arguments.length,r=Tt(this,n);n>t;)r[t]=arguments[t++];return r},Dt=!!q&&o(function(){gt.call(new q(1))}),Ut=function(){return gt.apply(Dt?dt.call(Nt(this)):Nt(this),arguments)},Wt={copyWithin:function(t,n){return D.call(Nt(this),t,n,arguments.length>2?arguments[2]:void 0)},every:function(t){return rt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},fill:function(t){return C.apply(Nt(this),arguments)},filter:function(t){return It(this,tt(Nt(this),t,arguments.length>1?arguments[1]:void 0))},find:function(t){return et(Nt(this),t,arguments.length>1?arguments[1]:void 0)},findIndex:function(t){return it(Nt(this),t,arguments.length>1?arguments[1]:void 0)},forEach:function(t){Z(Nt(this),t,arguments.length>1?arguments[1]:void 0)},indexOf:function(t){return ut(Nt(this),t,arguments.length>1?arguments[1]:void 0)},includes:function(t){return ot(Nt(this),t,arguments.length>1?arguments[1]:void 0)},join:function(t){return vt.apply(Nt(this),arguments)},lastIndexOf:function(t){return st.apply(Nt(this),arguments)},map:function(t){return Pt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},reduce:function(t){return lt.apply(Nt(this),arguments)},reduceRight:function(t){return ht.apply(Nt(this),arguments)},reverse:function(){for(var t,n=this,r=Nt(n).length,e=Math.floor(r/2),i=0;i<e;)t=n[i],n[i++]=n[--r],n[r]=t;return n},some:function(t){return nt(Nt(this),t,arguments.length>1?arguments[1]:void 0)},sort:function(t){return pt.call(Nt(this),t)},subarray:function(t,n){var r=Nt(this),e=r.length,i=y(t,e);return new(T(r,r[wt]))(r.buffer,r.byteOffset+i*r.BYTES_PER_ELEMENT,d((void 0===n?e:y(n,e))-i))}},Gt=function(t,n){return It(this,dt.call(Nt(this),t,n))},Bt=function(t){Nt(this);var n=At(arguments[1],1),r=this.length,e=S(t),i=d(e.length),o=0;if(i+n>r)throw V(Et);for(;o<i;)this[n+o]=e[o++]},Vt={entries:function(){return at.call(Nt(this))},keys:function(){return ft.call(Nt(this))},values:function(){return ct.call(Nt(this))}},zt=function(t,n){return w(t)&&t[_t]&&"symbol"!=typeof n&&n in t&&String(+n)==String(n)},qt=function(t,n){return zt(t,n=g(n,!0))?l(2,t[n]):B(t,n)},Kt=function(t,n,r){return!(zt(t,n=g(n,!0))&&w(r)&&b(r,"value"))||b(r,"get")||b(r,"set")||r.configurable||b(r,"writable")&&!r.writable||b(r,"enumerable")&&!r.enumerable?G(t,n,r):(t[n]=r.value,t)};St||(W.f=qt,U.f=Kt),u(u.S+u.F*!St,"Object",{getOwnPropertyDescriptor:qt,defineProperty:Kt}),o(function(){yt.call({})})&&(yt=gt=function(){return vt.call(this)});var Jt=v({},Wt);v(Jt,Vt),h(Jt,bt,Vt.values),v(Jt,{slice:Gt,set:Bt,constructor:function(){},toString:yt,toLocaleString:Ut}),Lt(Jt,"buffer","b"),Lt(Jt,"byteOffset","o"),Lt(Jt,"byteLength","l"),Lt(Jt,"length","e"),G(Jt,mt,{get:function(){return this[_t]}}),t.exports=function(t,n,r,f){f=!!f;var a=t+(f?"Clamped":"")+"Array",l="Uint8Array"!=a,v="get"+t,p="set"+t,y=i[a],g=y||{},b=y&&E(y),m=!y||!c.ABV,S={},_=y&&y[H],j=function(t,r){var e=t._d;return e.v[v](r*n+e.o,jt)},F=function(t,r,e){var i=t._d;f&&(e=(e=Math.round(e))<0?0:e>255?255:255&e),i.v[p](r*n+i.o,e,jt)},M=function(t,n){G(t,n,{get:function(){return j(this,n)},set:function(t){return F(this,n,t)},enumerable:!0})};m?(y=r(function(t,r,e,i){s(t,y,a,"_d");var o,u,c,f,l=0,v=0;if(w(r)){if(!(r instanceof X||(f=x(r))==K||f==J))return _t in r?kt(y,r):Rt.call(y,r);o=r,v=At(e,n);var p=r.byteLength;if(void 0===i){if(p%n)throw V(Et);if((u=p-v)<0)throw V(Et)}else if((u=d(i)*n)+v>p)throw V(Et);c=u/n}else c=Mt(r,!0),u=c*n,o=new X(u);for(h(t,"_d",{b:o,o:v,l:u,e:c,v:new Q(o)});l<c;)M(t,l++)}),_=y[H]=O(Jt),h(_,"constructor",y)):L(function(t){new y(null),new y(t)},!0)||(y=r(function(t,r,e,i){s(t,y,a);var o;return w(r)?r instanceof X||(o=x(r))==K||o==J?void 0!==i?new g(r,At(e,n),i):void 0!==e?new g(r,At(e,n)):new g(r):_t in r?kt(y,r):Rt.call(y,r):new g(Mt(r,l))}),Z(b!==Function.prototype?P(g).concat(P(b)):P(g),function(t){t in y||h(y,t,g[t])}),y[H]=_,e||(_.constructor=y));var A=_[bt],N=!!A&&("values"==A.name||void 0==A.name),T=Vt.values;h(y,xt,!0),h(_,_t,a),h(_,Ot,!0),h(_,wt,y),(f?new y(1)[mt]==a:mt in _)||G(_,mt,{get:function(){return a}}),S[a]=y,u(u.G+u.W+u.F*(y!=g),S),u(u.S,a,{BYTES_PER_ELEMENT:n,from:Rt,of:Ct}),Y in _||h(_,Y,n),u(u.P,a,Wt),R(a),u(u.P+u.F*Ft,a,{set:Bt}),u(u.P+u.F*!N,a,Vt),u(u.P+u.F*(_.toString!=yt),a,{toString:yt}),u(u.P+u.F*o(function(){new y(1).slice()}),a,{slice:Gt}),u(u.P+u.F*(o(function(){return[1,2].toLocaleString()!=new y([1,2]).toLocaleString()})||!o(function(){_.toLocaleString.call([1,2])})),a,{toLocaleString:Ut}),k[a]=N?A:T,e||N||h(_,bt,T)}}else t.exports=function(){}},function(t,n){var r={}.toString;t.exports=function(t){return r.call(t).slice(8,-1)}},function(t,n,r){var e=r(21),i=r(5).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n,r){t.exports=!r(12)&&!r(18)(function(){return 7!=Object.defineProperty(r(57)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){"use strict";var e=r(36),i=r(51),o=r(64),u=r(13),c=r(8),f=r(35),a=r(96),s=r(38),l=r(103),h=r(15)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n,r){var e=r(20),i=r(100),o=r(34),u=r(39)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(57)("iframe"),e=o.length;for(n.style.display="none",r(93).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(63),i=r(34).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(8),i=r(9),o=r(90)(!1),u=r(39)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){t.exports=r(13)},function(t,n,r){var e=r(76)("meta"),i=r(6),o=r(24),u=r(11).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(4)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n){t.exports=function(t,n){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:n}}},function(t,n){var r=Math.ceil,e=Math.floor;t.exports=function(t){return isNaN(t=+t)?0:(t>0?e:r)(t)}},function(t,n){t.exports=function(t,n,r,e){if(!(t instanceof n)||void 0!==e&&e in t)throw TypeError(r+": incorrect invocation!");return t}},function(t,n){t.exports=!1},function(t,n,r){var e=r(2),i=r(173),o=r(133),u=r(145)("IE_PROTO"),c=function(){},f="prototype",a=function(){var t,n=r(132)("iframe"),e=o.length;for(n.style.display="none",r(135).appendChild(n),n.src="javascript:",t=n.contentWindow.document,t.open(),t.write("<script>document.F=Object<\/script>"),t.close(),a=t.F;e--;)delete a[f][o[e]];return a()};t.exports=Object.create||function(t,n){var r;return null!==t?(c[f]=e(t),r=new c,c[f]=null,r[u]=t):r=a(),void 0===n?r:i(r,n)}},function(t,n,r){var e=r(175),i=r(133).concat("length","prototype");n.f=Object.getOwnPropertyNames||function(t){return e(t,i)}},function(t,n,r){var e=r(175),i=r(133);t.exports=Object.keys||function(t){return e(t,i)}},function(t,n,r){var e=r(28);t.exports=function(t,n,r){for(var i in n)e(t,i,n[i],r);return t}},function(t,n,r){"use strict";var e=r(3),i=r(11),o=r(10),u=r(7)("species");t.exports=function(t){var n=e[t];o&&n&&!n[u]&&i.f(n,u,{configurable:!0,get:function(){return this}})}},function(t,n,r){var e=r(67),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n){var r=0,e=Math.random();t.exports=function(t){return"Symbol(".concat(void 0===t?"":t,")_",(++r+e).toString(36))}},function(t,n,r){var e=r(33);t.exports=function(t){return Object(e(t))}},function(t,n,r){var e=r(7)("unscopables"),i=Array.prototype;void 0==i[e]&&r(27)(i,e,{}),t.exports=function(t){i[e][t]=!0}},function(t,n,r){var e=r(53),i=r(169),o=r(137),u=r(2),c=r(16),f=r(154),a={},s={},n=t.exports=function(t,n,r,l,h){var v,p,d,y,g=h?function(){return t}:f(t),b=e(r,l,n?2:1),m=0;if("function"!=typeof g)throw TypeError(t+" is not iterable!");if(o(g)){for(v=c(t.length);v>m;m++)if((y=n?b(u(p=t[m])[0],p[1]):b(t[m]))===a||y===s)return y}else for(d=g.call(t);!(p=d.next()).done;)if((y=i(d,b,p.value,n))===a||y===s)return y};n.BREAK=a,n.RETURN=s},function(t,n){t.exports={}},function(t,n,r){var e=r(11).f,i=r(24),o=r(7)("toStringTag");t.exports=function(t,n,r){t&&!i(t=r?t:t.prototype,o)&&e(t,o,{configurable:!0,value:n})}},function(t,n,r){var e=r(1),i=r(46),o=r(4),u=r(150),c="["+u+"]",f="​",a=RegExp("^"+c+c+"*"),s=RegExp(c+c+"*$"),l=function(t,n,r){var i={},c=o(function(){return!!u[t]()||f[t]()!=f}),a=i[t]=c?n(h):u[t];r&&(i[r]=a),e(e.P+e.F*c,"String",i)},h=l.trim=function(t,n){return t=String(i(t)),1&n&&(t=t.replace(a,"")),2&n&&(t=t.replace(s,"")),t};t.exports=l},function(t,n,r){t.exports={default:r(86),__esModule:!0}},function(t,n,r){t.exports={default:r(87),__esModule:!0}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}n.__esModule=!0;var i=r(84),o=e(i),u=r(83),c=e(u),f="function"==typeof c.default&&"symbol"==typeof o.default?function(t){return typeof t}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":typeof t};n.default="function"==typeof c.default&&"symbol"===f(o.default)?function(t){return void 0===t?"undefined":f(t)}:function(t){return t&&"function"==typeof c.default&&t.constructor===c.default&&t!==c.default.prototype?"symbol":void 0===t?"undefined":f(t)}},function(t,n,r){r(110),r(108),r(111),r(112),t.exports=r(25).Symbol},function(t,n,r){r(109),r(113),t.exports=r(44).f("iterator")},function(t,n){t.exports=function(t){if("function"!=typeof t)throw TypeError(t+" is not a function!");return t}},function(t,n){t.exports=function(){}},function(t,n,r){var e=r(9),i=r(106),o=r(105);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){var e=r(88);t.exports=function(t,n,r){if(e(t),void 0===n)return t;switch(r){case 1:return function(r){return t.call(n,r)};case 2:return function(r,e){return t.call(n,r,e)};case 3:return function(r,e,i){return t.call(n,r,e,i)}}return function(){return t.apply(n,arguments)}}},function(t,n,r){var e=r(19),i=r(62),o=r(37);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){t.exports=r(5).document&&document.documentElement},function(t,n,r){var e=r(56);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n,r){var e=r(56);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(60),i=r(22),o=r(38),u={};r(13)(u,r(15)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n,r){var e=r(19),i=r(9);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){var e=r(23)("meta"),i=r(21),o=r(8),u=r(14).f,c=0,f=Object.isExtensible||function(){return!0},a=!r(18)(function(){return f(Object.preventExtensions({}))}),s=function(t){u(t,e,{value:{i:"O"+ ++c,w:{}}})},l=function(t,n){if(!i(t))return"symbol"==typeof t?t:("string"==typeof t?"S":"P")+t;if(!o(t,e)){if(!f(t))return"F";if(!n)return"E";s(t)}return t[e].i},h=function(t,n){if(!o(t,e)){if(!f(t))return!0;if(!n)return!1;s(t)}return t[e].w},v=function(t){return a&&p.NEED&&f(t)&&!o(t,e)&&s(t),t},p=t.exports={KEY:e,NEED:!1,fastKey:l,getWeak:h,onFreeze:v}},function(t,n,r){var e=r(14),i=r(20),o=r(19);t.exports=r(12)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(37),i=r(22),o=r(9),u=r(42),c=r(8),f=r(58),a=Object.getOwnPropertyDescriptor;n.f=r(12)?a:function(t,n){if(t=o(t),n=u(n,!0),f)try{return a(t,n)}catch(t){}if(c(t,n))return i(!e.f.call(t,n),t[n])}},function(t,n,r){var e=r(9),i=r(61).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(8),i=r(77),o=r(39)("IE_PROTO"),u=Object.prototype;t.exports=Object.getPrototypeOf||function(t){return t=i(t),e(t,o)?t[o]:"function"==typeof t.constructor&&t instanceof t.constructor?t.constructor.prototype:t instanceof Object?u:null}},function(t,n,r){var e=r(41),i=r(33);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(41),i=Math.max,o=Math.min;t.exports=function(t,n){return t=e(t),t<0?i(t+n,0):o(t,n)}},function(t,n,r){var e=r(41),i=Math.min;t.exports=function(t){return t>0?i(e(t),9007199254740991):0}},function(t,n,r){"use strict";var e=r(89),i=r(97),o=r(35),u=r(9);t.exports=r(59)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){},function(t,n,r){"use strict";var e=r(104)(!0);r(59)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";var e=r(5),i=r(8),o=r(12),u=r(51),c=r(64),f=r(99).KEY,a=r(18),s=r(40),l=r(38),h=r(23),v=r(15),p=r(44),d=r(43),y=r(98),g=r(92),b=r(95),m=r(20),x=r(9),w=r(42),S=r(22),_=r(60),O=r(102),E=r(101),P=r(14),j=r(19),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(61).f=O.f=Z,r(37).f=X,r(62).f=tt,o&&!r(36)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(13)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){r(43)("asyncIterator")},function(t,n,r){r(43)("observable")},function(t,n,r){r(107);for(var e=r(5),i=r(13),o=r(35),u=r(15)("toStringTag"),c=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],f=0;f<5;f++){var a=c[f],s=e[a],l=s&&s.prototype;l&&!l[u]&&i(l,u,a),o[a]=o.Array}},function(t,n,r){var e=r(45),i=r(7)("toStringTag"),o="Arguments"==e(function(){return arguments}()),u=function(t,n){try{return t[n]}catch(t){}};t.exports=function(t){var n,r,c;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(r=u(n=Object(t),i))?r:o?e(n):"Object"==(c=e(n))&&"function"==typeof n.callee?"Arguments":c}},function(t,n,r){var e=r(45);t.exports=Object("z").propertyIsEnumerable(0)?Object:function(t){return"String"==e(t)?t.split(""):Object(t)}},function(t,n){n.f={}.propertyIsEnumerable},function(t,n,r){var e=r(30),i=r(16),o=r(75);t.exports=function(t){return function(n,r,u){var c,f=e(n),a=i(f.length),s=o(u,a);if(t&&r!=r){for(;a>s;)if((c=f[s++])!=c)return!0}else for(;a>s;s++)if((t||s in f)&&f[s]===r)return t||s||0;return!t&&-1}}},function(t,n,r){"use strict";var e=r(3),i=r(1),o=r(28),u=r(73),c=r(65),f=r(79),a=r(68),s=r(6),l=r(4),h=r(123),v=r(81),p=r(136);t.exports=function(t,n,r,d,y,g){var b=e[t],m=b,x=y?"set":"add",w=m&&m.prototype,S={},_=function(t){var n=w[t];o(w,t,"delete"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"has"==t?function(t){return!(g&&!s(t))&&n.call(this,0===t?0:t)}:"get"==t?function(t){return g&&!s(t)?void 0:n.call(this,0===t?0:t)}:"add"==t?function(t){return n.call(this,0===t?0:t),this}:function(t,r){return n.call(this,0===t?0:t,r),this})};if("function"==typeof m&&(g||w.forEach&&!l(function(){(new m).entries().next()}))){var O=new m,E=O[x](g?{}:-0,1)!=O,P=l(function(){O.has(1)}),j=h(function(t){new m(t)}),F=!g&&l(function(){for(var t=new m,n=5;n--;)t[x](n,n);return!t.has(-0)});j||(m=n(function(n,r){a(n,m,t);var e=p(new b,n,m);return void 0!=r&&f(r,y,e[x],e),e}),m.prototype=w,w.constructor=m),(P||F)&&(_("delete"),_("has"),y&&_("get")),(F||E)&&_(x),g&&w.clear&&delete w.clear}else m=d.getConstructor(n,t,y,x),u(m.prototype,r),c.NEED=!0;return v(m,t),S[t]=m,i(i.G+i.W+i.F*(m!=b),S),g||d.setStrong(m,t,y),m}},function(t,n,r){"use strict";var e=r(27),i=r(28),o=r(4),u=r(46),c=r(7);t.exports=function(t,n,r){var f=c(t),a=r(u,f,""[t]),s=a[0],l=a[1];o(function(){var n={};return n[f]=function(){return 7},7!=""[t](n)})&&(i(String.prototype,t,s),e(RegExp.prototype,f,2==n?function(t,n){return l.call(t,this,n)}:function(t){return l.call(t,this)}))}
},function(t,n,r){"use strict";var e=r(2);t.exports=function(){var t=e(this),n="";return t.global&&(n+="g"),t.ignoreCase&&(n+="i"),t.multiline&&(n+="m"),t.unicode&&(n+="u"),t.sticky&&(n+="y"),n}},function(t,n){t.exports=function(t,n,r){var e=void 0===r;switch(n.length){case 0:return e?t():t.call(r);case 1:return e?t(n[0]):t.call(r,n[0]);case 2:return e?t(n[0],n[1]):t.call(r,n[0],n[1]);case 3:return e?t(n[0],n[1],n[2]):t.call(r,n[0],n[1],n[2]);case 4:return e?t(n[0],n[1],n[2],n[3]):t.call(r,n[0],n[1],n[2],n[3])}return t.apply(r,n)}},function(t,n,r){var e=r(6),i=r(45),o=r(7)("match");t.exports=function(t){var n;return e(t)&&(void 0!==(n=t[o])?!!n:"RegExp"==i(t))}},function(t,n,r){var e=r(7)("iterator"),i=!1;try{var o=[7][e]();o.return=function(){i=!0},Array.from(o,function(){throw 2})}catch(t){}t.exports=function(t,n){if(!n&&!i)return!1;var r=!1;try{var o=[7],u=o[e]();u.next=function(){return{done:r=!0}},o[e]=function(){return u},t(o)}catch(t){}return r}},function(t,n,r){t.exports=r(69)||!r(4)(function(){var t=Math.random();__defineSetter__.call(null,t,function(){}),delete r(3)[t]})},function(t,n){n.f=Object.getOwnPropertySymbols},function(t,n,r){var e=r(3),i="__core-js_shared__",o=e[i]||(e[i]={});t.exports=function(t){return o[t]||(o[t]={})}},function(t,n,r){for(var e,i=r(3),o=r(27),u=r(76),c=u("typed_array"),f=u("view"),a=!(!i.ArrayBuffer||!i.DataView),s=a,l=0,h="Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array".split(",");l<9;)(e=i[h[l++]])?(o(e.prototype,c,!0),o(e.prototype,f,!0)):s=!1;t.exports={ABV:a,CONSTR:s,TYPED:c,VIEW:f}},function(t,n){"use strict";var r={versions:function(){var t=window.navigator.userAgent;return{trident:t.indexOf("Trident")>-1,presto:t.indexOf("Presto")>-1,webKit:t.indexOf("AppleWebKit")>-1,gecko:t.indexOf("Gecko")>-1&&-1==t.indexOf("KHTML"),mobile:!!t.match(/AppleWebKit.*Mobile.*/),ios:!!t.match(/\(i[^;]+;( U;)? CPU.+Mac OS X/),android:t.indexOf("Android")>-1||t.indexOf("Linux")>-1,iPhone:t.indexOf("iPhone")>-1||t.indexOf("Mac")>-1,iPad:t.indexOf("iPad")>-1,webApp:-1==t.indexOf("Safari"),weixin:-1==t.indexOf("MicroMessenger")}}()};t.exports=r},function(t,n,r){"use strict";var e=r(85),i=function(t){return t&&t.__esModule?t:{default:t}}(e),o=function(){function t(t,n,e){return n||e?String.fromCharCode(n||e):r[t]||t}function n(t){return e[t]}var r={"&quot;":'"',"&lt;":"<","&gt;":">","&amp;":"&","&nbsp;":" "},e={};for(var u in r)e[r[u]]=u;return r["&apos;"]="'",e["'"]="&#39;",{encode:function(t){return t?(""+t).replace(/['<> "&]/g,n).replace(/\r?\n/g,"<br/>").replace(/\s/g,"&nbsp;"):""},decode:function(n){return n?(""+n).replace(/<br\s*\/?>/gi,"\n").replace(/&quot;|&lt;|&gt;|&amp;|&nbsp;|&apos;|&#(\d+);|&#(\d+)/g,t).replace(/\u00a0/g," "):""},encodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},encodeBase16forJSON:function(t){if(!t)return t;t=t.replace(/[\u4E00-\u9FBF]/gi,function(t){return escape(t).replace("%u","\\u")});for(var n=[],r=0,e=t.length;e>r;r++)n.push(t.charCodeAt(r).toString(16).toUpperCase());return n.join("")},decodeBase16:function(t){if(!t)return t;t+="";for(var n=[],r=0,e=t.length;e>r;r+=2)n.push(String.fromCharCode("0x"+t.slice(r,r+2)));return n.join("")},encodeObject:function(t){if(t instanceof Array)for(var n=0,r=t.length;r>n;n++)t[n]=o.encodeObject(t[n]);else if("object"==(void 0===t?"undefined":(0,i.default)(t)))for(var e in t)t[e]=o.encodeObject(t[e]);else if("string"==typeof t)return o.encode(t);return t},loadScript:function(t){var n=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(n),n.setAttribute("src",t)},addLoadEvent:function(t){var n=window.onload;"function"!=typeof window.onload?window.onload=t:window.onload=function(){n(),t()}}}}();t.exports=o},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=function(t){for(var n=e(this),r=o(n.length),u=arguments.length,c=i(u>1?arguments[1]:void 0,r),f=u>2?arguments[2]:void 0,a=void 0===f?r:i(f,r);a>c;)n[c++]=t;return n}},function(t,n,r){"use strict";var e=r(11),i=r(66);t.exports=function(t,n,r){n in t?e.f(t,n,i(0,r)):t[n]=r}},function(t,n,r){var e=r(6),i=r(3).document,o=e(i)&&e(i.createElement);t.exports=function(t){return o?i.createElement(t):{}}},function(t,n){t.exports="constructor,hasOwnProperty,isPrototypeOf,propertyIsEnumerable,toLocaleString,toString,valueOf".split(",")},function(t,n,r){var e=r(7)("match");t.exports=function(t){var n=/./;try{"/./"[t](n)}catch(r){try{return n[e]=!1,!"/./"[t](n)}catch(t){}}return!0}},function(t,n,r){t.exports=r(3).document&&document.documentElement},function(t,n,r){var e=r(6),i=r(144).set;t.exports=function(t,n,r){var o,u=n.constructor;return u!==r&&"function"==typeof u&&(o=u.prototype)!==r.prototype&&e(o)&&i&&i(t,o),t}},function(t,n,r){var e=r(80),i=r(7)("iterator"),o=Array.prototype;t.exports=function(t){return void 0!==t&&(e.Array===t||o[i]===t)}},function(t,n,r){var e=r(45);t.exports=Array.isArray||function(t){return"Array"==e(t)}},function(t,n,r){"use strict";var e=r(70),i=r(66),o=r(81),u={};r(27)(u,r(7)("iterator"),function(){return this}),t.exports=function(t,n,r){t.prototype=e(u,{next:i(1,r)}),o(t,n+" Iterator")}},function(t,n,r){"use strict";var e=r(69),i=r(1),o=r(28),u=r(27),c=r(24),f=r(80),a=r(139),s=r(81),l=r(32),h=r(7)("iterator"),v=!([].keys&&"next"in[].keys()),p="keys",d="values",y=function(){return this};t.exports=function(t,n,r,g,b,m,x){a(r,n,g);var w,S,_,O=function(t){if(!v&&t in F)return F[t];switch(t){case p:case d:return function(){return new r(this,t)}}return function(){return new r(this,t)}},E=n+" Iterator",P=b==d,j=!1,F=t.prototype,M=F[h]||F["@@iterator"]||b&&F[b],A=M||O(b),N=b?P?O("entries"):A:void 0,T="Array"==n?F.entries||M:M;if(T&&(_=l(T.call(new t)))!==Object.prototype&&(s(_,E,!0),e||c(_,h)||u(_,h,y)),P&&M&&M.name!==d&&(j=!0,A=function(){return M.call(this)}),e&&!x||!v&&!j&&F[h]||u(F,h,A),f[n]=A,f[E]=y,b)if(w={values:P?A:O(d),keys:m?A:O(p),entries:N},x)for(S in w)S in F||o(F,S,w[S]);else i(i.P+i.F*(v||j),n,w);return w}},function(t,n){var r=Math.expm1;t.exports=!r||r(10)>22025.465794806718||r(10)<22025.465794806718||-2e-17!=r(-2e-17)?function(t){return 0==(t=+t)?t:t>-1e-6&&t<1e-6?t+t*t/2:Math.exp(t)-1}:r},function(t,n){t.exports=Math.sign||function(t){return 0==(t=+t)||t!=t?t:t<0?-1:1}},function(t,n,r){var e=r(3),i=r(151).set,o=e.MutationObserver||e.WebKitMutationObserver,u=e.process,c=e.Promise,f="process"==r(45)(u);t.exports=function(){var t,n,r,a=function(){var e,i;for(f&&(e=u.domain)&&e.exit();t;){i=t.fn,t=t.next;try{i()}catch(e){throw t?r():n=void 0,e}}n=void 0,e&&e.enter()};if(f)r=function(){u.nextTick(a)};else if(o){var s=!0,l=document.createTextNode("");new o(a).observe(l,{characterData:!0}),r=function(){l.data=s=!s}}else if(c&&c.resolve){var h=c.resolve();r=function(){h.then(a)}}else r=function(){i.call(e,a)};return function(e){var i={fn:e,next:void 0};n&&(n.next=i),t||(t=i,r()),n=i}}},function(t,n,r){var e=r(6),i=r(2),o=function(t,n){if(i(t),!e(n)&&null!==n)throw TypeError(n+": can't set as prototype!")};t.exports={set:Object.setPrototypeOf||("__proto__"in{}?function(t,n,e){try{e=r(53)(Function.call,r(31).f(Object.prototype,"__proto__").set,2),e(t,[]),n=!(t instanceof Array)}catch(t){n=!0}return function(t,r){return o(t,r),n?t.__proto__=r:e(t,r),t}}({},!1):void 0),check:o}},function(t,n,r){var e=r(126)("keys"),i=r(76);t.exports=function(t){return e[t]||(e[t]=i(t))}},function(t,n,r){var e=r(2),i=r(26),o=r(7)("species");t.exports=function(t,n){var r,u=e(t).constructor;return void 0===u||void 0==(r=e(u)[o])?n:i(r)}},function(t,n,r){var e=r(67),i=r(46);t.exports=function(t){return function(n,r){var o,u,c=String(i(n)),f=e(r),a=c.length;return f<0||f>=a?t?"":void 0:(o=c.charCodeAt(f),o<55296||o>56319||f+1===a||(u=c.charCodeAt(f+1))<56320||u>57343?t?c.charAt(f):o:t?c.slice(f,f+2):u-56320+(o-55296<<10)+65536)}}},function(t,n,r){var e=r(122),i=r(46);t.exports=function(t,n,r){if(e(n))throw TypeError("String#"+r+" doesn't accept regex!");return String(i(t))}},function(t,n,r){"use strict";var e=r(67),i=r(46);t.exports=function(t){var n=String(i(this)),r="",o=e(t);if(o<0||o==1/0)throw RangeError("Count can't be negative");for(;o>0;(o>>>=1)&&(n+=n))1&o&&(r+=n);return r}},function(t,n){t.exports="\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"},function(t,n,r){var e,i,o,u=r(53),c=r(121),f=r(135),a=r(132),s=r(3),l=s.process,h=s.setImmediate,v=s.clearImmediate,p=s.MessageChannel,d=0,y={},g="onreadystatechange",b=function(){var t=+this;if(y.hasOwnProperty(t)){var n=y[t];delete y[t],n()}},m=function(t){b.call(t.data)};h&&v||(h=function(t){for(var n=[],r=1;arguments.length>r;)n.push(arguments[r++]);return y[++d]=function(){c("function"==typeof t?t:Function(t),n)},e(d),d},v=function(t){delete y[t]},"process"==r(45)(l)?e=function(t){l.nextTick(u(b,t,1))}:p?(i=new p,o=i.port2,i.port1.onmessage=m,e=u(o.postMessage,o,1)):s.addEventListener&&"function"==typeof postMessage&&!s.importScripts?(e=function(t){s.postMessage(t+"","*")},s.addEventListener("message",m,!1)):e=g in a("script")?function(t){f.appendChild(a("script"))[g]=function(){f.removeChild(this),b.call(t)}}:function(t){setTimeout(u(b,t,1),0)}),t.exports={set:h,clear:v}},function(t,n,r){"use strict";var e=r(3),i=r(10),o=r(69),u=r(127),c=r(27),f=r(73),a=r(4),s=r(68),l=r(67),h=r(16),v=r(71).f,p=r(11).f,d=r(130),y=r(81),g="ArrayBuffer",b="DataView",m="prototype",x="Wrong length!",w="Wrong index!",S=e[g],_=e[b],O=e.Math,E=e.RangeError,P=e.Infinity,j=S,F=O.abs,M=O.pow,A=O.floor,N=O.log,T=O.LN2,I="buffer",k="byteLength",L="byteOffset",R=i?"_b":I,C=i?"_l":k,D=i?"_o":L,U=function(t,n,r){var e,i,o,u=Array(r),c=8*r-n-1,f=(1<<c)-1,a=f>>1,s=23===n?M(2,-24)-M(2,-77):0,l=0,h=t<0||0===t&&1/t<0?1:0;for(t=F(t),t!=t||t===P?(i=t!=t?1:0,e=f):(e=A(N(t)/T),t*(o=M(2,-e))<1&&(e--,o*=2),t+=e+a>=1?s/o:s*M(2,1-a),t*o>=2&&(e++,o/=2),e+a>=f?(i=0,e=f):e+a>=1?(i=(t*o-1)*M(2,n),e+=a):(i=t*M(2,a-1)*M(2,n),e=0));n>=8;u[l++]=255&i,i/=256,n-=8);for(e=e<<n|i,c+=n;c>0;u[l++]=255&e,e/=256,c-=8);return u[--l]|=128*h,u},W=function(t,n,r){var e,i=8*r-n-1,o=(1<<i)-1,u=o>>1,c=i-7,f=r-1,a=t[f--],s=127&a;for(a>>=7;c>0;s=256*s+t[f],f--,c-=8);for(e=s&(1<<-c)-1,s>>=-c,c+=n;c>0;e=256*e+t[f],f--,c-=8);if(0===s)s=1-u;else{if(s===o)return e?NaN:a?-P:P;e+=M(2,n),s-=u}return(a?-1:1)*e*M(2,s-n)},G=function(t){return t[3]<<24|t[2]<<16|t[1]<<8|t[0]},B=function(t){return[255&t]},V=function(t){return[255&t,t>>8&255]},z=function(t){return[255&t,t>>8&255,t>>16&255,t>>24&255]},q=function(t){return U(t,52,8)},K=function(t){return U(t,23,4)},J=function(t,n,r){p(t[m],n,{get:function(){return this[r]}})},Y=function(t,n,r,e){var i=+r,o=l(i);if(i!=o||o<0||o+n>t[C])throw E(w);var u=t[R]._b,c=o+t[D],f=u.slice(c,c+n);return e?f:f.reverse()},H=function(t,n,r,e,i,o){var u=+r,c=l(u);if(u!=c||c<0||c+n>t[C])throw E(w);for(var f=t[R]._b,a=c+t[D],s=e(+i),h=0;h<n;h++)f[a+h]=s[o?h:n-h-1]},$=function(t,n){s(t,S,g);var r=+n,e=h(r);if(r!=e)throw E(x);return e};if(u.ABV){if(!a(function(){new S})||!a(function(){new S(.5)})){S=function(t){return new j($(this,t))};for(var X,Q=S[m]=j[m],Z=v(j),tt=0;Z.length>tt;)(X=Z[tt++])in S||c(S,X,j[X]);o||(Q.constructor=S)}var nt=new _(new S(2)),rt=_[m].setInt8;nt.setInt8(0,2147483648),nt.setInt8(1,2147483649),!nt.getInt8(0)&&nt.getInt8(1)||f(_[m],{setInt8:function(t,n){rt.call(this,t,n<<24>>24)},setUint8:function(t,n){rt.call(this,t,n<<24>>24)}},!0)}else S=function(t){var n=$(this,t);this._b=d.call(Array(n),0),this[C]=n},_=function(t,n,r){s(this,_,b),s(t,S,b);var e=t[C],i=l(n);if(i<0||i>e)throw E("Wrong offset!");if(r=void 0===r?e-i:h(r),i+r>e)throw E(x);this[R]=t,this[D]=i,this[C]=r},i&&(J(S,k,"_l"),J(_,I,"_b"),J(_,k,"_l"),J(_,L,"_o")),f(_[m],{getInt8:function(t){return Y(this,1,t)[0]<<24>>24},getUint8:function(t){return Y(this,1,t)[0]},getInt16:function(t){var n=Y(this,2,t,arguments[1]);return(n[1]<<8|n[0])<<16>>16},getUint16:function(t){var n=Y(this,2,t,arguments[1]);return n[1]<<8|n[0]},getInt32:function(t){return G(Y(this,4,t,arguments[1]))},getUint32:function(t){return G(Y(this,4,t,arguments[1]))>>>0},getFloat32:function(t){return W(Y(this,4,t,arguments[1]),23,4)},getFloat64:function(t){return W(Y(this,8,t,arguments[1]),52,8)},setInt8:function(t,n){H(this,1,t,B,n)},setUint8:function(t,n){H(this,1,t,B,n)},setInt16:function(t,n){H(this,2,t,V,n,arguments[2])},setUint16:function(t,n){H(this,2,t,V,n,arguments[2])},setInt32:function(t,n){H(this,4,t,z,n,arguments[2])},setUint32:function(t,n){H(this,4,t,z,n,arguments[2])},setFloat32:function(t,n){H(this,4,t,K,n,arguments[2])},setFloat64:function(t,n){H(this,8,t,q,n,arguments[2])}});y(S,g),y(_,b),c(_[m],u.VIEW,!0),n[g]=S,n[b]=_},function(t,n,r){var e=r(3),i=r(52),o=r(69),u=r(182),c=r(11).f;t.exports=function(t){var n=i.Symbol||(i.Symbol=o?{}:e.Symbol||{});"_"==t.charAt(0)||t in n||c(n,t,{value:u.f(t)})}},function(t,n,r){var e=r(114),i=r(7)("iterator"),o=r(80);t.exports=r(52).getIteratorMethod=function(t){if(void 0!=t)return t[i]||t["@@iterator"]||o[e(t)]}},function(t,n,r){"use strict";var e=r(78),i=r(170),o=r(80),u=r(30);t.exports=r(140)(Array,"Array",function(t,n){this._t=u(t),this._i=0,this._k=n},function(){var t=this._t,n=this._k,r=this._i++;return!t||r>=t.length?(this._t=void 0,i(1)):"keys"==n?i(0,r):"values"==n?i(0,t[r]):i(0,[r,t[r]])},"values"),o.Arguments=o.Array,e("keys"),e("values"),e("entries")},function(t,n){function r(t,n){t.classList?t.classList.add(n):t.className+=" "+n}t.exports=r},function(t,n){function r(t,n){if(t.classList)t.classList.remove(n);else{var r=new RegExp("(^|\\b)"+n.split(" ").join("|")+"(\\b|$)","gi");t.className=t.className.replace(r," ")}}t.exports=r},function(t,n){function r(){throw new Error("setTimeout has not been defined")}function e(){throw new Error("clearTimeout has not been defined")}function i(t){if(s===setTimeout)return setTimeout(t,0);if((s===r||!s)&&setTimeout)return s=setTimeout,setTimeout(t,0);try{return s(t,0)}catch(n){try{return s.call(null,t,0)}catch(n){return s.call(this,t,0)}}}function o(t){if(l===clearTimeout)return clearTimeout(t);if((l===e||!l)&&clearTimeout)return l=clearTimeout,clearTimeout(t);try{return l(t)}catch(n){try{return l.call(null,t)}catch(n){return l.call(this,t)}}}function u(){d&&v&&(d=!1,v.length?p=v.concat(p):y=-1,p.length&&c())}function c(){if(!d){var t=i(u);d=!0;for(var n=p.length;n;){for(v=p,p=[];++y<n;)v&&v[y].run();y=-1,n=p.length}v=null,d=!1,o(t)}}function f(t,n){this.fun=t,this.array=n}function a(){}var s,l,h=t.exports={};!function(){try{s="function"==typeof setTimeout?setTimeout:r}catch(t){s=r}try{l="function"==typeof clearTimeout?clearTimeout:e}catch(t){l=e}}();var v,p=[],d=!1,y=-1;h.nextTick=function(t){var n=new Array(arguments.length-1);if(arguments.length>1)for(var r=1;r<arguments.length;r++)n[r-1]=arguments[r];p.push(new f(t,n)),1!==p.length||d||i(c)},f.prototype.run=function(){this.fun.apply(null,this.array)},h.title="browser",h.browser=!0,h.env={},h.argv=[],h.version="",h.versions={},h.on=a,h.addListener=a,h.once=a,h.off=a,h.removeListener=a,h.removeAllListeners=a,h.emit=a,h.prependListener=a,h.prependOnceListener=a,h.listeners=function(t){return[]},h.binding=function(t){throw new Error("process.binding is not supported")},h.cwd=function(){return"/"},h.chdir=function(t){throw new Error("process.chdir is not supported")},h.umask=function(){return 0}},function(t,n,r){var e=r(45);t.exports=function(t,n){if("number"!=typeof t&&"Number"!=e(t))throw TypeError(n);return+t}},function(t,n,r){"use strict";var e=r(17),i=r(75),o=r(16);t.exports=[].copyWithin||function(t,n){var r=e(this),u=o(r.length),c=i(t,u),f=i(n,u),a=arguments.length>2?arguments[2]:void 0,s=Math.min((void 0===a?u:i(a,u))-f,u-c),l=1;for(f<c&&c<f+s&&(l=-1,f+=s-1,c+=s-1);s-- >0;)f in r?r[c]=r[f]:delete r[c],c+=l,f+=l;return r}},function(t,n,r){var e=r(79);t.exports=function(t,n){var r=[];return e(t,!1,r.push,r,n),r}},function(t,n,r){var e=r(26),i=r(17),o=r(115),u=r(16);t.exports=function(t,n,r,c,f){e(n);var a=i(t),s=o(a),l=u(a.length),h=f?l-1:0,v=f?-1:1;if(r<2)for(;;){if(h in s){c=s[h],h+=v;break}if(h+=v,f?h<0:l<=h)throw TypeError("Reduce of empty array with no initial value")}for(;f?h>=0:l>h;h+=v)h in s&&(c=n(c,s[h],h,a));return c}},function(t,n,r){"use strict";var e=r(26),i=r(6),o=r(121),u=[].slice,c={},f=function(t,n,r){if(!(n in c)){for(var e=[],i=0;i<n;i++)e[i]="a["+i+"]";c[n]=Function("F,a","return new F("+e.join(",")+")")}return c[n](t,r)};t.exports=Function.bind||function(t){var n=e(this),r=u.call(arguments,1),c=function(){var e=r.concat(u.call(arguments));return this instanceof c?f(n,e.length,e):o(n,e,t)};return i(n.prototype)&&(c.prototype=n.prototype),c}},function(t,n,r){"use strict";var e=r(11).f,i=r(70),o=r(73),u=r(53),c=r(68),f=r(46),a=r(79),s=r(140),l=r(170),h=r(74),v=r(10),p=r(65).fastKey,d=v?"_s":"size",y=function(t,n){var r,e=p(n);if("F"!==e)return t._i[e];for(r=t._f;r;r=r.n)if(r.k==n)return r};t.exports={getConstructor:function(t,n,r,s){var l=t(function(t,e){c(t,l,n,"_i"),t._i=i(null),t._f=void 0,t._l=void 0,t[d]=0,void 0!=e&&a(e,r,t[s],t)});return o(l.prototype,{clear:function(){for(var t=this,n=t._i,r=t._f;r;r=r.n)r.r=!0,r.p&&(r.p=r.p.n=void 0),delete n[r.i];t._f=t._l=void 0,t[d]=0},delete:function(t){var n=this,r=y(n,t);if(r){var e=r.n,i=r.p;delete n._i[r.i],r.r=!0,i&&(i.n=e),e&&(e.p=i),n._f==r&&(n._f=e),n._l==r&&(n._l=i),n[d]--}return!!r},forEach:function(t){c(this,l,"forEach");for(var n,r=u(t,arguments.length>1?arguments[1]:void 0,3);n=n?n.n:this._f;)for(r(n.v,n.k,this);n&&n.r;)n=n.p},has:function(t){return!!y(this,t)}}),v&&e(l.prototype,"size",{get:function(){return f(this[d])}}),l},def:function(t,n,r){var e,i,o=y(t,n);return o?o.v=r:(t._l=o={i:i=p(n,!0),k:n,v:r,p:e=t._l,n:void 0,r:!1},t._f||(t._f=o),e&&(e.n=o),t[d]++,"F"!==i&&(t._i[i]=o)),t},getEntry:y,setStrong:function(t,n,r){s(t,n,function(t,n){this._t=t,this._k=n,this._l=void 0},function(){for(var t=this,n=t._k,r=t._l;r&&r.r;)r=r.p;return t._t&&(t._l=r=r?r.n:t._t._f)?"keys"==n?l(0,r.k):"values"==n?l(0,r.v):l(0,[r.k,r.v]):(t._t=void 0,l(1))},r?"entries":"values",!r,!0),h(n)}}},function(t,n,r){var e=r(114),i=r(161);t.exports=function(t){return function(){if(e(this)!=t)throw TypeError(t+"#toJSON isn't generic");return i(this)}}},function(t,n,r){"use strict";var e=r(73),i=r(65).getWeak,o=r(2),u=r(6),c=r(68),f=r(79),a=r(48),s=r(24),l=a(5),h=a(6),v=0,p=function(t){return t._l||(t._l=new d)},d=function(){this.a=[]},y=function(t,n){return l(t.a,function(t){return t[0]===n})};d.prototype={get:function(t){var n=y(this,t);if(n)return n[1]},has:function(t){return!!y(this,t)},set:function(t,n){var r=y(this,t);r?r[1]=n:this.a.push([t,n])},delete:function(t){var n=h(this.a,function(n){return n[0]===t});return~n&&this.a.splice(n,1),!!~n}},t.exports={getConstructor:function(t,n,r,o){var a=t(function(t,e){c(t,a,n,"_i"),t._i=v++,t._l=void 0,void 0!=e&&f(e,r,t[o],t)});return e(a.prototype,{delete:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).delete(t):n&&s(n,this._i)&&delete n[this._i]},has:function(t){if(!u(t))return!1;var n=i(t);return!0===n?p(this).has(t):n&&s(n,this._i)}}),a},def:function(t,n,r){var e=i(o(n),!0);return!0===e?p(t).set(n,r):e[t._i]=r,t},ufstore:p}},function(t,n,r){t.exports=!r(10)&&!r(4)(function(){return 7!=Object.defineProperty(r(132)("div"),"a",{get:function(){return 7}}).a})},function(t,n,r){var e=r(6),i=Math.floor;t.exports=function(t){return!e(t)&&isFinite(t)&&i(t)===t}},function(t,n,r){var e=r(2);t.exports=function(t,n,r,i){try{return i?n(e(r)[0],r[1]):n(r)}catch(n){var o=t.return;throw void 0!==o&&e(o.call(t)),n}}},function(t,n){t.exports=function(t,n){return{value:n,done:!!t}}},function(t,n){t.exports=Math.log1p||function(t){return(t=+t)>-1e-8&&t<1e-8?t-t*t/2:Math.log(1+t)}},function(t,n,r){"use strict";var e=r(72),i=r(125),o=r(116),u=r(17),c=r(115),f=Object.assign;t.exports=!f||r(4)(function(){var t={},n={},r=Symbol(),e="abcdefghijklmnopqrst";return t[r]=7,e.split("").forEach(function(t){n[t]=t}),7!=f({},t)[r]||Object.keys(f({},n)).join("")!=e})?function(t,n){for(var r=u(t),f=arguments.length,a=1,s=i.f,l=o.f;f>a;)for(var h,v=c(arguments[a++]),p=s?e(v).concat(s(v)):e(v),d=p.length,y=0;d>y;)l.call(v,h=p[y++])&&(r[h]=v[h]);return r}:f},function(t,n,r){var e=r(11),i=r(2),o=r(72);t.exports=r(10)?Object.defineProperties:function(t,n){i(t);for(var r,u=o(n),c=u.length,f=0;c>f;)e.f(t,r=u[f++],n[r]);return t}},function(t,n,r){var e=r(30),i=r(71).f,o={}.toString,u="object"==typeof window&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[],c=function(t){try{return i(t)}catch(t){return u.slice()}};t.exports.f=function(t){return u&&"[object Window]"==o.call(t)?c(t):i(e(t))}},function(t,n,r){var e=r(24),i=r(30),o=r(117)(!1),u=r(145)("IE_PROTO");t.exports=function(t,n){var r,c=i(t),f=0,a=[];for(r in c)r!=u&&e(c,r)&&a.push(r);for(;n.length>f;)e(c,r=n[f++])&&(~o(a,r)||a.push(r));return a}},function(t,n,r){var e=r(72),i=r(30),o=r(116).f;t.exports=function(t){return function(n){for(var r,u=i(n),c=e(u),f=c.length,a=0,s=[];f>a;)o.call(u,r=c[a++])&&s.push(t?[r,u[r]]:u[r]);return s}}},function(t,n,r){var e=r(71),i=r(125),o=r(2),u=r(3).Reflect;t.exports=u&&u.ownKeys||function(t){var n=e.f(o(t)),r=i.f;return r?n.concat(r(t)):n}},function(t,n,r){var e=r(3).parseFloat,i=r(82).trim;t.exports=1/e(r(150)+"-0")!=-1/0?function(t){var n=i(String(t),3),r=e(n);return 0===r&&"-"==n.charAt(0)?-0:r}:e},function(t,n,r){var e=r(3).parseInt,i=r(82).trim,o=r(150),u=/^[\-+]?0[xX]/;t.exports=8!==e(o+"08")||22!==e(o+"0x16")?function(t,n){var r=i(String(t),3);return e(r,n>>>0||(u.test(r)?16:10))}:e},function(t,n){t.exports=Object.is||function(t,n){return t===n?0!==t||1/t==1/n:t!=t&&n!=n}},function(t,n,r){var e=r(16),i=r(149),o=r(46);t.exports=function(t,n,r,u){var c=String(o(t)),f=c.length,a=void 0===r?" ":String(r),s=e(n);if(s<=f||""==a)return c;var l=s-f,h=i.call(a,Math.ceil(l/a.length));return h.length>l&&(h=h.slice(0,l)),u?h+c:c+h}},function(t,n,r){n.f=r(7)},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Map",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{get:function(t){var n=e.getEntry(this,t);return n&&n.v},set:function(t,n){return e.def(this,0===t?0:t,n)}},e,!0)},function(t,n,r){r(10)&&"g"!=/./g.flags&&r(11).f(RegExp.prototype,"flags",{configurable:!0,get:r(120)})},function(t,n,r){"use strict";var e=r(164);t.exports=r(118)("Set",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t=0===t?0:t,t)}},e)},function(t,n,r){"use strict";var e,i=r(48)(0),o=r(28),u=r(65),c=r(172),f=r(166),a=r(6),s=u.getWeak,l=Object.isExtensible,h=f.ufstore,v={},p=function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},d={get:function(t){if(a(t)){var n=s(t);return!0===n?h(this).get(t):n?n[this._i]:void 0}},set:function(t,n){return f.def(this,t,n)}},y=t.exports=r(118)("WeakMap",p,d,f,!0,!0);7!=(new y).set((Object.freeze||Object)(v),7).get(v)&&(e=f.getConstructor(p),c(e.prototype,d),u.NEED=!0,i(["delete","has","get","set"],function(t){var n=y.prototype,r=n[t];o(n,t,function(n,i){if(a(n)&&!l(n)){this._f||(this._f=new e);var o=this._f[t](n,i);return"set"==t?this:o}return r.call(this,n,i)})}))},,,,function(t,n){"use strict";function r(){var t=document.querySelector("#page-nav");if(t&&!document.querySelector("#page-nav .extend.prev")&&(t.innerHTML='<a class="extend prev disabled" rel="prev">&laquo; Prev</a>'+t.innerHTML),t&&!document.querySelector("#page-nav .extend.next")&&(t.innerHTML=t.innerHTML+'<a class="extend next disabled" rel="next">Next &raquo;</a>'),yiliaConfig&&yiliaConfig.open_in_new){document.querySelectorAll(".article-entry a:not(.article-more-a)").forEach(function(t){var n=t.getAttribute("target");n&&""!==n||t.setAttribute("target","_blank")})}if(yiliaConfig&&yiliaConfig.toc_hide_index){document.querySelectorAll(".toc-number").forEach(function(t){t.style.display="none"})}var n=document.querySelector("#js-aboutme");n&&0!==n.length&&(n.innerHTML=n.innerText)}t.exports={init:r}},function(t,n,r){"use strict";function e(t){return t&&t.__esModule?t:{default:t}}function i(t,n){var r=/\/|index.html/g;return t.replace(r,"")===n.replace(r,"")}function o(){for(var t=document.querySelectorAll(".js-header-menu li a"),n=window.location.pathname,r=0,e=t.length;r<e;r++){var o=t[r];i(n,o.getAttribute("href"))&&(0,h.default)(o,"active")}}function u(t){for(var n=t.offsetLeft,r=t.offsetParent;null!==r;)n+=r.offsetLeft,r=r.offsetParent;return n}function c(t){for(var n=t.offsetTop,r=t.offsetParent;null!==r;)n+=r.offsetTop,r=r.offsetParent;return n}function f(t,n,r,e,i){var o=u(t),f=c(t)-n;if(f-r<=i){var a=t.$newDom;a||(a=t.cloneNode(!0),(0,d.default)(t,a),t.$newDom=a,a.style.position="fixed",a.style.top=(r||f)+"px",a.style.left=o+"px",a.style.zIndex=e||2,a.style.width="100%",a.style.color="#fff"),a.style.visibility="visible",t.style.visibility="hidden"}else{t.style.visibility="visible";var s=t.$newDom;s&&(s.style.visibility="hidden")}}function a(){var t=document.querySelector(".js-overlay"),n=document.querySelector(".js-header-menu");f(t,document.body.scrollTop,-63,2,0),f(n,document.body.scrollTop,1,3,0)}function s(){document.querySelector("#container").addEventListener("scroll",function(t){a()}),window.addEventListener("scroll",function(t){a()}),a()}var l=r(156),h=e(l),v=r(157),p=(e(v),r(382)),d=e(p),y=r(128),g=e(y),b=r(190),m=e(b),x=r(129);(function(){g.default.versions.mobile&&window.screen.width<800&&(o(),s())})(),(0,x.addLoadEvent)(function(){m.default.init()}),t.exports={}},,,,function(t,n,r){(function(t){"use strict";function n(t,n,r){t[n]||Object[e](t,n,{writable:!0,configurable:!0,value:r})}if(r(381),r(391),r(198),t._babelPolyfill)throw new Error("only one instance of babel-polyfill is allowed");t._babelPolyfill=!0;var e="defineProperty";n(String.prototype,"padLeft","".padStart),n(String.prototype,"padRight","".padEnd),"pop,reverse,shift,keys,values,entries,indexOf,every,some,forEach,map,filter,find,findIndex,includes,join,slice,concat,push,splice,unshift,sort,lastIndexOf,reduce,reduceRight,copyWithin,fill".split(",").forEach(function(t){[][t]&&n(Array,t,Function.call.bind([][t]))})}).call(n,function(){return this}())},,,function(t,n,r){r(210),t.exports=r(52).RegExp.escape},,,,function(t,n,r){var e=r(6),i=r(138),o=r(7)("species");t.exports=function(t){var n;return i(t)&&(n=t.constructor,"function"!=typeof n||n!==Array&&!i(n.prototype)||(n=void 0),e(n)&&null===(n=n[o])&&(n=void 0)),void 0===n?Array:n}},function(t,n,r){var e=r(202);t.exports=function(t,n){return new(e(t))(n)}},function(t,n,r){"use strict";var e=r(2),i=r(50),o="number";t.exports=function(t){if("string"!==t&&t!==o&&"default"!==t)throw TypeError("Incorrect hint");return i(e(this),t!=o)}},function(t,n,r){var e=r(72),i=r(125),o=r(116);t.exports=function(t){var n=e(t),r=i.f;if(r)for(var u,c=r(t),f=o.f,a=0;c.length>a;)f.call(t,u=c[a++])&&n.push(u);return n}},function(t,n,r){var e=r(72),i=r(30);t.exports=function(t,n){for(var r,o=i(t),u=e(o),c=u.length,f=0;c>f;)if(o[r=u[f++]]===n)return r}},function(t,n,r){"use strict";var e=r(208),i=r(121),o=r(26);t.exports=function(){for(var t=o(this),n=arguments.length,r=Array(n),u=0,c=e._,f=!1;n>u;)(r[u]=arguments[u++])===c&&(f=!0);return function(){var e,o=this,u=arguments.length,a=0,s=0;if(!f&&!u)return i(t,r,o);if(e=r.slice(),f)for(;n>a;a++)e[a]===c&&(e[a]=arguments[s++]);for(;u>s;)e.push(arguments[s++]);return i(t,e,o)}}},function(t,n,r){t.exports=r(3)},function(t,n){t.exports=function(t,n){var r=n===Object(n)?function(t){return n[t]}:n;return function(n){return String(n).replace(t,r)}}},function(t,n,r){var e=r(1),i=r(209)(/[\\^$*+?.()|[\]{}]/g,"\\$&");e(e.S,"RegExp",{escape:function(t){return i(t)}})},function(t,n,r){var e=r(1);e(e.P,"Array",{copyWithin:r(160)}),r(78)("copyWithin")},function(t,n,r){"use strict";var e=r(1),i=r(48)(4);e(e.P+e.F*!r(47)([].every,!0),"Array",{every:function(t){return i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.P,"Array",{fill:r(130)}),r(78)("fill")},function(t,n,r){"use strict";var e=r(1),i=r(48)(2);e(e.P+e.F*!r(47)([].filter,!0),"Array",{filter:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(6),o="findIndex",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{findIndex:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(5),o="find",u=!0;o in[]&&Array(1)[o](function(){u=!1}),e(e.P+e.F*u,"Array",{find:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)(o)},function(t,n,r){"use strict";var e=r(1),i=r(48)(0),o=r(47)([].forEach,!0);e(e.P+e.F*!o,"Array",{forEach:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(53),i=r(1),o=r(17),u=r(169),c=r(137),f=r(16),a=r(131),s=r(154);i(i.S+i.F*!r(123)(function(t){Array.from(t)}),"Array",{from:function(t){var n,r,i,l,h=o(t),v="function"==typeof this?this:Array,p=arguments.length,d=p>1?arguments[1]:void 0,y=void 0!==d,g=0,b=s(h);if(y&&(d=e(d,p>2?arguments[2]:void 0,2)),void 0==b||v==Array&&c(b))for(n=f(h.length),r=new v(n);n>g;g++)a(r,g,y?d(h[g],g):h[g]);else for(l=b.call(h),r=new v;!(i=l.next()).done;g++)a(r,g,y?u(l,d,[i.value,g],!0):i.value);return r.length=g,r}})},function(t,n,r){"use strict";var e=r(1),i=r(117)(!1),o=[].indexOf,u=!!o&&1/[1].indexOf(1,-0)<0;e(e.P+e.F*(u||!r(47)(o)),"Array",{indexOf:function(t){return u?o.apply(this,arguments)||0:i(this,t,arguments[1])}})},function(t,n,r){var e=r(1);e(e.S,"Array",{isArray:r(138)})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=[].join;e(e.P+e.F*(r(115)!=Object||!r(47)(o)),"Array",{join:function(t){return o.call(i(this),void 0===t?",":t)}})},function(t,n,r){"use strict";var e=r(1),i=r(30),o=r(67),u=r(16),c=[].lastIndexOf,f=!!c&&1/[1].lastIndexOf(1,-0)<0;e(e.P+e.F*(f||!r(47)(c)),"Array",{lastIndexOf:function(t){if(f)return c.apply(this,arguments)||0;var n=i(this),r=u(n.length),e=r-1;for(arguments.length>1&&(e=Math.min(e,o(arguments[1]))),e<0&&(e=r+e);e>=0;e--)if(e in n&&n[e]===t)return e||0;return-1}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(1);e(e.P+e.F*!r(47)([].map,!0),"Array",{map:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(131);e(e.S+e.F*r(4)(function(){function t(){}return!(Array.of.call(t)instanceof t)}),"Array",{of:function(){for(var t=0,n=arguments.length,r=new("function"==typeof this?this:Array)(n);n>t;)i(r,t,arguments[t++]);return r.length=n,r}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduceRight,!0),"Array",{reduceRight:function(t){return i(this,t,arguments.length,arguments[1],!0)}})},function(t,n,r){"use strict";var e=r(1),i=r(162);e(e.P+e.F*!r(47)([].reduce,!0),"Array",{reduce:function(t){return i(this,t,arguments.length,arguments[1],!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(135),o=r(45),u=r(75),c=r(16),f=[].slice;e(e.P+e.F*r(4)(function(){i&&f.call(i)}),"Array",{slice:function(t,n){var r=c(this.length),e=o(this);if(n=void 0===n?r:n,"Array"==e)return f.call(this,t,n);for(var i=u(t,r),a=u(n,r),s=c(a-i),l=Array(s),h=0;h<s;h++)l[h]="String"==e?this.charAt(i+h):this[i+h];return l}})},function(t,n,r){"use strict";var e=r(1),i=r(48)(3);e(e.P+e.F*!r(47)([].some,!0),"Array",{some:function(t){return i(this,t,arguments[1])}})},function(t,n,r){"use strict";var e=r(1),i=r(26),o=r(17),u=r(4),c=[].sort,f=[1,2,3];e(e.P+e.F*(u(function(){f.sort(void 0)})||!u(function(){f.sort(null)})||!r(47)(c)),"Array",{sort:function(t){return void 0===t?c.call(o(this)):c.call(o(this),i(t))}})},function(t,n,r){r(74)("Array")},function(t,n,r){var e=r(1);e(e.S,"Date",{now:function(){return(new Date).getTime()}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=Date.prototype.getTime,u=function(t){return t>9?t:"0"+t};e(e.P+e.F*(i(function(){return"0385-07-25T07:06:39.999Z"!=new Date(-5e13-1).toISOString()})||!i(function(){new Date(NaN).toISOString()})),"Date",{toISOString:function(){
if(!isFinite(o.call(this)))throw RangeError("Invalid time value");var t=this,n=t.getUTCFullYear(),r=t.getUTCMilliseconds(),e=n<0?"-":n>9999?"+":"";return e+("00000"+Math.abs(n)).slice(e?-6:-4)+"-"+u(t.getUTCMonth()+1)+"-"+u(t.getUTCDate())+"T"+u(t.getUTCHours())+":"+u(t.getUTCMinutes())+":"+u(t.getUTCSeconds())+"."+(r>99?r:"0"+u(r))+"Z"}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50);e(e.P+e.F*r(4)(function(){return null!==new Date(NaN).toJSON()||1!==Date.prototype.toJSON.call({toISOString:function(){return 1}})}),"Date",{toJSON:function(t){var n=i(this),r=o(n);return"number"!=typeof r||isFinite(r)?n.toISOString():null}})},function(t,n,r){var e=r(7)("toPrimitive"),i=Date.prototype;e in i||r(27)(i,e,r(204))},function(t,n,r){var e=Date.prototype,i="Invalid Date",o="toString",u=e[o],c=e.getTime;new Date(NaN)+""!=i&&r(28)(e,o,function(){var t=c.call(this);return t===t?u.call(this):i})},function(t,n,r){var e=r(1);e(e.P,"Function",{bind:r(163)})},function(t,n,r){"use strict";var e=r(6),i=r(32),o=r(7)("hasInstance"),u=Function.prototype;o in u||r(11).f(u,o,{value:function(t){if("function"!=typeof this||!e(t))return!1;if(!e(this.prototype))return t instanceof this;for(;t=i(t);)if(this.prototype===t)return!0;return!1}})},function(t,n,r){var e=r(11).f,i=r(66),o=r(24),u=Function.prototype,c="name",f=Object.isExtensible||function(){return!0};c in u||r(10)&&e(u,c,{configurable:!0,get:function(){try{var t=this,n=(""+t).match(/^\s*function ([^ (]*)/)[1];return o(t,c)||!f(t)||e(t,c,i(5,n)),n}catch(t){return""}}})},function(t,n,r){var e=r(1),i=r(171),o=Math.sqrt,u=Math.acosh;e(e.S+e.F*!(u&&710==Math.floor(u(Number.MAX_VALUE))&&u(1/0)==1/0),"Math",{acosh:function(t){return(t=+t)<1?NaN:t>94906265.62425156?Math.log(t)+Math.LN2:i(t-1+o(t-1)*o(t+1))}})},function(t,n,r){function e(t){return isFinite(t=+t)&&0!=t?t<0?-e(-t):Math.log(t+Math.sqrt(t*t+1)):t}var i=r(1),o=Math.asinh;i(i.S+i.F*!(o&&1/o(0)>0),"Math",{asinh:e})},function(t,n,r){var e=r(1),i=Math.atanh;e(e.S+e.F*!(i&&1/i(-0)<0),"Math",{atanh:function(t){return 0==(t=+t)?t:Math.log((1+t)/(1-t))/2}})},function(t,n,r){var e=r(1),i=r(142);e(e.S,"Math",{cbrt:function(t){return i(t=+t)*Math.pow(Math.abs(t),1/3)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{clz32:function(t){return(t>>>=0)?31-Math.floor(Math.log(t+.5)*Math.LOG2E):32}})},function(t,n,r){var e=r(1),i=Math.exp;e(e.S,"Math",{cosh:function(t){return(i(t=+t)+i(-t))/2}})},function(t,n,r){var e=r(1),i=r(141);e(e.S+e.F*(i!=Math.expm1),"Math",{expm1:i})},function(t,n,r){var e=r(1),i=r(142),o=Math.pow,u=o(2,-52),c=o(2,-23),f=o(2,127)*(2-c),a=o(2,-126),s=function(t){return t+1/u-1/u};e(e.S,"Math",{fround:function(t){var n,r,e=Math.abs(t),o=i(t);return e<a?o*s(e/a/c)*a*c:(n=(1+c/u)*e,r=n-(n-e),r>f||r!=r?o*(1/0):o*r)}})},function(t,n,r){var e=r(1),i=Math.abs;e(e.S,"Math",{hypot:function(t,n){for(var r,e,o=0,u=0,c=arguments.length,f=0;u<c;)r=i(arguments[u++]),f<r?(e=f/r,o=o*e*e+1,f=r):r>0?(e=r/f,o+=e*e):o+=r;return f===1/0?1/0:f*Math.sqrt(o)}})},function(t,n,r){var e=r(1),i=Math.imul;e(e.S+e.F*r(4)(function(){return-5!=i(4294967295,5)||2!=i.length}),"Math",{imul:function(t,n){var r=65535,e=+t,i=+n,o=r&e,u=r&i;return 0|o*u+((r&e>>>16)*u+o*(r&i>>>16)<<16>>>0)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log10:function(t){return Math.log(t)/Math.LN10}})},function(t,n,r){var e=r(1);e(e.S,"Math",{log1p:r(171)})},function(t,n,r){var e=r(1);e(e.S,"Math",{log2:function(t){return Math.log(t)/Math.LN2}})},function(t,n,r){var e=r(1);e(e.S,"Math",{sign:r(142)})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S+e.F*r(4)(function(){return-2e-17!=!Math.sinh(-2e-17)}),"Math",{sinh:function(t){return Math.abs(t=+t)<1?(i(t)-i(-t))/2:(o(t-1)-o(-t-1))*(Math.E/2)}})},function(t,n,r){var e=r(1),i=r(141),o=Math.exp;e(e.S,"Math",{tanh:function(t){var n=i(t=+t),r=i(-t);return n==1/0?1:r==1/0?-1:(n-r)/(o(t)+o(-t))}})},function(t,n,r){var e=r(1);e(e.S,"Math",{trunc:function(t){return(t>0?Math.floor:Math.ceil)(t)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(45),u=r(136),c=r(50),f=r(4),a=r(71).f,s=r(31).f,l=r(11).f,h=r(82).trim,v="Number",p=e[v],d=p,y=p.prototype,g=o(r(70)(y))==v,b="trim"in String.prototype,m=function(t){var n=c(t,!1);if("string"==typeof n&&n.length>2){n=b?n.trim():h(n,3);var r,e,i,o=n.charCodeAt(0);if(43===o||45===o){if(88===(r=n.charCodeAt(2))||120===r)return NaN}else if(48===o){switch(n.charCodeAt(1)){case 66:case 98:e=2,i=49;break;case 79:case 111:e=8,i=55;break;default:return+n}for(var u,f=n.slice(2),a=0,s=f.length;a<s;a++)if((u=f.charCodeAt(a))<48||u>i)return NaN;return parseInt(f,e)}}return+n};if(!p(" 0o1")||!p("0b1")||p("+0x1")){p=function(t){var n=arguments.length<1?0:t,r=this;return r instanceof p&&(g?f(function(){y.valueOf.call(r)}):o(r)!=v)?u(new d(m(n)),r,p):m(n)};for(var x,w=r(10)?a(d):"MAX_VALUE,MIN_VALUE,NaN,NEGATIVE_INFINITY,POSITIVE_INFINITY,EPSILON,isFinite,isInteger,isNaN,isSafeInteger,MAX_SAFE_INTEGER,MIN_SAFE_INTEGER,parseFloat,parseInt,isInteger".split(","),S=0;w.length>S;S++)i(d,x=w[S])&&!i(p,x)&&l(p,x,s(d,x));p.prototype=y,y.constructor=p,r(28)(e,v,p)}},function(t,n,r){var e=r(1);e(e.S,"Number",{EPSILON:Math.pow(2,-52)})},function(t,n,r){var e=r(1),i=r(3).isFinite;e(e.S,"Number",{isFinite:function(t){return"number"==typeof t&&i(t)}})},function(t,n,r){var e=r(1);e(e.S,"Number",{isInteger:r(168)})},function(t,n,r){var e=r(1);e(e.S,"Number",{isNaN:function(t){return t!=t}})},function(t,n,r){var e=r(1),i=r(168),o=Math.abs;e(e.S,"Number",{isSafeInteger:function(t){return i(t)&&o(t)<=9007199254740991}})},function(t,n,r){var e=r(1);e(e.S,"Number",{MAX_SAFE_INTEGER:9007199254740991})},function(t,n,r){var e=r(1);e(e.S,"Number",{MIN_SAFE_INTEGER:-9007199254740991})},function(t,n,r){var e=r(1),i=r(178);e(e.S+e.F*(Number.parseFloat!=i),"Number",{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.S+e.F*(Number.parseInt!=i),"Number",{parseInt:i})},function(t,n,r){"use strict";var e=r(1),i=r(67),o=r(159),u=r(149),c=1..toFixed,f=Math.floor,a=[0,0,0,0,0,0],s="Number.toFixed: incorrect invocation!",l="0",h=function(t,n){for(var r=-1,e=n;++r<6;)e+=t*a[r],a[r]=e%1e7,e=f(e/1e7)},v=function(t){for(var n=6,r=0;--n>=0;)r+=a[n],a[n]=f(r/t),r=r%t*1e7},p=function(){for(var t=6,n="";--t>=0;)if(""!==n||0===t||0!==a[t]){var r=String(a[t]);n=""===n?r:n+u.call(l,7-r.length)+r}return n},d=function(t,n,r){return 0===n?r:n%2==1?d(t,n-1,r*t):d(t*t,n/2,r)},y=function(t){for(var n=0,r=t;r>=4096;)n+=12,r/=4096;for(;r>=2;)n+=1,r/=2;return n};e(e.P+e.F*(!!c&&("0.000"!==8e-5.toFixed(3)||"1"!==.9.toFixed(0)||"1.25"!==1.255.toFixed(2)||"1000000000000000128"!==(0xde0b6b3a7640080).toFixed(0))||!r(4)(function(){c.call({})})),"Number",{toFixed:function(t){var n,r,e,c,f=o(this,s),a=i(t),g="",b=l;if(a<0||a>20)throw RangeError(s);if(f!=f)return"NaN";if(f<=-1e21||f>=1e21)return String(f);if(f<0&&(g="-",f=-f),f>1e-21)if(n=y(f*d(2,69,1))-69,r=n<0?f*d(2,-n,1):f/d(2,n,1),r*=4503599627370496,(n=52-n)>0){for(h(0,r),e=a;e>=7;)h(1e7,0),e-=7;for(h(d(10,e,1),0),e=n-1;e>=23;)v(1<<23),e-=23;v(1<<e),h(1,1),v(2),b=p()}else h(0,r),h(1<<-n,0),b=p()+u.call(l,a);return a>0?(c=b.length,b=g+(c<=a?"0."+u.call(l,a-c)+b:b.slice(0,c-a)+"."+b.slice(c-a))):b=g+b,b}})},function(t,n,r){"use strict";var e=r(1),i=r(4),o=r(159),u=1..toPrecision;e(e.P+e.F*(i(function(){return"1"!==u.call(1,void 0)})||!i(function(){u.call({})})),"Number",{toPrecision:function(t){var n=o(this,"Number#toPrecision: incorrect invocation!");return void 0===t?u.call(n):u.call(n,t)}})},function(t,n,r){var e=r(1);e(e.S+e.F,"Object",{assign:r(172)})},function(t,n,r){var e=r(1);e(e.S,"Object",{create:r(70)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperties:r(173)})},function(t,n,r){var e=r(1);e(e.S+e.F*!r(10),"Object",{defineProperty:r(11).f})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("freeze",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(30),i=r(31).f;r(49)("getOwnPropertyDescriptor",function(){return function(t,n){return i(e(t),n)}})},function(t,n,r){r(49)("getOwnPropertyNames",function(){return r(174).f})},function(t,n,r){var e=r(17),i=r(32);r(49)("getPrototypeOf",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6);r(49)("isExtensible",function(t){return function(n){return!!e(n)&&(!t||t(n))}})},function(t,n,r){var e=r(6);r(49)("isFrozen",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(6);r(49)("isSealed",function(t){return function(n){return!e(n)||!!t&&t(n)}})},function(t,n,r){var e=r(1);e(e.S,"Object",{is:r(180)})},function(t,n,r){var e=r(17),i=r(72);r(49)("keys",function(){return function(t){return i(e(t))}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("preventExtensions",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(6),i=r(65).onFreeze;r(49)("seal",function(t){return function(n){return t&&e(n)?t(i(n)):n}})},function(t,n,r){var e=r(1);e(e.S,"Object",{setPrototypeOf:r(144).set})},function(t,n,r){"use strict";var e=r(114),i={};i[r(7)("toStringTag")]="z",i+""!="[object z]"&&r(28)(Object.prototype,"toString",function(){return"[object "+e(this)+"]"},!0)},function(t,n,r){var e=r(1),i=r(178);e(e.G+e.F*(parseFloat!=i),{parseFloat:i})},function(t,n,r){var e=r(1),i=r(179);e(e.G+e.F*(parseInt!=i),{parseInt:i})},function(t,n,r){"use strict";var e,i,o,u=r(69),c=r(3),f=r(53),a=r(114),s=r(1),l=r(6),h=r(26),v=r(68),p=r(79),d=r(146),y=r(151).set,g=r(143)(),b="Promise",m=c.TypeError,x=c.process,w=c[b],x=c.process,S="process"==a(x),_=function(){},O=!!function(){try{var t=w.resolve(1),n=(t.constructor={})[r(7)("species")]=function(t){t(_,_)};return(S||"function"==typeof PromiseRejectionEvent)&&t.then(_)instanceof n}catch(t){}}(),E=function(t,n){return t===n||t===w&&n===o},P=function(t){var n;return!(!l(t)||"function"!=typeof(n=t.then))&&n},j=function(t){return E(w,t)?new F(t):new i(t)},F=i=function(t){var n,r;this.promise=new t(function(t,e){if(void 0!==n||void 0!==r)throw m("Bad Promise constructor");n=t,r=e}),this.resolve=h(n),this.reject=h(r)},M=function(t){try{t()}catch(t){return{error:t}}},A=function(t,n){if(!t._n){t._n=!0;var r=t._c;g(function(){for(var e=t._v,i=1==t._s,o=0;r.length>o;)!function(n){var r,o,u=i?n.ok:n.fail,c=n.resolve,f=n.reject,a=n.domain;try{u?(i||(2==t._h&&I(t),t._h=1),!0===u?r=e:(a&&a.enter(),r=u(e),a&&a.exit()),r===n.promise?f(m("Promise-chain cycle")):(o=P(r))?o.call(r,c,f):c(r)):f(e)}catch(t){f(t)}}(r[o++]);t._c=[],t._n=!1,n&&!t._h&&N(t)})}},N=function(t){y.call(c,function(){var n,r,e,i=t._v;if(T(t)&&(n=M(function(){S?x.emit("unhandledRejection",i,t):(r=c.onunhandledrejection)?r({promise:t,reason:i}):(e=c.console)&&e.error&&e.error("Unhandled promise rejection",i)}),t._h=S||T(t)?2:1),t._a=void 0,n)throw n.error})},T=function(t){if(1==t._h)return!1;for(var n,r=t._a||t._c,e=0;r.length>e;)if(n=r[e++],n.fail||!T(n.promise))return!1;return!0},I=function(t){y.call(c,function(){var n;S?x.emit("rejectionHandled",t):(n=c.onrejectionhandled)&&n({promise:t,reason:t._v})})},k=function(t){var n=this;n._d||(n._d=!0,n=n._w||n,n._v=t,n._s=2,n._a||(n._a=n._c.slice()),A(n,!0))},L=function(t){var n,r=this;if(!r._d){r._d=!0,r=r._w||r;try{if(r===t)throw m("Promise can't be resolved itself");(n=P(t))?g(function(){var e={_w:r,_d:!1};try{n.call(t,f(L,e,1),f(k,e,1))}catch(t){k.call(e,t)}}):(r._v=t,r._s=1,A(r,!1))}catch(t){k.call({_w:r,_d:!1},t)}}};O||(w=function(t){v(this,w,b,"_h"),h(t),e.call(this);try{t(f(L,this,1),f(k,this,1))}catch(t){k.call(this,t)}},e=function(t){this._c=[],this._a=void 0,this._s=0,this._d=!1,this._v=void 0,this._h=0,this._n=!1},e.prototype=r(73)(w.prototype,{then:function(t,n){var r=j(d(this,w));return r.ok="function"!=typeof t||t,r.fail="function"==typeof n&&n,r.domain=S?x.domain:void 0,this._c.push(r),this._a&&this._a.push(r),this._s&&A(this,!1),r.promise},catch:function(t){return this.then(void 0,t)}}),F=function(){var t=new e;this.promise=t,this.resolve=f(L,t,1),this.reject=f(k,t,1)}),s(s.G+s.W+s.F*!O,{Promise:w}),r(81)(w,b),r(74)(b),o=r(52)[b],s(s.S+s.F*!O,b,{reject:function(t){var n=j(this);return(0,n.reject)(t),n.promise}}),s(s.S+s.F*(u||!O),b,{resolve:function(t){if(t instanceof w&&E(t.constructor,this))return t;var n=j(this);return(0,n.resolve)(t),n.promise}}),s(s.S+s.F*!(O&&r(123)(function(t){w.all(t).catch(_)})),b,{all:function(t){var n=this,r=j(n),e=r.resolve,i=r.reject,o=M(function(){var r=[],o=0,u=1;p(t,!1,function(t){var c=o++,f=!1;r.push(void 0),u++,n.resolve(t).then(function(t){f||(f=!0,r[c]=t,--u||e(r))},i)}),--u||e(r)});return o&&i(o.error),r.promise},race:function(t){var n=this,r=j(n),e=r.reject,i=M(function(){p(t,!1,function(t){n.resolve(t).then(r.resolve,e)})});return i&&e(i.error),r.promise}})},function(t,n,r){var e=r(1),i=r(26),o=r(2),u=(r(3).Reflect||{}).apply,c=Function.apply;e(e.S+e.F*!r(4)(function(){u(function(){})}),"Reflect",{apply:function(t,n,r){var e=i(t),f=o(r);return u?u(e,n,f):c.call(e,n,f)}})},function(t,n,r){var e=r(1),i=r(70),o=r(26),u=r(2),c=r(6),f=r(4),a=r(163),s=(r(3).Reflect||{}).construct,l=f(function(){function t(){}return!(s(function(){},[],t)instanceof t)}),h=!f(function(){s(function(){})});e(e.S+e.F*(l||h),"Reflect",{construct:function(t,n){o(t),u(n);var r=arguments.length<3?t:o(arguments[2]);if(h&&!l)return s(t,n,r);if(t==r){switch(n.length){case 0:return new t;case 1:return new t(n[0]);case 2:return new t(n[0],n[1]);case 3:return new t(n[0],n[1],n[2]);case 4:return new t(n[0],n[1],n[2],n[3])}var e=[null];return e.push.apply(e,n),new(a.apply(t,e))}var f=r.prototype,v=i(c(f)?f:Object.prototype),p=Function.apply.call(t,v,n);return c(p)?p:v}})},function(t,n,r){var e=r(11),i=r(1),o=r(2),u=r(50);i(i.S+i.F*r(4)(function(){Reflect.defineProperty(e.f({},1,{value:1}),1,{value:2})}),"Reflect",{defineProperty:function(t,n,r){o(t),n=u(n,!0),o(r);try{return e.f(t,n,r),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(31).f,o=r(2);e(e.S,"Reflect",{deleteProperty:function(t,n){var r=i(o(t),n);return!(r&&!r.configurable)&&delete t[n]}})},function(t,n,r){"use strict";var e=r(1),i=r(2),o=function(t){this._t=i(t),this._i=0;var n,r=this._k=[];for(n in t)r.push(n)};r(139)(o,"Object",function(){var t,n=this,r=n._k;do{if(n._i>=r.length)return{value:void 0,done:!0}}while(!((t=r[n._i++])in n._t));return{value:t,done:!1}}),e(e.S,"Reflect",{enumerate:function(t){return new o(t)}})},function(t,n,r){var e=r(31),i=r(1),o=r(2);i(i.S,"Reflect",{getOwnPropertyDescriptor:function(t,n){return e.f(o(t),n)}})},function(t,n,r){var e=r(1),i=r(32),o=r(2);e(e.S,"Reflect",{getPrototypeOf:function(t){return i(o(t))}})},function(t,n,r){function e(t,n){var r,c,s=arguments.length<3?t:arguments[2];return a(t)===s?t[n]:(r=i.f(t,n))?u(r,"value")?r.value:void 0!==r.get?r.get.call(s):void 0:f(c=o(t))?e(c,n,s):void 0}var i=r(31),o=r(32),u=r(24),c=r(1),f=r(6),a=r(2);c(c.S,"Reflect",{get:e})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{has:function(t,n){return n in t}})},function(t,n,r){var e=r(1),i=r(2),o=Object.isExtensible;e(e.S,"Reflect",{isExtensible:function(t){return i(t),!o||o(t)}})},function(t,n,r){var e=r(1);e(e.S,"Reflect",{ownKeys:r(177)})},function(t,n,r){var e=r(1),i=r(2),o=Object.preventExtensions;e(e.S,"Reflect",{preventExtensions:function(t){i(t);try{return o&&o(t),!0}catch(t){return!1}}})},function(t,n,r){var e=r(1),i=r(144);i&&e(e.S,"Reflect",{setPrototypeOf:function(t,n){i.check(t,n);try{return i.set(t,n),!0}catch(t){return!1}}})},function(t,n,r){function e(t,n,r){var f,h,v=arguments.length<4?t:arguments[3],p=o.f(s(t),n);if(!p){if(l(h=u(t)))return e(h,n,r,v);p=a(0)}return c(p,"value")?!(!1===p.writable||!l(v)||(f=o.f(v,n)||a(0),f.value=r,i.f(v,n,f),0)):void 0!==p.set&&(p.set.call(v,r),!0)}var i=r(11),o=r(31),u=r(32),c=r(24),f=r(1),a=r(66),s=r(2),l=r(6);f(f.S,"Reflect",{set:e})},function(t,n,r){var e=r(3),i=r(136),o=r(11).f,u=r(71).f,c=r(122),f=r(120),a=e.RegExp,s=a,l=a.prototype,h=/a/g,v=/a/g,p=new a(h)!==h;if(r(10)&&(!p||r(4)(function(){return v[r(7)("match")]=!1,a(h)!=h||a(v)==v||"/a/i"!=a(h,"i")}))){a=function(t,n){var r=this instanceof a,e=c(t),o=void 0===n;return!r&&e&&t.constructor===a&&o?t:i(p?new s(e&&!o?t.source:t,n):s((e=t instanceof a)?t.source:t,e&&o?f.call(t):n),r?this:l,a)};for(var d=u(s),y=0;d.length>y;)!function(t){t in a||o(a,t,{configurable:!0,get:function(){return s[t]},set:function(n){s[t]=n}})}(d[y++]);l.constructor=a,a.prototype=l,r(28)(e,"RegExp",a)}r(74)("RegExp")},function(t,n,r){r(119)("match",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("replace",2,function(t,n,r){return[function(e,i){"use strict";var o=t(this),u=void 0==e?void 0:e[n];return void 0!==u?u.call(e,o,i):r.call(String(o),e,i)},r]})},function(t,n,r){r(119)("search",1,function(t,n,r){return[function(r){"use strict";var e=t(this),i=void 0==r?void 0:r[n];return void 0!==i?i.call(r,e):new RegExp(r)[n](String(e))},r]})},function(t,n,r){r(119)("split",2,function(t,n,e){"use strict";var i=r(122),o=e,u=[].push,c="split",f="length",a="lastIndex";if("c"=="abbc"[c](/(b)*/)[1]||4!="test"[c](/(?:)/,-1)[f]||2!="ab"[c](/(?:ab)*/)[f]||4!="."[c](/(.?)(.?)/)[f]||"."[c](/()()/)[f]>1||""[c](/.?/)[f]){var s=void 0===/()??/.exec("")[1];e=function(t,n){var r=String(this);if(void 0===t&&0===n)return[];if(!i(t))return o.call(r,t,n);var e,c,l,h,v,p=[],d=(t.ignoreCase?"i":"")+(t.multiline?"m":"")+(t.unicode?"u":"")+(t.sticky?"y":""),y=0,g=void 0===n?4294967295:n>>>0,b=new RegExp(t.source,d+"g");for(s||(e=new RegExp("^"+b.source+"$(?!\\s)",d));(c=b.exec(r))&&!((l=c.index+c[0][f])>y&&(p.push(r.slice(y,c.index)),!s&&c[f]>1&&c[0].replace(e,function(){for(v=1;v<arguments[f]-2;v++)void 0===arguments[v]&&(c[v]=void 0)}),c[f]>1&&c.index<r[f]&&u.apply(p,c.slice(1)),h=c[0][f],y=l,p[f]>=g));)b[a]===c.index&&b[a]++;return y===r[f]?!h&&b.test("")||p.push(""):p.push(r.slice(y)),p[f]>g?p.slice(0,g):p}}else"0"[c](void 0,0)[f]&&(e=function(t,n){return void 0===t&&0===n?[]:o.call(this,t,n)});return[function(r,i){var o=t(this),u=void 0==r?void 0:r[n];return void 0!==u?u.call(r,o,i):e.call(String(o),r,i)},e]})},function(t,n,r){"use strict";r(184);var e=r(2),i=r(120),o=r(10),u="toString",c=/./[u],f=function(t){r(28)(RegExp.prototype,u,t,!0)};r(4)(function(){return"/a/b"!=c.call({source:"a",flags:"b"})})?f(function(){var t=e(this);return"/".concat(t.source,"/","flags"in t?t.flags:!o&&t instanceof RegExp?i.call(t):void 0)}):c.name!=u&&f(function(){return c.call(this)})},function(t,n,r){"use strict";r(29)("anchor",function(t){return function(n){return t(this,"a","name",n)}})},function(t,n,r){"use strict";r(29)("big",function(t){return function(){return t(this,"big","","")}})},function(t,n,r){"use strict";r(29)("blink",function(t){return function(){return t(this,"blink","","")}})},function(t,n,r){"use strict";r(29)("bold",function(t){return function(){return t(this,"b","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!1);e(e.P,"String",{codePointAt:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="endsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{endsWith:function(t){var n=o(this,t,u),r=arguments.length>1?arguments[1]:void 0,e=i(n.length),f=void 0===r?e:Math.min(i(r),e),a=String(t);return c?c.call(n,a,f):n.slice(f-a.length,f)===a}})},function(t,n,r){"use strict";r(29)("fixed",function(t){return function(){return t(this,"tt","","")}})},function(t,n,r){"use strict";r(29)("fontcolor",function(t){return function(n){return t(this,"font","color",n)}})},function(t,n,r){"use strict";r(29)("fontsize",function(t){return function(n){return t(this,"font","size",n)}})},function(t,n,r){var e=r(1),i=r(75),o=String.fromCharCode,u=String.fromCodePoint;e(e.S+e.F*(!!u&&1!=u.length),"String",{fromCodePoint:function(t){for(var n,r=[],e=arguments.length,u=0;e>u;){if(n=+arguments[u++],i(n,1114111)!==n)throw RangeError(n+" is not a valid code point");r.push(n<65536?o(n):o(55296+((n-=65536)>>10),n%1024+56320))}return r.join("")}})},function(t,n,r){"use strict";var e=r(1),i=r(148),o="includes";e(e.P+e.F*r(134)(o),"String",{includes:function(t){return!!~i(this,t,o).indexOf(t,arguments.length>1?arguments[1]:void 0)}})},function(t,n,r){"use strict";r(29)("italics",function(t){return function(){return t(this,"i","","")}})},function(t,n,r){"use strict";var e=r(147)(!0);r(140)(String,"String",function(t){this._t=String(t),this._i=0},function(){var t,n=this._t,r=this._i;return r>=n.length?{value:void 0,done:!0}:(t=e(n,r),this._i+=t.length,{value:t,done:!1})})},function(t,n,r){"use strict";r(29)("link",function(t){return function(n){return t(this,"a","href",n)}})},function(t,n,r){var e=r(1),i=r(30),o=r(16);e(e.S,"String",{raw:function(t){for(var n=i(t.raw),r=o(n.length),e=arguments.length,u=[],c=0;r>c;)u.push(String(n[c++])),c<e&&u.push(String(arguments[c]));return u.join("")}})},function(t,n,r){var e=r(1);e(e.P,"String",{repeat:r(149)})},function(t,n,r){"use strict";r(29)("small",function(t){return function(){return t(this,"small","","")}})},function(t,n,r){"use strict";var e=r(1),i=r(16),o=r(148),u="startsWith",c=""[u];e(e.P+e.F*r(134)(u),"String",{startsWith:function(t){var n=o(this,t,u),r=i(Math.min(arguments.length>1?arguments[1]:void 0,n.length)),e=String(t);return c?c.call(n,e,r):n.slice(r,r+e.length)===e}})},function(t,n,r){"use strict";r(29)("strike",function(t){return function(){return t(this,"strike","","")}})},function(t,n,r){"use strict";r(29)("sub",function(t){return function(){return t(this,"sub","","")}})},function(t,n,r){"use strict";r(29)("sup",function(t){return function(){return t(this,"sup","","")}})},function(t,n,r){"use strict";r(82)("trim",function(t){return function(){return t(this,3)}})},function(t,n,r){"use strict";var e=r(3),i=r(24),o=r(10),u=r(1),c=r(28),f=r(65).KEY,a=r(4),s=r(126),l=r(81),h=r(76),v=r(7),p=r(182),d=r(153),y=r(206),g=r(205),b=r(138),m=r(2),x=r(30),w=r(50),S=r(66),_=r(70),O=r(174),E=r(31),P=r(11),j=r(72),F=E.f,M=P.f,A=O.f,N=e.Symbol,T=e.JSON,I=T&&T.stringify,k="prototype",L=v("_hidden"),R=v("toPrimitive"),C={}.propertyIsEnumerable,D=s("symbol-registry"),U=s("symbols"),W=s("op-symbols"),G=Object[k],B="function"==typeof N,V=e.QObject,z=!V||!V[k]||!V[k].findChild,q=o&&a(function(){return 7!=_(M({},"a",{get:function(){return M(this,"a",{value:7}).a}})).a})?function(t,n,r){var e=F(G,n);e&&delete G[n],M(t,n,r),e&&t!==G&&M(G,n,e)}:M,K=function(t){var n=U[t]=_(N[k]);return n._k=t,n},J=B&&"symbol"==typeof N.iterator?function(t){return"symbol"==typeof t}:function(t){return t instanceof N},Y=function(t,n,r){return t===G&&Y(W,n,r),m(t),n=w(n,!0),m(r),i(U,n)?(r.enumerable?(i(t,L)&&t[L][n]&&(t[L][n]=!1),r=_(r,{enumerable:S(0,!1)})):(i(t,L)||M(t,L,S(1,{})),t[L][n]=!0),q(t,n,r)):M(t,n,r)},H=function(t,n){m(t);for(var r,e=g(n=x(n)),i=0,o=e.length;o>i;)Y(t,r=e[i++],n[r]);return t},$=function(t,n){return void 0===n?_(t):H(_(t),n)},X=function(t){var n=C.call(this,t=w(t,!0));return!(this===G&&i(U,t)&&!i(W,t))&&(!(n||!i(this,t)||!i(U,t)||i(this,L)&&this[L][t])||n)},Q=function(t,n){if(t=x(t),n=w(n,!0),t!==G||!i(U,n)||i(W,n)){var r=F(t,n);return!r||!i(U,n)||i(t,L)&&t[L][n]||(r.enumerable=!0),r}},Z=function(t){for(var n,r=A(x(t)),e=[],o=0;r.length>o;)i(U,n=r[o++])||n==L||n==f||e.push(n);return e},tt=function(t){for(var n,r=t===G,e=A(r?W:x(t)),o=[],u=0;e.length>u;)!i(U,n=e[u++])||r&&!i(G,n)||o.push(U[n]);return o};B||(N=function(){if(this instanceof N)throw TypeError("Symbol is not a constructor!");var t=h(arguments.length>0?arguments[0]:void 0),n=function(r){this===G&&n.call(W,r),i(this,L)&&i(this[L],t)&&(this[L][t]=!1),q(this,t,S(1,r))};return o&&z&&q(G,t,{configurable:!0,set:n}),K(t)},c(N[k],"toString",function(){return this._k}),E.f=Q,P.f=Y,r(71).f=O.f=Z,r(116).f=X,r(125).f=tt,o&&!r(69)&&c(G,"propertyIsEnumerable",X,!0),p.f=function(t){return K(v(t))}),u(u.G+u.W+u.F*!B,{Symbol:N});for(var nt="hasInstance,isConcatSpreadable,iterator,match,replace,search,species,split,toPrimitive,toStringTag,unscopables".split(","),rt=0;nt.length>rt;)v(nt[rt++]);for(var nt=j(v.store),rt=0;nt.length>rt;)d(nt[rt++]);u(u.S+u.F*!B,"Symbol",{for:function(t){return i(D,t+="")?D[t]:D[t]=N(t)},keyFor:function(t){if(J(t))return y(D,t);throw TypeError(t+" is not a symbol!")},useSetter:function(){z=!0},useSimple:function(){z=!1}}),u(u.S+u.F*!B,"Object",{create:$,defineProperty:Y,defineProperties:H,getOwnPropertyDescriptor:Q,getOwnPropertyNames:Z,getOwnPropertySymbols:tt}),T&&u(u.S+u.F*(!B||a(function(){var t=N();return"[null]"!=I([t])||"{}"!=I({a:t})||"{}"!=I(Object(t))})),"JSON",{stringify:function(t){if(void 0!==t&&!J(t)){for(var n,r,e=[t],i=1;arguments.length>i;)e.push(arguments[i++]);return n=e[1],"function"==typeof n&&(r=n),!r&&b(n)||(n=function(t,n){if(r&&(n=r.call(this,t,n)),!J(n))return n}),e[1]=n,I.apply(T,e)}}}),N[k][R]||r(27)(N[k],R,N[k].valueOf),l(N,"Symbol"),l(Math,"Math",!0),l(e.JSON,"JSON",!0)},function(t,n,r){"use strict";var e=r(1),i=r(127),o=r(152),u=r(2),c=r(75),f=r(16),a=r(6),s=r(3).ArrayBuffer,l=r(146),h=o.ArrayBuffer,v=o.DataView,p=i.ABV&&s.isView,d=h.prototype.slice,y=i.VIEW,g="ArrayBuffer";e(e.G+e.W+e.F*(s!==h),{ArrayBuffer:h}),e(e.S+e.F*!i.CONSTR,g,{isView:function(t){return p&&p(t)||a(t)&&y in t}}),e(e.P+e.U+e.F*r(4)(function(){return!new h(2).slice(1,void 0).byteLength}),g,{slice:function(t,n){if(void 0!==d&&void 0===n)return d.call(u(this),t);for(var r=u(this).byteLength,e=c(t,r),i=c(void 0===n?r:n,r),o=new(l(this,h))(f(i-e)),a=new v(this),s=new v(o),p=0;e<i;)s.setUint8(p++,a.getUint8(e++));return o}}),r(74)(g)},function(t,n,r){var e=r(1);e(e.G+e.W+e.F*!r(127).ABV,{DataView:r(152).DataView})},function(t,n,r){r(55)("Float32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Float64",8,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Int8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint16",2,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint32",4,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}})},function(t,n,r){r(55)("Uint8",1,function(t){return function(n,r,e){return t(this,n,r,e)}},!0)},function(t,n,r){"use strict";var e=r(166);r(118)("WeakSet",function(t){return function(){return t(this,arguments.length>0?arguments[0]:void 0)}},{add:function(t){return e.def(this,t,!0)}},e,!1,!0)},function(t,n,r){"use strict";var e=r(1),i=r(117)(!0);e(e.P,"Array",{includes:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0)}}),r(78)("includes")},function(t,n,r){var e=r(1),i=r(143)(),o=r(3).process,u="process"==r(45)(o);e(e.G,{asap:function(t){var n=u&&o.domain;i(n?n.bind(t):t)}})},function(t,n,r){var e=r(1),i=r(45);e(e.S,"Error",{isError:function(t){return"Error"===i(t)}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Map",{toJSON:r(165)("Map")})},function(t,n,r){var e=r(1);e(e.S,"Math",{iaddh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o+(e>>>0)+((i&u|(i|u)&~(i+u>>>0))>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{imulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>16,f=i>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>16)+((o*f>>>0)+(a&r)>>16)}})},function(t,n,r){var e=r(1);e(e.S,"Math",{isubh:function(t,n,r,e){var i=t>>>0,o=n>>>0,u=r>>>0;return o-(e>>>0)-((~i&u|~(i^u)&i-u>>>0)>>>31)|0}})},function(t,n,r){var e=r(1);e(e.S,"Math",{umulh:function(t,n){var r=65535,e=+t,i=+n,o=e&r,u=i&r,c=e>>>16,f=i>>>16,a=(c*u>>>0)+(o*u>>>16);return c*f+(a>>>16)+((o*f>>>0)+(a&r)>>>16)}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineGetter__:function(t,n){u.f(i(this),t,{get:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(26),u=r(11);r(10)&&e(e.P+r(124),"Object",{__defineSetter__:function(t,n){u.f(i(this),t,{set:o(n),enumerable:!0,configurable:!0})}})},function(t,n,r){var e=r(1),i=r(176)(!0);e(e.S,"Object",{entries:function(t){return i(t)}})},function(t,n,r){var e=r(1),i=r(177),o=r(30),u=r(31),c=r(131);e(e.S,"Object",{getOwnPropertyDescriptors:function(t){for(var n,r=o(t),e=u.f,f=i(r),a={},s=0;f.length>s;)c(a,n=f[s++],e(r,n));return a}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupGetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.get}while(r=u(r))}})},function(t,n,r){"use strict";var e=r(1),i=r(17),o=r(50),u=r(32),c=r(31).f;r(10)&&e(e.P+r(124),"Object",{__lookupSetter__:function(t){var n,r=i(this),e=o(t,!0);do{if(n=c(r,e))return n.set}while(r=u(r))}})},function(t,n,r){var e=r(1),i=r(176)(!1);e(e.S,"Object",{values:function(t){return i(t)}})},function(t,n,r){"use strict";var e=r(1),i=r(3),o=r(52),u=r(143)(),c=r(7)("observable"),f=r(26),a=r(2),s=r(68),l=r(73),h=r(27),v=r(79),p=v.RETURN,d=function(t){return null==t?void 0:f(t)},y=function(t){var n=t._c;n&&(t._c=void 0,n())},g=function(t){return void 0===t._o},b=function(t){g(t)||(t._o=void 0,y(t))},m=function(t,n){a(t),this._c=void 0,this._o=t,t=new x(this);try{var r=n(t),e=r;null!=r&&("function"==typeof r.unsubscribe?r=function(){e.unsubscribe()}:f(r),this._c=r)}catch(n){return void t.error(n)}g(this)&&y(this)};m.prototype=l({},{unsubscribe:function(){b(this)}});var x=function(t){this._s=t};x.prototype=l({},{next:function(t){var n=this._s;if(!g(n)){var r=n._o;try{var e=d(r.next);if(e)return e.call(r,t)}catch(t){try{b(n)}finally{throw t}}}},error:function(t){var n=this._s;if(g(n))throw t;var r=n._o;n._o=void 0;try{var e=d(r.error);if(!e)throw t;t=e.call(r,t)}catch(t){try{y(n)}finally{throw t}}return y(n),t},complete:function(t){var n=this._s;if(!g(n)){var r=n._o;n._o=void 0;try{var e=d(r.complete);t=e?e.call(r,t):void 0}catch(t){try{y(n)}finally{throw t}}return y(n),t}}});var w=function(t){s(this,w,"Observable","_f")._f=f(t)};l(w.prototype,{subscribe:function(t){return new m(t,this._f)},forEach:function(t){var n=this;return new(o.Promise||i.Promise)(function(r,e){f(t);var i=n.subscribe({next:function(n){try{return t(n)}catch(t){e(t),i.unsubscribe()}},error:e,complete:r})})}}),l(w,{from:function(t){var n="function"==typeof this?this:w,r=d(a(t)[c]);if(r){var e=a(r.call(t));return e.constructor===n?e:new n(function(t){return e.subscribe(t)})}return new n(function(n){var r=!1;return u(function(){if(!r){try{if(v(t,!1,function(t){if(n.next(t),r)return p})===p)return}catch(t){if(r)throw t;return void n.error(t)}n.complete()}}),function(){r=!0}})},of:function(){for(var t=0,n=arguments.length,r=Array(n);t<n;)r[t]=arguments[t++];return new("function"==typeof this?this:w)(function(t){var n=!1;return u(function(){if(!n){for(var e=0;e<r.length;++e)if(t.next(r[e]),n)return;t.complete()}}),function(){n=!0}})}}),h(w.prototype,c,function(){return this}),e(e.G,{Observable:w}),r(74)("Observable")},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.set;e.exp({defineMetadata:function(t,n,r,e){u(t,n,i(r),o(e))}})},function(t,n,r){var e=r(54),i=r(2),o=e.key,u=e.map,c=e.store;e.exp({deleteMetadata:function(t,n){var r=arguments.length<3?void 0:o(arguments[2]),e=u(i(n),r,!1);if(void 0===e||!e.delete(t))return!1;if(e.size)return!0;var f=c.get(n);return f.delete(r),!!f.size||c.delete(n)}})},function(t,n,r){var e=r(185),i=r(161),o=r(54),u=r(2),c=r(32),f=o.keys,a=o.key,s=function(t,n){var r=f(t,n),o=c(t);if(null===o)return r;var u=s(o,n);return u.length?r.length?i(new e(r.concat(u))):u:r};o.exp({getMetadataKeys:function(t){return s(u(t),arguments.length<2?void 0:a(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.get,f=e.key,a=function(t,n,r){if(u(t,n,r))return c(t,n,r);var e=o(n);return null!==e?a(t,e,r):void 0};e.exp({getMetadata:function(t,n){return a(t,i(n),arguments.length<3?void 0:f(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.keys,u=e.key;e.exp({getOwnMetadataKeys:function(t){
return o(i(t),arguments.length<2?void 0:u(arguments[1]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.get,u=e.key;e.exp({getOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(32),u=e.has,c=e.key,f=function(t,n,r){if(u(t,n,r))return!0;var e=o(n);return null!==e&&f(t,e,r)};e.exp({hasMetadata:function(t,n){return f(t,i(n),arguments.length<3?void 0:c(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=e.has,u=e.key;e.exp({hasOwnMetadata:function(t,n){return o(t,i(n),arguments.length<3?void 0:u(arguments[2]))}})},function(t,n,r){var e=r(54),i=r(2),o=r(26),u=e.key,c=e.set;e.exp({metadata:function(t,n){return function(r,e){c(t,n,(void 0!==e?i:o)(r),u(e))}}})},function(t,n,r){var e=r(1);e(e.P+e.R,"Set",{toJSON:r(165)("Set")})},function(t,n,r){"use strict";var e=r(1),i=r(147)(!0);e(e.P,"String",{at:function(t){return i(this,t)}})},function(t,n,r){"use strict";var e=r(1),i=r(46),o=r(16),u=r(122),c=r(120),f=RegExp.prototype,a=function(t,n){this._r=t,this._s=n};r(139)(a,"RegExp String",function(){var t=this._r.exec(this._s);return{value:t,done:null===t}}),e(e.P,"String",{matchAll:function(t){if(i(this),!u(t))throw TypeError(t+" is not a regexp!");var n=String(this),r="flags"in f?String(t.flags):c.call(t),e=new RegExp(t.source,~r.indexOf("g")?r:"g"+r);return e.lastIndex=o(t.lastIndex),new a(e,n)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padEnd:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!1)}})},function(t,n,r){"use strict";var e=r(1),i=r(181);e(e.P,"String",{padStart:function(t){return i(this,t,arguments.length>1?arguments[1]:void 0,!0)}})},function(t,n,r){"use strict";r(82)("trimLeft",function(t){return function(){return t(this,1)}},"trimStart")},function(t,n,r){"use strict";r(82)("trimRight",function(t){return function(){return t(this,2)}},"trimEnd")},function(t,n,r){r(153)("asyncIterator")},function(t,n,r){r(153)("observable")},function(t,n,r){var e=r(1);e(e.S,"System",{global:r(3)})},function(t,n,r){for(var e=r(155),i=r(28),o=r(3),u=r(27),c=r(80),f=r(7),a=f("iterator"),s=f("toStringTag"),l=c.Array,h=["NodeList","DOMTokenList","MediaList","StyleSheetList","CSSRuleList"],v=0;v<5;v++){var p,d=h[v],y=o[d],g=y&&y.prototype;if(g){g[a]||u(g,a,l),g[s]||u(g,s,d),c[d]=l;for(p in e)g[p]||i(g,p,e[p],!0)}}},function(t,n,r){var e=r(1),i=r(151);e(e.G+e.B,{setImmediate:i.set,clearImmediate:i.clear})},function(t,n,r){var e=r(3),i=r(1),o=r(121),u=r(207),c=e.navigator,f=!!c&&/MSIE .\./.test(c.userAgent),a=function(t){return f?function(n,r){return t(o(u,[].slice.call(arguments,2),"function"==typeof n?n:Function(n)),r)}:t};i(i.G+i.B+i.F*f,{setTimeout:a(e.setTimeout),setInterval:a(e.setInterval)})},function(t,n,r){r(330),r(269),r(271),r(270),r(273),r(275),r(280),r(274),r(272),r(282),r(281),r(277),r(278),r(276),r(268),r(279),r(283),r(284),r(236),r(238),r(237),r(286),r(285),r(256),r(266),r(267),r(257),r(258),r(259),r(260),r(261),r(262),r(263),r(264),r(265),r(239),r(240),r(241),r(242),r(243),r(244),r(245),r(246),r(247),r(248),r(249),r(250),r(251),r(252),r(253),r(254),r(255),r(317),r(322),r(329),r(320),r(312),r(313),r(318),r(323),r(325),r(308),r(309),r(310),r(311),r(314),r(315),r(316),r(319),r(321),r(324),r(326),r(327),r(328),r(231),r(233),r(232),r(235),r(234),r(220),r(218),r(224),r(221),r(227),r(229),r(217),r(223),r(214),r(228),r(212),r(226),r(225),r(219),r(222),r(211),r(213),r(216),r(215),r(230),r(155),r(302),r(307),r(184),r(303),r(304),r(305),r(306),r(287),r(183),r(185),r(186),r(342),r(331),r(332),r(337),r(340),r(341),r(335),r(338),r(336),r(339),r(333),r(334),r(288),r(289),r(290),r(291),r(292),r(295),r(293),r(294),r(296),r(297),r(298),r(299),r(301),r(300),r(343),r(369),r(372),r(371),r(373),r(374),r(370),r(375),r(376),r(354),r(357),r(353),r(351),r(352),r(355),r(356),r(346),r(368),r(377),r(345),r(347),r(349),r(348),r(350),r(359),r(360),r(362),r(361),r(364),r(363),r(365),r(366),r(367),r(344),r(358),r(380),r(379),r(378),t.exports=r(52)},function(t,n){function r(t,n){if("string"==typeof n)return t.insertAdjacentHTML("afterend",n);var r=t.nextSibling;return r?t.parentNode.insertBefore(n,r):t.parentNode.appendChild(n)}t.exports=r},,,,,,,,,function(t,n,r){(function(n,r){!function(n){"use strict";function e(t,n,r,e){var i=n&&n.prototype instanceof o?n:o,u=Object.create(i.prototype),c=new p(e||[]);return u._invoke=s(t,r,c),u}function i(t,n,r){try{return{type:"normal",arg:t.call(n,r)}}catch(t){return{type:"throw",arg:t}}}function o(){}function u(){}function c(){}function f(t){["next","throw","return"].forEach(function(n){t[n]=function(t){return this._invoke(n,t)}})}function a(t){function n(r,e,o,u){var c=i(t[r],t,e);if("throw"!==c.type){var f=c.arg,a=f.value;return a&&"object"==typeof a&&m.call(a,"__await")?Promise.resolve(a.__await).then(function(t){n("next",t,o,u)},function(t){n("throw",t,o,u)}):Promise.resolve(a).then(function(t){f.value=t,o(f)},u)}u(c.arg)}function e(t,r){function e(){return new Promise(function(e,i){n(t,r,e,i)})}return o=o?o.then(e,e):e()}"object"==typeof r&&r.domain&&(n=r.domain.bind(n));var o;this._invoke=e}function s(t,n,r){var e=P;return function(o,u){if(e===F)throw new Error("Generator is already running");if(e===M){if("throw"===o)throw u;return y()}for(r.method=o,r.arg=u;;){var c=r.delegate;if(c){var f=l(c,r);if(f){if(f===A)continue;return f}}if("next"===r.method)r.sent=r._sent=r.arg;else if("throw"===r.method){if(e===P)throw e=M,r.arg;r.dispatchException(r.arg)}else"return"===r.method&&r.abrupt("return",r.arg);e=F;var a=i(t,n,r);if("normal"===a.type){if(e=r.done?M:j,a.arg===A)continue;return{value:a.arg,done:r.done}}"throw"===a.type&&(e=M,r.method="throw",r.arg=a.arg)}}}function l(t,n){var r=t.iterator[n.method];if(r===g){if(n.delegate=null,"throw"===n.method){if(t.iterator.return&&(n.method="return",n.arg=g,l(t,n),"throw"===n.method))return A;n.method="throw",n.arg=new TypeError("The iterator does not provide a 'throw' method")}return A}var e=i(r,t.iterator,n.arg);if("throw"===e.type)return n.method="throw",n.arg=e.arg,n.delegate=null,A;var o=e.arg;return o?o.done?(n[t.resultName]=o.value,n.next=t.nextLoc,"return"!==n.method&&(n.method="next",n.arg=g),n.delegate=null,A):o:(n.method="throw",n.arg=new TypeError("iterator result is not an object"),n.delegate=null,A)}function h(t){var n={tryLoc:t[0]};1 in t&&(n.catchLoc=t[1]),2 in t&&(n.finallyLoc=t[2],n.afterLoc=t[3]),this.tryEntries.push(n)}function v(t){var n=t.completion||{};n.type="normal",delete n.arg,t.completion=n}function p(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(h,this),this.reset(!0)}function d(t){if(t){var n=t[w];if(n)return n.call(t);if("function"==typeof t.next)return t;if(!isNaN(t.length)){var r=-1,e=function n(){for(;++r<t.length;)if(m.call(t,r))return n.value=t[r],n.done=!1,n;return n.value=g,n.done=!0,n};return e.next=e}}return{next:y}}function y(){return{value:g,done:!0}}var g,b=Object.prototype,m=b.hasOwnProperty,x="function"==typeof Symbol?Symbol:{},w=x.iterator||"@@iterator",S=x.asyncIterator||"@@asyncIterator",_=x.toStringTag||"@@toStringTag",O="object"==typeof t,E=n.regeneratorRuntime;if(E)return void(O&&(t.exports=E));E=n.regeneratorRuntime=O?t.exports:{},E.wrap=e;var P="suspendedStart",j="suspendedYield",F="executing",M="completed",A={},N={};N[w]=function(){return this};var T=Object.getPrototypeOf,I=T&&T(T(d([])));I&&I!==b&&m.call(I,w)&&(N=I);var k=c.prototype=o.prototype=Object.create(N);u.prototype=k.constructor=c,c.constructor=u,c[_]=u.displayName="GeneratorFunction",E.isGeneratorFunction=function(t){var n="function"==typeof t&&t.constructor;return!!n&&(n===u||"GeneratorFunction"===(n.displayName||n.name))},E.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,c):(t.__proto__=c,_ in t||(t[_]="GeneratorFunction")),t.prototype=Object.create(k),t},E.awrap=function(t){return{__await:t}},f(a.prototype),a.prototype[S]=function(){return this},E.AsyncIterator=a,E.async=function(t,n,r,i){var o=new a(e(t,n,r,i));return E.isGeneratorFunction(n)?o:o.next().then(function(t){return t.done?t.value:o.next()})},f(k),k[_]="Generator",k.toString=function(){return"[object Generator]"},E.keys=function(t){var n=[];for(var r in t)n.push(r);return n.reverse(),function r(){for(;n.length;){var e=n.pop();if(e in t)return r.value=e,r.done=!1,r}return r.done=!0,r}},E.values=d,p.prototype={constructor:p,reset:function(t){if(this.prev=0,this.next=0,this.sent=this._sent=g,this.done=!1,this.delegate=null,this.method="next",this.arg=g,this.tryEntries.forEach(v),!t)for(var n in this)"t"===n.charAt(0)&&m.call(this,n)&&!isNaN(+n.slice(1))&&(this[n]=g)},stop:function(){this.done=!0;var t=this.tryEntries[0],n=t.completion;if("throw"===n.type)throw n.arg;return this.rval},dispatchException:function(t){function n(n,e){return o.type="throw",o.arg=t,r.next=n,e&&(r.method="next",r.arg=g),!!e}if(this.done)throw t;for(var r=this,e=this.tryEntries.length-1;e>=0;--e){var i=this.tryEntries[e],o=i.completion;if("root"===i.tryLoc)return n("end");if(i.tryLoc<=this.prev){var u=m.call(i,"catchLoc"),c=m.call(i,"finallyLoc");if(u&&c){if(this.prev<i.catchLoc)return n(i.catchLoc,!0);if(this.prev<i.finallyLoc)return n(i.finallyLoc)}else if(u){if(this.prev<i.catchLoc)return n(i.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return n(i.finallyLoc)}}}},abrupt:function(t,n){for(var r=this.tryEntries.length-1;r>=0;--r){var e=this.tryEntries[r];if(e.tryLoc<=this.prev&&m.call(e,"finallyLoc")&&this.prev<e.finallyLoc){var i=e;break}}i&&("break"===t||"continue"===t)&&i.tryLoc<=n&&n<=i.finallyLoc&&(i=null);var o=i?i.completion:{};return o.type=t,o.arg=n,i?(this.method="next",this.next=i.finallyLoc,A):this.complete(o)},complete:function(t,n){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&n&&(this.next=n),A},finish:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),v(r),A}},catch:function(t){for(var n=this.tryEntries.length-1;n>=0;--n){var r=this.tryEntries[n];if(r.tryLoc===t){var e=r.completion;if("throw"===e.type){var i=e.arg;v(r)}return i}}throw new Error("illegal catch attempt")},delegateYield:function(t,n,r){return this.delegate={iterator:d(t),resultName:n,nextLoc:r},"next"===this.method&&(this.arg=g),A}}}("object"==typeof n?n:"object"==typeof window?window:"object"==typeof self?self:this)}).call(n,function(){return this}(),r(158))}])</script><script src="/study.github.io/./main.0cf68a.js"></script><script>!function(){!function(e){var t=document.createElement("script");document.getElementsByTagName("body")[0].appendChild(t),t.setAttribute("src",e)}("/study.github.io/slider.e37972.js")}()</script>


    
<div class="tools-col" q-class="show:isShow,hide:isShow|isFalse" q-on="click:stop(e)">
  <div class="tools-nav header-menu">
    
    
      
      
      
    
      
      
      
    
      
      
      
    
    

    <ul style="width: 70%">
    
    
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'innerArchive')"><a href="javascript:void(0)" q-class="active:innerArchive">所有文章</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'friends')"><a href="javascript:void(0)" q-class="active:friends">友链</a></li>
      
        
      
      <li style="width: 33.333333333333336%" q-on="click: openSlider(e, 'aboutme')"><a href="javascript:void(0)" q-class="active:aboutme">关于我</a></li>
      
        
    </ul>
  </div>
  <div class="tools-wrap">
    
    	<section class="tools-section tools-section-all" q-show="innerArchive">
        <div class="search-wrap">
          <input class="search-ipt" q-model="search" type="text" placeholder="find something…">
          <i class="icon-search icon" q-show="search|isEmptyStr"></i>
          <i class="icon-close icon" q-show="search|isNotEmptyStr" q-on="click:clearChose(e)"></i>
        </div>
        <div class="widget tagcloud search-tag">
          <p class="search-tag-wording">tag:</p>
          <label class="search-switch">
            <input type="checkbox" q-on="click:toggleTag(e)" q-attr="checked:showTags">
          </label>
          <ul class="article-tag-list" q-show="showTags">
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">2019</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color3">codewar</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Heroku</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">2020</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">Hadoop</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color2">python</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color5">algorithm</a>
              </li>
             
              <li class="article-tag-list-item">
                <a href="javascript:void(0)" class="js-tag color4">区块链</a>
              </li>
            
            <div class="clearfix"></div>
          </ul>
        </div>
        <ul class="search-ul">
          <p q-show="jsonFail" style="padding: 20px; font-size: 12px;">
            缺失模块。<br>1、请确保node版本大于6.2<br>2、在博客根目录（注意不是yilia根目录）执行以下命令：<br> npm i hexo-generator-json-content --save<br><br>
            3、在根目录_config.yml里添加配置：
<pre style="font-size: 12px;" q-show="jsonFail">
  jsonContent:
    meta: false
    pages: false
    posts:
      title: true
      date: true
      path: true
      text: false
      raw: false
      content: false
      slug: false
      updated: false
      comments: false
      link: false
      permalink: false
      excerpt: false
      categories: false
      tags: true
</pre>
          </p>
          <li class="search-li" q-repeat="items" q-show="isShow">
            <a q-attr="href:path|urlformat" class="search-title"><i class="icon-quo-left icon"></i><span q-text="title"></span></a>
            <p class="search-time">
              <i class="icon-calendar icon"></i>
              <span q-text="date|dateformat"></span>
            </p>
            <p class="search-tag">
              <i class="icon-price-tags icon"></i>
              <span q-repeat="tags" q-on="click:choseTag(e, name)" q-text="name|tagformat"></span>
            </p>
          </li>
        </ul>
    	</section>
    

    
    	<section class="tools-section tools-section-friends" q-show="friends">
  		
        <ul class="search-ul">
          
            <li class="search-li">
              <a href="http://google.com/" target="_blank" class="search-title"><i class="icon-quo-left icon"></i>谷歌</a>
            </li>
          
        </ul>
  		
    	</section>
    

    
    	<section class="tools-section tools-section-me" q-show="aboutme">
  	  	
  	  		<div class="aboutme-wrap" id="js-aboutme">just a student</div>
  	  	
    	</section>
    
  </div>
  
</div>
    <!-- Root element of PhotoSwipe. Must have class pswp. -->
<div class="pswp" tabindex="-1" role="dialog" aria-hidden="true">

    <!-- Background of PhotoSwipe. 
         It's a separate element as animating opacity is faster than rgba(). -->
    <div class="pswp__bg"></div>

    <!-- Slides wrapper with overflow:hidden. -->
    <div class="pswp__scroll-wrap">

        <!-- Container that holds slides. 
            PhotoSwipe keeps only 3 of them in the DOM to save memory.
            Don't modify these 3 pswp__item elements, data is added later on. -->
        <div class="pswp__container">
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
            <div class="pswp__item"></div>
        </div>

        <!-- Default (PhotoSwipeUI_Default) interface on top of sliding area. Can be changed. -->
        <div class="pswp__ui pswp__ui--hidden">

            <div class="pswp__top-bar">

                <!--  Controls are self-explanatory. Order can be changed. -->

                <div class="pswp__counter"></div>

                <button class="pswp__button pswp__button--close" title="Close (Esc)"></button>

                <button class="pswp__button pswp__button--share" style="display:none" title="Share"></button>

                <button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>

                <button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button>

                <!-- Preloader demo http://codepen.io/dimsemenov/pen/yyBWoR -->
                <!-- element will get class pswp__preloader--active when preloader is running -->
                <div class="pswp__preloader">
                    <div class="pswp__preloader__icn">
                      <div class="pswp__preloader__cut">
                        <div class="pswp__preloader__donut"></div>
                      </div>
                    </div>
                </div>
            </div>

            <div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap">
                <div class="pswp__share-tooltip"></div> 
            </div>

            <button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
            </button>

            <button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)">
            </button>

            <div class="pswp__caption">
                <div class="pswp__caption__center"></div>
            </div>

        </div>

    </div>

</div>
  </div>
</body>
</html>